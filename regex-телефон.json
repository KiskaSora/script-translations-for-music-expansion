{
    "id": "57167ee3-87a8-411b-a77e-1c4338133d94",
    "scriptName": "Телефон",
    "findRegex": "/<nova_os>\\s*\\[StatusBar\\|(.*?)\\|(.*?)\\]\\s*\\[MusicMeta\\|(.*?)\\|(.*?)\\]\\s*\\[Memo\\|(.*?)\\|(.*?)\\|(.*?)\\]\\s*\\[WeChat\\|(.*?)\\]\\s*\\[Diary\\|(.*?)\\|(.*?)\\]\\s*\\[Forum\\|(.*?)\\|(.*?)\\|(.*?)\\|(.*?)\\|(.*?)\\]\\s*\\[Gemini\\|(.*?)\\|(.*?)\\]\\s*\\[Thoughts\\|(.*?)\\]\\s*\\[SecretMsg\\|(.*?)\\]\\s*<\\/nova_os>/s",
    "replaceString": "```html\n<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"referrer\" content=\"no-referrer\">\n</head>\n<body>\n<style>\n    /* === NovaOS 全局变量 === */\n    .nova-os-v48 {\n        --os-font: -apple-system, BlinkMacSystemFont, \"PingFang SC\", \"Microsoft YaHei\", sans-serif;\n        --serif-font: \"Playfair Display\", \"Times New Roman\", \"Songti SC\", serif;\n        --app-transition: 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\n        --status-bar-height: 50px;\n    }\n    .ico-svg { width: 28px; height: 28px; fill: currentColor; }\n    .ico-sm { width: 20px; height: 20px; }\n\n    /* === 基础框架 === */\n    .iphone-frame {\n        font-family: var(--os-font); color: #000; width: 100%; max-width: 380px; height: 800px;\n        margin: 20px auto; border-radius: 50px; background-color: #000;\n        background-image: url('https://files.catbox.moe/m1q47r.jpeg');\n        background-size: cover; background-position: center; border: 12px solid #111;\n        box-shadow: 0 30px 60px rgba(0,0,0,0.5), inset 0 0 0 2px rgba(255,255,255,0.1);\n        position: relative; overflow: hidden; user-select: none; display: flex; flex-direction: column;\n        -webkit-mask-image: -webkit-radial-gradient(white, black); mask-image: radial-gradient(white, black);\n    }\n    /* 状态栏：App激活时隐藏 */\n    .status-bar {\n        height: var(--status-bar-height); display: flex; justify-content: space-between; align-items: center; padding: 0 28px;\n        font-size: 15px; font-weight: 600; color: white; z-index: 80; position: relative; text-shadow: 0 1px 2px rgba(0,0,0,0.4); pointer-events: none;\n        transition: color 0.3s ease, opacity 0.3s ease;\n    }\n    .iphone-frame.app-active .status-bar {\n        opacity: 0;\n        pointer-events: none;\n    }\n\n    /* 灵动岛 */\n    .dynamic-island {\n        position: absolute; top: 12px; left: 50%; transform: translateX(-50%); width: 120px; height: 34px; background: black; border-radius: 20px;\n        z-index: 100; transition: all 0.3s ease; cursor: pointer; pointer-events: auto;\n    }\n    .dynamic-island:active { transform: translateX(-50%) scale(0.95); }\n    .iphone-frame.app-active .dynamic-island { transform: translateX(-50%) translateY(-150%); opacity: 0; pointer-events: none;}\n\n    /* 内心想法弹窗 */\n    .thoughts-modal-layer {\n        position: absolute; top: var(--status-bar-height); left: 0; right: 0; bottom: 0; z-index: 70;\n        display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 15px;\n        opacity: 0; pointer-events: none; transition: opacity 0.3s ease;\n    }\n    .thoughts-modal-layer.show { opacity: 1; pointer-events: auto; }\n    .thoughts-bubble {\n        background: rgba(255, 255, 255, 0.95); color: #000;\n        padding: 20px 25px; border-radius: 24px; max-width: 85%;\n        box-shadow: 0 10px 30px rgba(0,0,0,0.3); transform: translateY(-20px); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        display: flex; flex-direction: column; gap: 8px; position: relative;\n    }\n    .thoughts-modal-layer.show .thoughts-bubble { transform: translateY(0); }\n    .thoughts-bubble::before {\n        content: ''; position: absolute; top: -8px; left: 50%; transform: translateX(-50%);\n        border-width: 0 8px 8px 8px; border-style: solid; border-color: transparent transparent rgba(255, 255, 255, 0.95) transparent;\n    }\n    .thoughts-title { font-size: 12px; color: #666; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }\n    .thoughts-content { font-size: 15px; line-height: 1.5; font-weight: 500; color: #333; }\n    .thoughts-tip { font-size: 10px; color: #999; margin-top: 5px; text-align: center; }\n\n    /* 深情密语弹窗 */\n    .secret-msg-layer {\n        position: absolute; top: 0; left: 0; right: 0; bottom: 0; z-index: 90;\n        background: rgba(255,255,255,0.75); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);\n        display: flex; flex-direction: column; align-items: center; justify-content: center;\n        opacity: 0; pointer-events: none; transition: all 0.5s ease;\n    }\n    .secret-msg-layer.show { opacity: 1; pointer-events: auto; }\n    .secret-msg-box {\n        width: 85%; padding: 40px 30px; text-align: center;\n        transform: scale(0.95) translateY(10px); transition: all 0.5s cubic-bezier(0.2, 0.8, 0.2, 1);\n    }\n    .secret-msg-layer.show .secret-msg-box { transform: scale(1) translateY(0); }\n    .secret-deco-line { width: 40px; height: 1px; background: #333; margin: 0 auto 25px auto; opacity: 0.15; }\n    .secret-text {\n        font-family: var(--serif-font); font-size: 19px; line-height: 1.9; color: #1a1a1a;\n        font-style: italic; letter-spacing: 0.5px; font-weight: 500;\n    }\n    .secret-close {\n        margin-top: 40px; font-size: 11px; color: #666; letter-spacing: 3px; text-transform: uppercase; cursor: pointer;\n        padding: 12px 20px; transition: color 0.3s, background 0.3s; border-radius: 20px;\n    }\n    .secret-close:hover { color: #000; background: rgba(0,0,0,0.05); }\n\n    /* 主屏幕 */\n    .home-screen {\n        flex: 1; display: flex; flex-direction: column; padding: 20px 25px 30px 25px; transition: transform 0.4s ease, opacity 0.4s ease;\n    }\n    .iphone-frame.app-active .home-screen { transform: scale(0.9); opacity: 0; pointer-events: none; }\n\n    /* App Window */\n    .app-window {\n        position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: white; z-index: 60;\n        transform: translateY(100%); transition: var(--app-transition); display: flex; flex-direction: column;\n        border-radius: 0; overflow: hidden;\n        will-change: transform;\n    }\n    .app-window.active { transform: translateY(0); }\n    .app-nav {\n        padding-top: var(--status-bar-height); height: 44px; display: flex; align-items: center; justify-content: space-between;\n        padding-left: 15px; padding-right: 15px; z-index: 70; border-bottom: 1px solid #eee; box-sizing: content-box; position: relative;\n    }\n    .app-nav::before { content: ''; position: absolute; top: -50px; left: 0; right: 0; bottom: 0; background: inherit; z-index: -1; }\n    .nav-back { color: #007aff; cursor: pointer; display: flex; align-items: center; font-size: 17px; font-weight: 500;}\n    .nav-title { font-weight: 600; font-size: 17px; }\n    .nav-action { color: #007aff; font-size: 17px; cursor: pointer; display: flex; align-items: center; justify-content: center;}\n    .app-body { flex: 1; overflow-y: auto; background: #fff; padding-bottom: 20px; position:relative;}\n\n    /* Icons */\n    .icon-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px 18px; margin-top: 30px; }\n    .app-icon-wrapper { display: flex; flex-direction: column; align-items: center; gap: 8px; cursor: pointer; transition: transform 0.1s; position: relative; }\n    .app-icon-wrapper:active { transform: scale(0.92); }\n    .app-icon {\n        width: 62px; height: 62px; border-radius: 16px; background-color: rgba(255,255,255,0.2); backdrop-filter: blur(10px);\n        display: flex; justify-content: center; align-items: center; color: white;\n        box-shadow: 0 4px 15px rgba(0,0,0,0.2); background-size: cover; background-position: center; overflow: hidden;\n    }\n    .app-label { font-size: 12px; color: white; text-shadow: 0 1px 3px rgba(0,0,0,0.8); font-weight: 500; }\n    .dock {\n        margin-top: auto; background: rgba(255,255,255,0.2); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);\n        border-radius: 35px; height: 90px; display: flex; justify-content: space-around; align-items: center; padding: 0 15px; border: 1px solid rgba(255,255,255,0.1);\n    }\n\n    /* WeChat */\n    #app-wechat { background: #ededed; }\n    #app-wechat .app-nav { background: #ededed; border-bottom: 1px solid #dcdcdc; }\n    #app-wechat .nav-back, #app-wechat .nav-action { color: #181818; }\n    .chat-container { padding: 15px; display: flex; flex-direction: column; gap: 15px; }\n    .chat-row { display: flex; align-items: flex-start; gap: 10px; width: 100%; }\n    .chat-row.me { flex-direction: row-reverse; }\n    .chat-avatar { width: 40px; height: 40px; border-radius: 6px; background: #ccc; flex-shrink: 0; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 16px; font-weight: bold; overflow: hidden; background-size: cover; background-position: center; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }\n    .chat-avatar.my-avatar { background-color: #eee; }\n    .chat-content-box { display: flex; flex-direction: column; max-width: 70%; align-items: flex-start; }\n    .chat-row.me .chat-content-box { align-items: flex-end; }\n    .chat-name { font-size: 12px; color: #999; margin-bottom: 4px; margin-left: 2px; }\n    .chat-row.me .chat-name { display: none; }\n    .bubble { padding: 10px 14px; font-size: 16px; line-height: 1.5; border-radius: 4px; position: relative; word-wrap: break-word; word-break: break-all; color: #000; box-shadow: 0 1px 1px rgba(0,0,0,0.05); }\n    .bubble.left { background: #ffffff; border: 1px solid #ededed; }\n    .bubble.left::before { content: ''; position: absolute; top: 14px; left: -6px; width: 10px; height: 10px; background: #fff; transform: rotate(45deg); border-left: 1px solid #ededed; border-bottom: 1px solid #ededed; }\n    .bubble.right { background: #95ec69; border: 1px solid #85d663; }\n    .bubble.right::before { content: ''; position: absolute; top: 14px; right: -6px; width: 10px; height: 10px; background: #95ec69; transform: rotate(45deg); border-top: 1px solid #85d663; border-right: 1px solid #85d663; }\n\n    /* Яmo (Modified: White background, Exquisite Style, No Header Text) */\n    #app-memo { background: #ffffff; font-family: var(--serif-font); }\n    #app-memo .app-nav { background: #ffffff; border-bottom: none; }\n    #app-memo .nav-back, #app-memo .nav-action { color: #555; }\n    #app-memo .app-body { padding: 0 35px; }\n    .memo-header { margin-top: 10px; margin-bottom: 25px; border-bottom: 1px solid rgba(0,0,0,0.05); padding-bottom: 15px;}\n    .memo-header h1 { display: none; } /* User requested removal of title */\n    .memo-list { display: flex; flex-direction: column; gap: 0; }\n    .memo-item { display: flex; align-items: flex-start; gap: 15px; padding: 18px 0; border-bottom: 1px dashed rgba(0,0,0,0.1); }\n    .memo-check { width: 18px; height: 18px; border-radius: 50%; border: 1px solid #999; flex-shrink: 0; margin-top: 4px; }\n    .memo-text { font-family: var(--serif-font); font-size: 18px; color: #444; line-height: 1.6; flex: 1; word-break: break-all; }\n    .memo-item:empty { display: none; }\n\n    /* Forum */\n    #app-forum { background: #f2f2f7; }\n    #app-forum .app-nav { background: #f2f2f7; }\n    #app-forum .app-body { padding: 15px; display: flex; flex-direction: column; gap: 15px; }\n    .forum-post-card { background: #fff; padding: 20px; border-radius: 16px; box-shadow: 0 1px 3px rgba(0,0,0,0.05); }\n    .forum-tag { font-size: 12px; color: #ff3b30; margin-bottom: 8px; font-weight: bold; }\n    .forum-title { font-size: 20px; margin: 0 0 10px 0; line-height: 1.3; font-weight: 700; color:#1c1c1e; }\n    .forum-text { color: #3a3a3c; font-size: 15px; line-height: 1.5; }\n    /* Modified: Removed char name */\n    .forum-meta { margin-top: 15px; padding-top: 10px; border-top: 1px solid #f5f5f5; font-size: 13px; color: #8e8e93; display: flex; justify-content: space-between; }\n    .forum-comments-section { display: flex; flex-direction: column; gap: 10px; padding: 5px 5px 20px 5px; }\n    .forum-section-label { font-size: 13px; color: #8e8e93; margin-left: 5px; font-weight: 500; }\n    .comment-bubble { background: #fff; padding: 15px; border-radius: 12px; font-size: 14px; color: #333; line-height: 1.4; box-shadow: 0 1px 2px rgba(0,0,0,0.03); }\n\n    /* Diary */\n    #app-diary { background: #ffffff; }\n    #app-diary .app-nav { background: #ffffff; border: none; }\n    #app-diary .nav-back { color: #5a5a5a; opacity: 0.6; }\n    #app-diary .nav-title, #app-diary .nav-action { display: none; }\n    .diary-layout { padding: 10px 35px 50px 35px; font-family: var(--serif-font); color: #2b2b2b; display: flex; flex-direction: column; height: 100%; }\n    .diary-art-header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid rgba(0,0,0,0.06); }\n    .diary-eng-deco { display: block; font-size: 10px; letter-spacing: 4px; text-transform: uppercase; color: #999; margin-bottom: 6px; }\n    .diary-eng-sub { display: block; font-family: var(--os-font); font-size: 9px; color: #ccc; letter-spacing: 1px; }\n    .diary-text-body { font-size: 15px; line-height: 1.8; text-align: justify; white-space: pre-wrap; font-weight: 400; opacity: 0.9; }\n    .diary-text-body::first-letter { font-size: inherit; float: none; font-weight: normal; }\n    .diary-footer-art { margin-top: auto; padding-top: 40px; display: flex; flex-direction: column; align-items: flex-end; gap: 5px; }\n    .diary-sign { font-style: italic; font-size: 14px; color: #555; }\n    .diary-date-stamp { font-size: 10px; color: #b0b0b0; font-family: var(--os-font); letter-spacing: 1px; text-transform: uppercase; }\n\n    /* === Music App === */\n    #app-music-netease { background: #000; overflow: hidden; }\n    #app-music-netease .app-nav { background: transparent; border: none; color: #fff; position: relative; z-index: 10; padding-top: var(--status-bar-height); border-bottom: none; }\n    #app-music-netease .app-nav::before { background: linear-gradient(to bottom, rgba(0,0,0,0.6) 0%, transparent 100%); }\n    #app-music-netease .nav-back svg { fill: #fff; width: 24px; height: 24px; opacity: 0.8; }\n    #app-music-netease .nav-title-box { display: flex; flex-direction: column; align-items: center; width: 65%; transition: opacity 0.3s;}\n    #app-music-netease .music-title { font-size: 16px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-weight:700; max-width: 100%;}\n    #app-music-netease .music-artist-nav { font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 3px; }\n    .infinite-btn { font-size: 28px; color: rgba(255,255,255,0.8); line-height: 1; padding-bottom: 5px; cursor: pointer; transition: color 0.3s; }\n    #app-music-netease .ne-bg-layer { position: absolute; top:0; left:0; right:0; bottom:0; z-index: 0; background: #111; background-size: cover; background-position: center; transition: background-image 0.8s ease; }\n    #app-music-netease .ne-bg-layer::after { content: ''; position: absolute; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.5); backdrop-filter: blur(40px); -webkit-backdrop-filter: blur(40px); }\n    .ne-main-view { position: relative; z-index: 5; flex: 1; display: flex; flex-direction: column; transition: opacity 0.3s; overflow: hidden; }\n    .ne-listen-together { display: flex; align-items: center; justify-content: center; height: 60px; margin-top: 25px; gap: 8px; flex-shrink: 0; }\n    .ne-listen-avatar { width: 40px; height: 40px; border-radius: 50%; background: #ddd; border: 2px solid rgba(255,255,255,0.8); background-size: cover; background-position: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); transition: transform 0.2s; cursor: pointer; }\n    .ne-listen-avatar:active { transform: scale(0.9); }\n    .ne-heartbeat-line { width: 100px; height: 40px; display: flex; align-items: center; justify-content: center; opacity: 0.8; cursor: pointer; transition: opacity 0.3s; }\n    .ne-heartbeat-line:hover { opacity: 1; }\n    .ne-heartbeat-svg path { fill: none; stroke: rgba(255,255,255,0.9); stroke-width: 2; stroke-dasharray: 200; stroke-dashoffset: 200; animation: heartbeat-dash 2s linear infinite; }\n    @keyframes heartbeat-dash { 0% { stroke-dashoffset: 200; opacity: 0; } 20% { opacity: 1; } 80% { opacity: 1; } 100% { stroke-dashoffset: 0; opacity: 0; } }\n    .ne-view-player { flex:1; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;}\n    .ne-disc-container { width: 260px; height: 260px; background: #111; border-radius: 50%; border: 4px solid rgba(255,255,255,0.1); display: flex; align-items: center; justify-content: center; box-shadow: 0 0 30px rgba(0,0,0,0.6); margin-top: -20px; animation: ne-spin 25s linear infinite; animation-play-state: paused; cursor: pointer; transition: opacity 0.4s ease, transform 0.4s ease; }\n    .ne-disc-container.playing { animation-play-state: running; }\n    .ne-disc-container.hidden { opacity: 0; transform: scale(0.8); pointer-events: none; position: absolute;}\n    @keyframes ne-spin { 100% { transform: rotate(360deg); } }\n    .ne-disc-grooves { width: 250px; height: 250px; border-radius: 50%; background: repeating-radial-gradient(#111 0, #111 2px, #222 3px, #111 4px); display: flex; align-items: center; justify-content: center; }\n    .ne-album-art { width: 170px; height: 170px; border-radius: 50%; background: #333; background-size: cover; background-position: center; border: 2px solid #000; }\n    .ne-view-lyrics { position: absolute; top: 0; left: 0; right: 0; bottom: 0; display: flex; flex-direction: column; align-items: center; padding: 60px 20px; overflow-y: auto; text-align: center; mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%); -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 15%, black 85%, transparent 100%); scrollbar-width: none; opacity: 0; pointer-events: none; transition: opacity 0.4s ease; }\n    .ne-view-lyrics.show { opacity: 1; pointer-events: auto; }\n    .ne-view-lyrics::-webkit-scrollbar { display: none; }\n    .lrc-line { color: rgba(255,255,255,0.45); font-size: 16px; font-weight: 500; margin: 6px 0; transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); cursor: pointer; line-height: 1.4; transform-origin: center center; padding: 2px 0; }\n    .lrc-line:hover { color: rgba(255,255,255,0.7); }\n    .lrc-line.current { color: #fff; font-size: 22px; font-weight: 700; margin: 20px 0; text-shadow: 0 0 20px rgba(255,255,255,0.3); transform: scale(1); }\n    .lrc-trans { display: block; font-size: 12px; color: rgba(255,255,255,0.6); margin-top: 2px; line-height: 1.2; font-weight: 400; }\n    .lrc-line.current .lrc-trans { font-size: 14px; color: rgba(255,255,255,0.85); margin-top: 5px; }\n    .ne-controls-area { position: relative; z-index: 5; padding: 0 25px 40px 25px; display: flex; flex-direction: column; gap: 20px; margin-top: auto; }\n    .ne-progress-bar-box { display: flex; align-items: center; gap: 10px; font-size: 10px; color: rgba(255,255,255,0.5); font-variant-numeric: tabular-nums;}\n    .ne-timeline { flex: 1; height: 4px; background: rgba(255,255,255,0.2); position: relative; border-radius: 2px; cursor: pointer; overflow:hidden;}\n    .ne-timeline:hover { height: 6px; }\n    .ne-timeline-active { width: 0%; height: 100%; background: #fff; border-radius: 2px; pointer-events: none;}\n    .ne-play-controls { display: flex; justify-content: space-between; align-items: center; font-size: 26px; color: #fff; padding: 0 10px;}\n    .ne-btn-play { width: 65px; height: 65px; border-radius: 50%; background: #fff; color: #000; display: flex; align-items: center; justify-content: center; font-size: 28px; box-shadow: 0 5px 20px rgba(255,255,255,0.3); transition: transform 0.1s; cursor: pointer; padding-left: 3px; }\n    .ne-btn-play:active { transform: scale(0.95); }\n    .ctrl-icon { cursor: pointer; opacity: 0.8; transition: opacity 0.2s; display: flex; align-items: center; }\n    #ne-view-library { position: absolute; top:0; left:0; right:0; bottom:0; background: rgba(0,0,0,0.85); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); z-index: 20; display: none; flex-direction: column; padding-top: var(--status-bar-height); }\n    .lib-header-row { display: flex; align-items: center; gap: 10px; padding: 10px 15px 15px 15px; }\n    .lib-btn-back { width: 32px; height: 32px; display: flex; justify-content: center; align-items: center; color: #fff; border-radius: 50%; background: rgba(255,255,255,0.1); cursor: pointer; }\n    .lib-search-box { flex: 1; height: 36px; background: rgba(255,255,255,0.1); border-radius: 10px; display: flex; align-items: center; padding: 0 10px; color: #fff; border: 1px solid rgba(255,255,255,0.05); }\n    .lib-search-input { background: transparent; border: none; color: #fff; font-size: 14px; width: 100%; outline: none; margin-left: 8px;}\n    .lib-search-input::-webkit-search-cancel-button { -webkit-appearance: none; appearance: none; height: 16px; width: 16px; background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='white'%3E%3Cpath d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/%3E%3C/svg%3E\"); cursor: pointer; }\n    .lib-btn-search { padding: 0 12px; height: 36px; display: flex; align-items: center; justify-content: center; background: rgba(255, 255, 255, 0.15); color: #dedede; font-size: 13px; font-weight: 600; border-radius: 10px; cursor: pointer; border: 1px solid rgba(255,255,255,0.1); }\n    .lib-btn-search:active { background: rgba(255, 255, 255, 0.25); }\n    .lib-list { flex: 1; overflow-y: auto; padding: 0 20px 80px 20px; }\n    .lib-item { display: flex; align-items: center; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); color: rgba(255,255,255,0.8); font-size: 14px; }\n    .lib-item.active { color: #fecc58; }\n    .lib-item-info { flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; display: flex; flex-direction: column; gap: 3px;}\n    .lib-item-sub { font-size: 11px; color: rgba(255,255,255,0.4); }\n    .s-tag { font-size: 9px; padding: 1px 3px; color: #fff; border-radius: 2px; margin-right: 4px; display:inline-block; vertical-align: middle; }\n    .st-wy { background: #c20c0c; } .st-qq { background: #22a338; } .st-kg { background: #0096e6; }\n    .lib-del-btn svg { fill: #ffffff !important; opacity: 1 !important; }\n</style>\n\n<svg style=\"position: absolute; width: 0; height: 0; overflow: hidden;\" aria-hidden=\"true\">\n  <defs>\n    <linearGradient id=\"batteryFlow\" x1=\"0%\" y1=\"100%\" x2=\"0%\" y2=\"0%\">\n      <stop offset=\"0%\" style=\"stop-color:#ffffff; stop-opacity:1\" />\n      <stop offset=\"60%\" style=\"stop-color:#ffffff; stop-opacity:0.8\" />\n      <stop offset=\"100%\" style=\"stop-color:#ffffff; stop-opacity:0\" />\n    </linearGradient>\n  </defs>\n</svg>\n\n<div class=\"iphone-frame nova-os-v48\" id=\"nova-phone-container\">\n    <span id=\"music-meta-data\" data-song=\"$3\" data-artist=\"$4\" style=\"display:none;\"></span>\n    <input type=\"file\" id=\"nova-wallpaper-input\" style=\"display:none;\" accept=\"image/*\" onchange=\"NovaOS.handleFileSelect(this, 'wallpaper')\">\n    <input type=\"file\" id=\"nova-icon-input\" style=\"display:none;\" accept=\"image/*\" onchange=\"NovaOS.handleFileSelect(this, 'icon')\">\n    <input type=\"file\" id=\"nova-avatar-input\" style=\"display:none;\" accept=\"image/*\" onchange=\"NovaOS.handleFileSelect(this, 'avatar')\">\n    <input type=\"file\" id=\"nova-cover-input\" style=\"display:none;\" accept=\"image/*\" onchange=\"NovaOS.handleFileSelect(this, 'cover')\">\n\n    <div class=\"dynamic-island\" onclick=\"NovaOS.showThoughts()\"></div>\n\n    <div class=\"thoughts-modal-layer\" id=\"thoughts-layer\" onclick=\"NovaOS.hideThoughts()\">\n        <div class=\"thoughts-bubble\" onclick=\"event.stopPropagation()\">\n            <div class=\"thoughts-title\">Внутренние мысли</div>\n            <div class=\"thoughts-content\">$18</div>\n            <div class=\"thoughts-tip\">Нажмите вне для закрытия</div>\n        </div>\n    </div>\n\n    <div class=\"secret-msg-layer\" id=\"secret-layer\" onclick=\"NovaMusic.hideSecretMsg()\">\n        <div class=\"secret-msg-box\" onclick=\"event.stopPropagation()\">\n            <div class=\"secret-deco-line\"></div>\n            <div class=\"secret-text\">$19</div>\n            <div class=\"secret-close\" onclick=\"NovaMusic.hideSecretMsg()\">ЗАКРЫТЬ</div>\n        </div>\n    </div>\n\n    <div class=\"status-bar\" id=\"nova-status-bar\">\n        <span>$1</span>\n        <div style=\"display: flex; gap: 6px; align-items: center;\">\n            <svg class=\"ico-sm\" viewBox=\"0 0 24 24\" fill=\"#FFFFFF\"><path d=\"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z\"/></svg>\n            <span style=\"font-size:12px;\">$2</span>\n            <svg class=\"ico-sm\" viewBox=\"0 0 24 24\" style=\"stroke: white; stroke-width: 1.5px; fill: url(#batteryFlow);\">\n                <path d=\"M15.67 4H14V2h-4v2H8.33C7.6 4 7 4.6 7 5.33v15.33C7 21.4 7.6 22 8.33 22h7.33c.74 0 1.34-.6 1.34-1.33V5.33C17 4.6 16.4 4 15.67 4z\"/>\n            </svg>\n        </div>\n    </div>\n\n    <div class=\"home-screen\"\n         onmousedown=\"NovaOS.bindLongPress(this, 'wallpaper', event)\" onmouseup=\"NovaOS.clearLongPress()\"\n         ontouchstart=\"NovaOS.bindLongPress(this, 'wallpaper', event)\" ontouchend=\"NovaOS.clearLongPress()\">\n        <div class=\"icon-grid\">\n            <div class=\"app-icon-wrapper\" onclick=\"NovaOS.openApp('app-memo')\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"memo\" style=\"background-image: url('https://files.catbox.moe/h4dze6.jpeg');\"></div><div class=\"app-label\">Заметки</div></div>\n            <div class=\"app-icon-wrapper\" onclick=\"NovaOS.openApp('app-forum')\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"forum\" style=\"background-image: url('https://files.catbox.moe/l8pfxg.jpeg');\"></div><div class=\"app-label\">Форум</div></div>\n            <div class=\"app-icon-wrapper\" onclick=\"NovaOS.openApp('app-gemini')\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"gemini\" style=\"background-image: url('https://files.catbox.moe/uxfw6g.jpeg');\"></div><div class=\"app-label\">Gemini</div></div>\n            <div class=\"app-icon-wrapper\" onclick=\"NovaOS.openApp('app-diary')\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"diary\" style=\"background-image: url('https://files.catbox.moe/egmjpm.jpeg');\"></div><div class=\"app-label\">Дневник</div></div>\n        </div>\n        <div class=\"dock\">\n            <div class=\"app-icon-wrapper\" style=\"margin-top:5px;\" onclick=\"NovaOS.openApp('app-wechat')\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"wechat\" style=\"background-image: url('https://files.catbox.moe/8b90bc.jpeg');\"></div></div>\n            <div class=\"app-icon-wrapper\" style=\"margin-top:5px;\" onclick=\"NovaOS.openApp('app-music-netease')\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"music\" style=\"background-image: url('https://files.catbox.moe/47fzq1.jpeg');\"></div></div>\n            <div class=\"app-icon-wrapper\" style=\"margin-top:5px;\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"settings\" style=\"background-image: url('https://files.catbox.moe/ask96n.jpeg');\"></div></div>\n            <div class=\"app-icon-wrapper\" style=\"margin-top:5px;\" onmousedown=\"NovaOS.bindLongPress(this, 'icon', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'icon', event)\" ontouchend=\"NovaOS.clearLongPress()\"><div class=\"app-icon\" data-id=\"phone\" style=\"background-image: url('https://files.catbox.moe/o7hxk9.jpeg');\"></div></div>\n        </div>\n    </div>\n\n    <div id=\"app-music-netease\" class=\"app-window music-app-container\">\n        <div class=\"ne-bg-layer\" id=\"ne-dynamic-bg\"></div>\n        <audio id=\"hidden-player\" crossorigin=\"anonymous\"></audio>\n        <div class=\"app-nav\">\n            <div class=\"nav-back\" onclick=\"event.stopPropagation(); NovaOS.closeApp('app-music-netease')\"><svg viewBox=\"0 0 24 24\"><path d=\"M7.41 8.59L12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z\"/></svg></div>\n            <div class=\"nav-title-box\"><div class=\"music-title\" id=\"ne-title\">Не играет</div><div class=\"music-artist-nav\" id=\"ne-artist\">...</div></div>\n            <div class=\"nav-action\"><div class=\"infinite-btn\" onclick=\"NovaMusic.toggleLyrics()\">∞</div></div>\n        </div>\n        <div id=\"ne-view-library\">\n            <div class=\"lib-header-row\">\n                 <div class=\"lib-btn-back\" onclick=\"NovaMusic.toggleLibrary()\"><svg style=\"width:20px;height:20px;fill:#fff;\" viewBox=\"0 0 24 24\"><path d=\"M11.67 3.87L9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z\"/></svg></div>\n                 <div class=\"lib-search-box\">\n                    <svg style=\"width:18px;height:18px;fill:rgba(255,255,255,0.5);\" viewBox=\"0 0 24 24\"><path d=\"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z\"/></svg>\n                    <form action=\"javascript:void(0);\" onsubmit=\"NovaMusic.doSearch(); document.getElementById('ne-search-input').blur(); return false;\" style=\"flex:1; display:flex; align-items:center; background:transparent; padding:0; margin:0; border:none;\">\n                        <input type=\"search\" inputmode=\"search\" class=\"lib-search-input\" id=\"ne-search-input\" placeholder=\"Введите название, исполнителя...\" onkeydown=\"event.stopPropagation();\" onkeyup=\"event.stopPropagation();\">\n                    </form>\n                 </div>\n                 <div class=\"lib-btn-search\" onclick=\"NovaMusic.doSearch()\">Поиск</div>\n            </div>\n            <div class=\"lib-list\" id=\"ne-lib-list\"></div>\n        </div>\n        <div class=\"ne-main-view\">\n            <div class=\"ne-listen-together\">\n                <div class=\"ne-listen-avatar\" id=\"listen-avatar-p1\" data-key=\"p1\" style=\"background-image:url('https://api.dicebear.com/7.x/notionists/svg?seed=Felix');\" onmousedown=\"NovaOS.bindLongPress(this, 'avatar', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'avatar', event)\" ontouchend=\"NovaOS.clearLongPress()\"></div>\n                <div class=\"ne-heartbeat-line\" onclick=\"NovaMusic.showSecretMsg()\"><svg class=\"ne-heartbeat-svg\" viewBox=\"0 0 100 20\" preserveAspectRatio=\"none\"><path d=\"M0,10 L30,10 L35,2 L40,18 L45,5 L50,15 L55,10 L100,10\" vector-effect=\"non-scaling-stroke\"></path></svg></div>\n                <div class=\"ne-listen-avatar\" id=\"listen-avatar-p2\" data-key=\"p2\" style=\"background-image:url('https://api.dicebear.com/7.x/notionists/svg?seed=Nova');\" onmousedown=\"NovaOS.bindLongPress(this, 'avatar', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'avatar', event)\" ontouchend=\"NovaOS.clearLongPress()\"></div>\n            </div>\n            <div class=\"ne-view-player\" id=\"ne-disc-area\"><div class=\"ne-disc-container\" id=\"ne-disc\"><div class=\"ne-disc-grooves\"><div class=\"ne-album-art\" id=\"ne-cover\" style=\"background-image:url('https://files.catbox.moe/k265vj.png');\" onmousedown=\"NovaOS.bindLongPress(this, 'cover', event)\" onmouseup=\"NovaOS.clearLongPress()\" ontouchstart=\"NovaOS.bindLongPress(this, 'cover', event)\" ontouchend=\"NovaOS.clearLongPress()\"></div></div></div><div class=\"ne-view-lyrics\" id=\"ne-lyrics-box\"><div class=\"lrc-line\">Нажмите ∞ справа для переключения</div></div></div>\n            <div class=\"ne-controls-area\">\n                <div class=\"ne-progress-bar-box\"><span id=\"ne-curr-time\">0:00</span><div class=\"ne-timeline\" id=\"ne-progress-wrap\"><div class=\"ne-timeline-active\" id=\"ne-progress-fill\"></div></div><span id=\"ne-total-time\">0:00</span></div>\n                <div class=\"ne-play-controls\">\n                    <div class=\"ctrl-icon\" id=\"btn-mode\" onclick=\"NovaMusic.toggleMode()\"><svg class=\"ico-svg\" viewBox=\"0 0 24 24\"><path d=\"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z\"/></svg></div>\n                    <div class=\"ctrl-icon\" onclick=\"NovaMusic.prev()\"><svg class=\"ico-svg\" viewBox=\"0 0 24 24\"><path d=\"M6 6h2v12H6zm3.5 6l8.5 6V6z\"/></svg></div>\n                    <div class=\"ne-btn-play\" id=\"btn-play-pause\" onclick=\"NovaMusic.togglePlay()\"><svg style=\"width:28px;height:28px;\" viewBox=\"0 0 24 24\"><path d=\"M8 5v14l11-7z\"/></svg></div>\n                    <div class=\"ctrl-icon\" onclick=\"NovaMusic.next()\"><svg class=\"ico-svg\" viewBox=\"0 0 24 24\"><path d=\"M6 18l8.5-6L6 6v12M16 6v12h2V6h-2z\"/></svg></div>\n                    <div class=\"ctrl-icon\" onclick=\"NovaMusic.toggleLibrary()\"><svg class=\"ico-svg\" viewBox=\"0 0 24 24\"><path d=\"M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z\"/></svg></div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div id=\"app-diary\" class=\"app-window\"><div class=\"app-nav\"><div class=\"nav-back\" onclick=\"NovaOS.closeApp('app-diary')\">✕</div></div><div class=\"app-body\"><div class=\"diary-layout\"><div class=\"diary-art-header\"><span class=\"diary-eng-deco\">ОТГОЛОСКИ РАЗУМА</span><span class=\"diary-eng-sub\">Архивная запись // Зашифровано</span></div><div class=\"diary-text-body\">$10</div><div class=\"diary-footer-art\"><div class=\"diary-sign\">{{char}}</div><div class=\"diary-date-stamp\">ЗАПИСАНО $9</div></div></div></div></div>\n    <div id=\"app-wechat\" class=\"app-window\"><div class=\"app-nav\"><div class=\"nav-back\" onclick=\"NovaOS.closeApp('app-wechat')\">‹ WeChat</div><div class=\"nav-title\">Сообщения</div><div class=\"nav-action\">···</div></div><div class=\"app-body\"><div class=\"chat-container\" id=\"wechat-content\"><div id=\"wechat-raw-data\" style=\"display:none;\">$8</div></div></div></div>\n    <div id=\"app-memo\" class=\"app-window\"><div class=\"app-nav\"><div class=\"nav-back\" onclick=\"NovaOS.closeApp('app-memo')\">Список</div><div class=\"nav-action\">...</div></div><div class=\"app-body\"><div class=\"memo-header\"></div><div class=\"memo-list\"><div class=\"memo-item\"><div class=\"memo-check\"></div><div class=\"memo-text\">$5</div></div><div class=\"memo-item\"><div class=\"memo-check\"></div><div class=\"memo-text\">$6</div></div><div class=\"memo-item\"><div class=\"memo-check\"></div><div class=\"memo-text\">$7</div></div></div></div></div>\n    <div id=\"app-forum\" class=\"app-window\"><div class=\"app-nav\"><div class=\"nav-back\" onclick=\"NovaOS.closeApp('app-forum')\">‹ Обзор</div><div class=\"nav-title\">Популярные посты</div></div><div class=\"app-body\"><div class=\"forum-post-card\"><div class=\"forum-tag\">СРОЧНАЯ НОВОСТЬ</div><h2 class=\"forum-title\">$11</h2><div class=\"forum-text\">$12</div><div class=\"forum-meta\"><span>Только что опубликовано</span></div></div><div class=\"forum-comments-section\"><div class=\"forum-section-label\">Все комментарии</div><div class=\"comment-bubble\">$13</div><div class=\"comment-bubble\">$14</div><div class=\"comment-bubble\">$15</div></div></div></div>\n    <div id=\"app-gemini\" class=\"app-window\"><div class=\"app-nav\"><div class=\"nav-back\" onclick=\"NovaOS.closeApp('app-gemini')\">✕</div><div class=\"nav-title\">Gemini Расширенный</div></div><div class=\"app-body\" style=\"padding:20px;\"><div style=\"display:flex; margin-bottom:20px; justify-content:flex-end;\"><div style=\"background:#007aff; color:white; padding:12px 16px; border-radius:18px 18px 4px 18px; max-width:85%; font-size:16px;\">$16</div></div><div style=\"display:flex; gap:12px;\"><div style=\"min-width:30px; height:30px; font-size:24px;\">✨</div><div style=\"background:#f0f0f0; padding:14px 18px; border-radius:4px 18px 18px 18px; color:#333; line-height:1.6; font-size:16px;\">$17</div></div></div></div>\n</div>\n\n<script>\nvar NovaOS = NovaOS || {\n    longPressTimer: null, currentEditTarget: null, currentEditType: null,\n    init: function() { this.loadWallpaper(); this.loadIcons(); this.loadAvatars(); this.renderWeChat(); },\n    showThoughts: function() { document.getElementById('thoughts-layer')?.classList.add('show'); },\n    hideThoughts: function() { document.getElementById('thoughts-layer')?.classList.remove('show'); },\n    openApp: function(appId) {\n        if(this.longPressTimer) return;\n        const phone = document.getElementById('nova-phone-container');\n        document.querySelectorAll('.app-window.active').forEach(w => w.classList.remove('active'));\n        phone.classList.add('app-active');\n        if(appId === 'app-music-netease') phone.classList.add('music-active');\n        document.getElementById(appId)?.classList.add('active');\n    },\n    closeApp: function(appId) {\n        const phone = document.getElementById('nova-phone-container');\n        document.getElementById(appId)?.classList.remove('active');\n        phone.classList.remove('app-active', 'music-active');\n    },\n    bindLongPress: function(element, type, event) { event.stopPropagation(); this.currentEditTarget = element; this.currentEditType = type; if (this.longPressTimer) clearTimeout(this.longPressTimer); this.longPressTimer = setTimeout(() => { if(type === 'wallpaper') document.getElementById('nova-wallpaper-input').click(); else if (type === 'icon') document.getElementById('nova-icon-input').click(); else if (type === 'avatar') document.getElementById('nova-avatar-input').click(); else if (type === 'cover') document.getElementById('nova-cover-input').click(); this.longPressTimer = null; }, 800); },\n    clearLongPress: function() { if(this.longPressTimer) { clearTimeout(this.longPressTimer); this.longPressTimer = null; } },\n    handleFileSelect: function(input, type) { if (input.files && input.files[0]) { const reader = new FileReader(); const _this = this; reader.onload = function(e) { const base64 = e.target.result; if(type === 'wallpaper') { _this.setWallpaper(base64); _this.saveToStorage('nova_wallpaper', base64); } else if (type === 'icon' && _this.currentEditTarget) { const iconDiv = _this.currentEditTarget.querySelector('.app-icon'); if(iconDiv) { _this.setIcon(iconDiv, base64); const key = iconDiv.getAttribute('data-id'); if(key) _this.saveToStorage('nova_icon_' + key, base64); } } else if (type === 'avatar' && _this.currentEditTarget) { _this.setAvatar(_this.currentEditTarget, base64); const key = _this.currentEditTarget.getAttribute('data-key'); if(key) _this.saveToStorage('nova_avatar_' + key, base64); } else if (type === 'cover') { const coverEl = document.getElementById('ne-cover'); const bgEl = document.getElementById('ne-dynamic-bg'); if(coverEl) coverEl.style.backgroundImage = `url(${base64})`; if(bgEl) bgEl.style.backgroundImage = `url(${base64})`; } }; reader.readAsDataURL(input.files[0]); } },\n    saveToStorage: function(key, value) { try { localStorage.setItem(key, value); } catch(e) {} },\n    loadWallpaper: function() { const saved = localStorage.getItem('nova_wallpaper'); if(saved) this.setWallpaper(saved); },\n    loadIcons: function() { document.querySelectorAll('.app-icon').forEach(icon => { const key = icon.getAttribute('data-id'); if(key) { const saved = localStorage.getItem('nova_icon_' + key); if(saved) this.setIcon(icon, saved); } }); },\n    loadAvatars: function() { ['p1', 'p2'].forEach(key => { const savedAvatar = localStorage.getItem('nova_avatar_' + key); const el = document.querySelector(`.ne-listen-avatar[data-key=\"${key}\"]`); if(savedAvatar && el) this.setAvatar(el, savedAvatar); }); },\n    setWallpaper: function(src) { const frame = document.getElementById('nova-phone-container'); if(frame) frame.style.backgroundImage = `url(${src})`; },\n    setIcon: function(ele, src) { ele.style.backgroundImage = `url(${src})`; ele.style.backgroundSize = 'cover'; ele.innerHTML = ''; },\n    setAvatar: function(ele, src) { ele.style.backgroundImage = `url(${src})`; },\n    renderWeChat: function() { const rawDiv = document.getElementById('wechat-raw-data'); const container = document.getElementById('wechat-content'); if(!rawDiv || !container) return; let rawData = rawDiv.innerText.trim(); container.innerHTML = ''; if(!rawData) { container.innerHTML = '<div style=\"text-align:center;color:#999;margin-top:20px;\">无Сообщения</div>'; return; } const messages = rawData.split('##'); messages.forEach(msg => { const splitIndex = msg.indexOf(':'); if (splitIndex === -1) return; const name = msg.substring(0, splitIndex).trim(); const text = msg.substring(splitIndex + 1).trim(); if (!text) return; const isЯ = (name === 'Я' || name === 'Я' || name === '{{char}}'); const avatarUrl = isЯ ? 'https://files.catbox.moe/k265vj.png' : `https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(name)}&backgroundColor=e6e6e6`; if (isЯ) { container.insertAdjacentHTML('beforeend', `<div class=\"chat-row me\"><div class=\"chat-avatar my-avatar\" style=\"background-image: url('${avatarUrl}')\"></div><div class=\"chat-content-box\"><div class=\"bubble right\">${text}</div></div></div>`); } else { container.insertAdjacentHTML('beforeend', `<div class=\"chat-row other\"><div class=\"chat-avatar\" style=\"background-image: url('${avatarUrl}')\"></div><div class=\"chat-content-box\"><div class=\"chat-name\">${name}</div><div class=\"bubble left\">${text}</div></div></div>`); } }); setTimeout(() => { const appBody = document.querySelector('#app-wechat .app-body'); if(appBody) appBody.scrollTop = appBody.scrollHeight; }, 100); }\n};\nvar NovaMusic = (function() {\n    const els = {}; const channel = new BroadcastChannel('ipod_global_mesh'); const myId = Date.now().toString();\n    const STORAGE_KEY = 'nova_music_v39_state'; const DEFAULT_COVER = 'https://files.catbox.moe/k265vj.png';\n    const State = { queue: [], qIdx: 0, playMode: 0, currLrc: [], isLyicView: false, isLibraryOpen: false, isUserScrolling: false };\n    let audio = null; let userScrollTimer = null;\n    function init() {\n        audio = document.getElementById('hidden-player');\n        els.title = document.getElementById('ne-title'); els.artist = document.getElementById('ne-artist'); els.cover = document.getElementById('ne-cover'); els.bg = document.getElementById('ne-dynamic-bg'); els.disc = document.getElementById('ne-disc'); els.playBtn = document.getElementById('btn-play-pause'); els.timeCur = document.getElementById('ne-curr-time'); els.timeTot = document.getElementById('ne-total-time'); els.progFill = document.getElementById('ne-progress-fill'); els.progWrap = document.getElementById('ne-progress-wrap'); els.lrcBox = document.getElementById('ne-lyrics-box'); els.libView = document.getElementById('ne-view-library'); els.libList = document.getElementById('ne-lib-list'); els.searchInp = document.getElementById('ne-search-input');\n        channel.onmessage = (e) => { if (e.data.type === 'SILENCE' && e.data.id !== myId) audio.pause(); }; channel.postЯssage({ type: 'SILENCE', id: myId });\n        audio.ontimeupdate = updateProgress; audio.onended = autoNext; audio.onplay = () => { updatePlayIcon(true); els.disc.classList.add('playing'); channel.postЯssage({ type: 'SILENCE', id: myId }); }; audio.onpause = () => { updatePlayIcon(false); els.disc.classList.remove('playing'); };\n        els.progWrap.onclick = (e) => { if(audio.duration) audio.currentTime = (e.offsetX / els.progWrap.offsetWidth) * audio.duration; };\n        els.lrcBox.addEventListener('scroll', () => { State.isUserScrolling = true; clearTimeout(userScrollTimer); userScrollTimer = setTimeout(() => { State.isUserScrolling = false; }, 3000); });\n        els.lrcBox.addEventListener('touchstart', () => { State.isUserScrolling = true; });\n\n        const metaTitle = document.getElementById('music-meta-data').dataset.song; const metaArtist = document.getElementById('music-meta-data').dataset.artist;\n        try { const s = localStorage.getItem(STORAGE_KEY); if(s) { const j = JSON.parse(s); State.queue = j.queue || []; State.qIdx = j.qIdx || 0; State.playMode = j.playMode || 0; } } catch {}\n        if(metaTitle && !State.queue.some(x=>x.name===metaTitle)) { State.queue.unshift({name:metaTitle, artist:metaArtist, source:'', id:''}); }\n        updateModeIcon(); if(State.queue.length) loadTrack(false); else { els.bg.style.backgroundImage = `url('${DEFAULT_COVER}')`; } renderLibrary();\n    }\n    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify({ queue: State.queue, qIdx: State.qIdx, playMode: State.playMode })); }\n    function updatePlayIcon(isPlaying) { const playPath = \"M8 5v14l11-7z\"; const pausePath = \"M6 19h4V5H6v14zm8-14v14h4V5h-4z\"; els.playBtn.innerHTML = `<svg style=\"width:28px;height:28px;\" viewBox=\"0 0 24 24\"><path d=\"${isPlaying ? pausePath : playPath}\"/></svg>`; }\n    async function loadTrack(autoPlay) { if(!State.queue[State.qIdx]) return; const item = State.queue[State.qIdx]; els.title.innerText = item.name; els.artist.innerText = item.artist; els.lrcBox.innerHTML = '<div class=\"lrc-line\">Загрузка...</div>'; const defUrl = `url('${DEFAULT_COVER}')`; els.cover.style.backgroundImage = defUrl; els.bg.style.backgroundImage = defUrl; const api = 'https://music-api.gdstudio.xyz/api.php'; let trackId = item.id; let source = item.source ? item.source.replace('gd_', '') : ''; if(!trackId) { const sources = ['netease','tencent','kugou']; for(let src of sources) { try { const sRes = await fetch(`${api}?types=search&count=1&source=${src}&name=${encodeURIComponent(item.name+' '+item.artist)}`).then(r=>r.json()); if(sRes && sRes[0]) { trackId = sRes[0].id; source = src; item.id = trackId; item.source = 'gd_'+src; item.coverId = sRes[0].pic_id; save(); break; } } catch {} } } if(trackId) { try { const picId = item.coverId || trackId; const p = await fetch(`${api}?types=pic&id=${picId}&source=${source}`).then(r=>r.json()); if(p.url) { const bgUrl = `url('${p.url}')`; els.cover.style.backgroundImage = bgUrl; els.bg.style.backgroundImage = bgUrl; } } catch {} try { const [uRes, lRes] = await Promise.all([fetch(`${api}?types=url&id=${trackId}&source=${source}`).then(r=>r.json()).catch(()=>({})), fetch(`${api}?types=lyric&id=${trackId}&source=${source}`).then(r=>r.json()).catch(()=>({}))]); if(uRes.url) { audio.src = uRes.url; parseLrc(lRes.lyric, lRes.tlyric); if(autoPlay) audio.play().catch(e=>console.log(e)); } else { autoNext(); } } catch {} } renderLibrary(); }\n    function parseLrc(raw, tRaw) { State.currLrc = []; if(!raw) { els.lrcBox.innerHTML = '<div class=\"lrc-line\">Инструментал / Нет текста</div>'; return; } const mapT = {}; if(tRaw) tRaw.split('\\n').forEach(l => { const m = l.match(/^\\[(\\d{2}):(\\d{2}\\.\\d+)\\](.*)/); if(m) mapT[(parseInt(m[1])*60 + parseFloat(m[2])).toFixed(1)] = m[3]; }); raw.split('\\n').forEach(l => { const m = l.match(/^\\[(\\d{2}):(\\d{2}\\.\\d+)\\](.*)/); if(m) { State.currLrc.push({ t: parseInt(m[1])*60 + parseFloat(m[2]), txt: m[3].trim(), tr: mapT[(parseInt(m[1])*60 + parseFloat(m[2])).toFixed(1)]||'' }); } }); els.lrcBox.innerHTML = ''; State.currLrc.forEach(item => { const d = document.createElement('div'); d.className='lrc-line'; d.innerHTML = `${item.txt}${item.tr ? `<span class=\"lrc-trans\">${item.tr}</span>` : ''}`; d.onclick = (e) => { e.stopPropagation(); audio.currentTime = item.t; audio.play(); State.isUserScrolling = false; }; els.lrcBox.appendChild(d); }); }\n    function updateProgress() { if(!audio.duration) return; const per = (audio.currentTime/audio.duration*100)+'%'; els.progFill.style.width = per; els.timeCur.innerText = fmtTime(audio.currentTime); els.timeTot.innerText = fmtTime(audio.duration); if(State.isLyicView && State.currLrc.length) { let idx = State.currLrc.findIndex(x => x.t > audio.currentTime) - 1; if(idx < 0) idx = 0; const lines = els.lrcBox.querySelectorAll('.lrc-line'); lines.forEach((l,i) => l.classList.toggle('current', i===idx)); if(!State.isUserScrolling && lines[idx]) { els.lrcBox.scrollTo({ top: lines[idx].offsetTop - els.lrcBox.clientHeight/2 + 30, behavior: 'smooth' }); } } }\n    function fmtTime(s) { return `${Math.floor(s/60)}:${Math.floor(s%60).toString().padStart(2,'0')}`; } function togglePlay() { audio.paused ? audio.play() : audio.pause(); } function prev() { if(!State.queue.length) return; State.qIdx = (State.qIdx - 1 + State.queue.length) % State.queue.length; loadTrack(true); } function next() { manualNext(); } function autoNext() { if(State.playMode === 2) { audio.currentTime = 0; audio.play(); return; } advance(); } function manualNext() { advance(); } function advance() { if(!State.queue.length) return; if(State.playMode === 1) { let n = Math.floor(Math.random() * State.queue.length); State.qIdx = n; } else { State.qIdx = (State.qIdx + 1) % State.queue.length; } loadTrack(true); } function toggleMode() { State.playMode = (State.playMode + 1) % 3; updateModeIcon(); save(); }\n    function updateModeIcon() { const paths = [\"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z\",\"M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z\",\"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z\"]; const colors = ['#fff', '#fecc58', '#fecc58']; const icon = document.getElementById('btn-mode'); icon.innerHTML = `<svg class=\"ico-svg\" viewBox=\"0 0 24 24\"><path d=\"${paths[State.playMode]}\"/></svg>`; icon.style.color = colors[State.playMode]; if(State.playMode === 2) { icon.innerHTML += '<span style=\"font-size:10px;position:absolute;top:6px;left:10px;font-weight:900;color:#000;\">1</span>'; } }\n    function toggleLyrics() { State.isLyicView = !State.isLyicView; document.getElementById('ne-disc').classList.toggle('hidden', State.isLyicView); document.getElementById('ne-lyrics-box').classList.toggle('show', State.isLyicView); }\n    function toggleLibrary() { State.isLibraryOpen = !State.isLibraryOpen; els.libView.style.display = State.isLibraryOpen ? 'flex' : 'none'; if(State.isLibraryOpen) renderLibrary(); }\n    async function doSearch() { const q = els.searchInp.value.trim(); if(!q) return; els.libList.innerHTML = '<div style=\"color:#aaa;text-align:center;padding:20px;\">Проверка...</div>'; const api = 'https://music-api.gdstudio.xyz/api.php'; let list = []; const sources = ['netease','tencent','kugou']; const tasks = sources.map(s => fetch(`${api}?types=search&count=20&source=${s}&name=${encodeURIComponent(q)}`).then(r=>r.json()).then(d=>(Array.isArray(d)?d:[]).map(x=>({name:x.name,artist:(x.artist||[]).join('/'),source:'gd_'+s,id:x.id,coverId:x.pic_id}))).catch(()=>[])); (await Promise.all(tasks)).forEach(a=>list.push(...a)); els.libList.innerHTML = ''; if(list.length === 0) { els.libList.innerHTML = '<div style=\"color:#aaa;text-align:center;padding:20px;\">Ничего не найдено.</div>'; return; } list.forEach(item => { const div = document.createElement('div'); div.className = 'lib-item'; let srcShort = item.source.replace('gd_','').substring(0,2).toUpperCase(); let srcClass = item.source.includes('netease')?'st-wy':(item.source.includes('tencent')?'st-qq':'st-kg'); div.innerHTML = `<div class=\"lib-item-info\"><div>${item.name}</div><div class=\"lib-item-sub\"><span class=\"s-tag ${srcClass}\">${srcShort}</span>${item.artist}</div></div><div class=\"lib-add-btn\">+</div>`; div.querySelector('.lib-add-btn').onclick = (e) => { e.stopPropagation(); State.queue.push(item); save(); e.target.innerText = '✓'; setTimeout(()=>e.target.innerText='+', 1000); }; div.onclick = () => { State.queue.push(item); State.qIdx = State.queue.length - 1; save(); loadTrack(true); toggleLibrary(); els.searchInp.value = ''; }; els.libList.appendChild(div); }); }\n    function renderLibrary() { if(els.searchInp.value) return; els.libList.innerHTML = ''; if(!State.queue.length) { els.libList.innerHTML = '<div style=\"color:#aaa;text-align:center;padding:20px;\">Очередь пуста</div>'; return; } State.queue.forEach((item, i) => { const div = document.createElement('div'); div.className = `lib-item ${i===State.qIdx?'active':''}`; div.innerHTML = `<div class=\"lib-item-info\"><div>${item.name}</div><div class=\"lib-item-sub\">${item.artist}</div></div><div class=\"lib-del-btn\" style=\"padding:0 10px;\" onclick=\"NovaMusic.del(${i}, event)\"><svg class=\"ico-sm\" viewBox=\"0 0 24 24\"><path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z\"/></svg></div>`; div.onclick = (e) => { if(e.target.closest('div[onclick*=\"NovaMusic.del\"]')) return; State.qIdx = i; loadTrack(true); }; els.libList.appendChild(div); }); }\n    function del(i, e) { e.stopPropagation(); State.queue.splice(i, 1); if(State.qIdx >= State.queue.length) State.qIdx = Math.max(0, State.queue.length - 1); save(); renderLibrary(); }\n    function showSecretMsg() { document.getElementById('secret-layer')?.classList.add('show'); }\n    function hideSecretMsg() { document.getElementById('secret-layer')?.classList.remove('show'); }\n    return { init, togglePlay, prev, next, toggleMode, toggleLyrics, toggleLibrary, del, doSearch, showSecretMsg, hideSecretMsg };\n})();\nsetTimeout(() => { NovaOS.init(); NovaMusic.init(); }, 100);\n</script>\n</body>\n</html>\n```",
    "trimStrings": [],
    "placement": [
        1,
        2
    ],
    "disabled": false,
    "markdownOnly": true,
    "promptOnly": false,
    "runOnEdit": true,
    "substituteRegex": 0,
    "minDepth": null,
    "maxDepth": null
}