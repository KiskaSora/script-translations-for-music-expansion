{
  "type": "script",
  "enabled": false,
  "name": "Ретро плеер (RU)",
  "id": "1525a529-c648-4fc7-9daa-3c09ee45c44a",
  "content": "import'https://testingcf.jsdelivr.net/npm/vue3-draggable-resizable/dist/Vue3DraggableResizable.css/+esm';var n={314:n=>{n.exports=function(n){var e=n[1],t=n[3];if(!t)return e;if('function'==typeof btoa){var i=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),o='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(i),a='/*# '.concat(o,' */');return[e].concat([a]).join('\\n')}return[e].join('\\n')}},336:(n,e,t)=>{var i=t(380);i.__esModule&&(i=i.default),'string'==typeof i&&(i=[[n.id,i,'']]),i.locals&&(n.exports=i.locals);(0,t(424).A)('fb3bd178',i,!1,{ssrId:!0})},378:n=>{n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var t='',i=void 0!==e[5];return e[4]&&(t+='@supports ('.concat(e[4],') {')),e[2]&&(t+='@media '.concat(e[2],' {')),i&&(t+='@layer'.concat(e[5].length>0?' '.concat(e[5]):'',' {')),t+=n(e),i&&(t+='}'),e[2]&&(t+='}'),e[4]&&(t+='}'),t}).join('')},e.i=function(n,t,i,o,a){'string'==typeof n&&(n=[[null,n,void 0]]);var s={};if(i)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var d=0;d<n.length;d++){var c=[].concat(n[d]);i&&s[c[0]]||(void 0!==a&&(void 0===c[5]||(c[1]='@layer'.concat(c[5].length>0?' '.concat(c[5]):'',' {').concat(c[1],'}')),c[5]=a),t&&(c[2]?(c[1]='@media '.concat(c[2],' {').concat(c[1],'}'),c[2]=t):c[2]=t),o&&(c[4]?(c[1]='@supports ('.concat(c[4],') {').concat(c[1],'}'),c[4]=o):c[4]=''.concat(o)),e.push(c))}},e}},380:(n,e,t)=>{t.r(e),t.d(e,{default:()=>r});var i=t(314),o=t.n(i),a=t(378),s=t.n(a)()(o());s.push([n.id,'@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css);']),s.push([n.id,'@import url(https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap);']),s.push([n.id,'.lyrics-widget[data-v-62df65df]{position:absolute;top:20%;left:50%;transform:translate(-50%,-50%);width:100px;height:90px;padding:0;border-radius:0;box-shadow:none;background-image:url(\\'https://i.postimg.cc/y8bZ8mKH/Hello-World-Stickers-Sticker.png\\');background-size:contain;background-repeat:no-repeat;background-position:center;background-color:transparent;-webkit-user-select:none;user-select:none;cursor:grab;z-index:9999999;animation:floatAnim-62df65df 3s ease-in-out infinite;transition:width 0.3s,height 0.3s}@keyframes floatAnim-62df65df{0%,100%{transform:translate(-50%,-50%)}50%{transform:translate(-50%,-58%)}}.lyrics-widget:not(.expanded) .content[data-v-62df65df],.lyrics-widget:not(.expanded) .win-title-bar[data-v-62df65df]{display:none !important;opacity:0;pointer-events:none}.lyrics-widget.dragging[data-v-62df65df]{cursor:grabbing;animation-play-state:paused}.lyrics-widget.expanded[data-v-62df65df]{width:360px;height:auto;min-height:200px;background-image:url(\\'https://i.postimg.cc/YChxRq2x/xia-zai-(4).jpg\\');background-size:cover;background-position:center;background-color:#c0c0c0;border:2px solid #dfdfdf;border-right-color:#000;border-bottom-color:#000;box-shadow:inset 2px 2px #fff,inset -2px -2px #808080,4px 4px 10px rgba(0,0,0,0.5);border-radius:0;padding:2px;animation:none;cursor:default;display:flex;flex-direction:column}.win-title-bar[data-v-62df65df]{height:24px;background:navy;background:linear-gradient(90deg,navy,#1084d0);color:white;display:flex;align-items:center;justify-content:space-between;padding:0 4px;font-family:\\'Verdana\\',sans-serif;font-size:12px;font-weight:bold}.win-controls[data-v-62df65df]{display:flex;gap:2px}.win-btn[data-v-62df65df]{width:16px;height:14px;background:#c0c0c0;color:black;border-top:1px solid #fff;border-left:1px solid #fff;border-right:1px solid #000;border-bottom:1px solid #000;box-shadow:inset -1px -1px #808080;font-size:10px;line-height:12px;text-align:center;cursor:pointer;display:flex;align-items:center;justify-content:center}.win-btn[data-v-62df65df]:active{border-top:1px solid #000;border-left:1px solid #000;border-right:1px solid #fff;border-bottom:1px solid #fff;box-shadow:none;padding-top:2px;padding-left:2px}.win-btn.close[data-v-62df65df]{font-size:14px}.content[data-v-62df65df]{position:relative;display:flex;flex-direction:column;height:100%;padding:10px;background:rgba(255,255,255,0.7);backdrop-filter:blur(2px);border:1px solid #808080;border-right-color:#fff;border-bottom-color:#fff;box-shadow:inset 1px 1px #000;margin:2px}.display-area[data-v-62df65df]{min-height:80px;margin:10px 0;position:relative}.lyrics-box[data-v-62df65df]{text-align:center;font-family:\\'Microsoft YaHei\\',sans-serif;color:#000;min-height:60px;display:flex;flex-direction:column;justify-content:center}.lyric-line.current[data-v-62df65df]{font-size:18px;font-weight:bold;color:#000;text-shadow:0 0 2px #fff}.lyric-line.next[data-v-62df65df]{font-size:14px;color:#333;margin-top:5px}.playlist-box[data-v-62df65df]{display:flex;flex-direction:column;gap:8px;height:150px}.win-search-row[data-v-62df65df]{display:flex;gap:4px}.win-input[data-v-62df65df]{flex:1;background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;font-family:\\'Microsoft YaHei\\',sans-serif;font-size:12px;padding:2px 4px;outline:none;color:#000}.btn-sm[data-v-62df65df]{min-width:30px;font-size:11px;height:22px}.win-list-container[data-v-62df65df]{flex:1;background:#fff;border:2px solid;border-color:#808080 #fff #fff #808080;overflow-y:auto;overflow-x:hidden}.win-list[data-v-62df65df]{list-style:none;padding:0;margin:0}.win-list-item[data-v-62df65df]{padding:2px 4px;font-size:12px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;color:#000;font-family:\\'Tahoma\\',sans-serif}.win-list-item[data-v-62df65df]:hover{text-decoration:underline}.win-list-item.selected[data-v-62df65df]{background-color:#000080;color:#fff}.win-list-item.selected[data-v-62df65df]:hover{text-decoration:none}.item-text[data-v-62df65df]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1}.item-close[data-v-62df65df]{padding:0 4px;font-weight:bold;cursor:pointer}.item-close[data-v-62df65df]:hover{color:red}.win-list-item.selected .item-close[data-v-62df65df]:hover{color:#ffff00}.win-list-container[data-v-62df65df]::-webkit-scrollbar{width:12px}.win-list-container[data-v-62df65df]::-webkit-scrollbar-track{background:#dfdfdf;border-left:1px solid #fff}.win-list-container[data-v-62df65df]::-webkit-scrollbar-thumb{background:#c0c0c0;border:1px solid #fff;border-right-color:#000;border-bottom-color:#000;box-shadow:inset 1px 1px #fff}.song-info[data-v-62df65df]{text-align:left;font-size:12px;color:#333;border-bottom:1px dashed #666;padding-bottom:5px;margin-bottom:5px}.bottom-controls[data-v-62df65df]{display:flex;align-items:center;justify-content:space-between;margin-top:auto;padding-top:10px}.controls[data-v-62df65df]{display:flex;gap:6px}.btn[data-v-62df65df]{min-width:32px;height:28px;padding:0 5px;background:#c0c0c0;color:#000;border-top:1px solid #fff;border-left:1px solid #fff;border-right:1px solid #000;border-bottom:1px solid #000;box-shadow:inset -1px -1px #808080;font-size:12px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:none}.btn[data-v-62df65df]:active{border-top:1px solid #000;border-left:1px solid #000;border-right:1px solid #fff;border-bottom:1px solid #fff;box-shadow:none;padding-top:2px;padding-left:2px}.btn i[data-v-62df65df]{font-size:12px}.volume-container[data-v-62df65df]{display:flex;align-items:center;gap:5px;width:100px}.vol-icon[data-v-62df65df]{color:#333;font-size:12px}input[type=\\'range\\'].volume-slider[data-v-62df65df]{-webkit-appearance:none !important;appearance:none !important;background:transparent !important;filter:none !important;border:none !important;border-radius:0 !important;outline:none !important;box-shadow:none !important;width:100% !important;height:20px !important;margin:0 !important;padding:0 !important;cursor:pointer !important}input[type=\\'range\\'].volume-slider[data-v-62df65df]::-webkit-slider-runnable-track{width:100% !important;height:6px !important;background:#fff !important;border-top:1px solid #808080 !important;border-left:1px solid #808080 !important;border-right:1px solid #fff !important;border-bottom:1px solid #fff !important;box-shadow:inset 1px 1px #000 !important;border-radius:0 !important}input[type=\\'range\\'].volume-slider[data-v-62df65df]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;width:10px !important;height:16px !important;margin-top:-6px !important;background:#c0c0c0 !important;border-top:1px solid #fff !important;border-left:1px solid #fff !important;border-right:1px solid #000 !important;border-bottom:1px solid #000 !important;box-shadow:inset -1px -1px #808080 !important;border-radius:0 !important}.lyrics-widget.near-boundary[data-v-62df65df]{box-shadow:inset 0 0 10px red}.expand-trigger[data-v-62df65df]{position:absolute;left:-10px;bottom:-10px;width:40px;height:40px;cursor:pointer;z-index:100;transition:transform 0.1s}.expand-trigger[data-v-62df65df]:active{transform:scale(0.9)}.expand-trigger img[data-v-62df65df]{width:100%;height:100%;object-fit:contain;image-rendering:pixelated;filter:drop-shadow(2px 2px 2px rgba(0,0,0,0.5))}.lyrics-widget.expanded .expand-trigger[data-v-62df65df]{display:none}.expand-trigger[data-v-62df65df]{position:absolute;left:-12px;bottom:-12px;width:48px;width:48px;height:48px;cursor:pointer;z-index:100;transform:rotate(20deg);transition:all 0.3s cubic-bezier(0.34,1.56,0.64,1)}.expand-trigger img[data-v-62df65df]{width:100%;height:100%;object-fit:contain;image-rendering:pixelated;filter:drop-shadow(3px 3px 0px rgba(0,0,0,0.4));transition:filter 0.3s}.expand-trigger[data-v-62df65df]:hover{transform:rotate(20deg) scale(1.15) translateY(-3px);z-index:101}.expand-trigger:hover img[data-v-62df65df]{filter:drop-shadow(5px 5px 0px rgba(0,0,0,0.3)) brightness(1.1)}.expand-trigger[data-v-62df65df]:active{transform:rotate(20deg) scale(0.95) translateY(0)}.expand-trigger:active img[data-v-62df65df]{filter:drop-shadow(1px 1px 0px rgba(0,0,0,0.5))}.lyrics-widget.expanded .expand-trigger[data-v-62df65df]{display:none;pointer-events:none}\\n','',{version:3,sources:['webpack://./src/电脑弹窗播放器/musicPlayer.vue'],names:[],mappings:'AAsvBA,gCACE,iBAAkB,CAClB,OAAQ,CACR,QAAS,CACT,8BAAgC,CAChC,WAAY,CACZ,WAAY,CACZ,SAAU,CACV,eAAgB,CAChB,eAAgB,CAChB,sFAAuF,CACvF,uBAAwB,CACxB,2BAA4B,CAC5B,0BAA2B,CAC3B,4BAA6B,CAC7B,wBAAiB,CAAjB,gBAAiB,CACjB,WAAY,CACZ,eAAgB,CAChB,oDAA4C,CAC5C,iCAGF,CAEA,8BACE,QAEE,8BACF,CACA,IACE,8BACF,CACF,CAGA,sHAEE,uBAAwB,CACxB,SAAU,CACV,mBACF,CAEA,yCACE,eAAgB,CAChB,2BACF,CAKA,yCACE,WAAY,CACZ,WAAY,CACZ,gBAAiB,CACjB,qEAAsE,CACtE,qBAAsB,CACtB,0BAA2B,CAC3B,wBAAyB,CAGzB,wBAAyB,CACzB,uBAAwB,CACxB,wBAAyB,CACzB,kFAGiC,CAEjC,eAAgB,CAChB,WAAY,CACZ,cAAe,CACf,cAAe,CACf,YAAa,CACb,qBACF,CAGA,gCACE,WAAY,CACZ,eAAgB,CAChB,8CAAiD,CACjD,WAAY,CACZ,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,aAAc,CACd,gCAAkC,CAClC,cAAe,CACf,gBACF,CAEA,+BACE,YAAa,CACb,OACF,CAGA,0BACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,WAAY,CAGZ,yBAA0B,CAC1B,0BAA2B,CAC3B,2BAA4B,CAC5B,4BAA6B,CAC7B,kCAAmC,CAEnC,cAAe,CACf,gBAAiB,CACjB,iBAAkB,CAClB,cAAe,CACf,YAAa,CACb,kBAAmB,CACnB,sBACF,CAEA,iCACE,yBAA0B,CAC1B,0BAA2B,CAC3B,2BAA4B,CAC5B,4BAA6B,CAC7B,eAAgB,CAChB,eAAgB,CAChB,gBACF,CAEA,gCACE,cACF,CAGA,0BACE,iBAAkB,CAClB,YAAa,CACb,qBAAsB,CACtB,WAAY,CACZ,YAAa,CACb,gCAAoC,CACpC,yBAA0B,CAE1B,wBAAyB,CACzB,uBAAwB,CACxB,wBAAyB,CACzB,6BAA8B,CAC9B,UACF,CAGA,+BACE,eAAgB,CAChB,aAAc,CACd,iBACF,CAGA,6BACE,iBAAkB,CAClB,wCAA0C,CAC1C,UAAW,CACX,eAAgB,CAChB,YAAa,CACb,qBAAsB,CACtB,sBACF,CAEA,qCACE,cAAe,CACf,gBAAiB,CACjB,UAAW,CACX,wBACF,CAEA,kCACE,cAAe,CACf,UAAW,CACX,cACF,CAKA,+BACE,YAAa,CACb,qBAAsB,CACtB,OAAQ,CACR,YACF,CAGA,iCACE,YAAa,CACb,OACF,CAEA,4BACE,MAAO,CACP,eAAgB,CAChB,gBAAiB,CACjB,sCAAuC,CACvC,wCAA0C,CAC1C,cAAe,CACf,eAAgB,CAChB,YAAa,CACb,UACF,CAEA,yBACE,cAAe,CACf,cAAe,CACf,WACF,CAGA,qCACE,MAAO,CACP,eAAgB,CAChB,gBAAiB,CACjB,sCAAuC,CACvC,eAAgB,CAChB,iBACF,CAGA,2BACE,eAAgB,CAChB,SAAU,CACV,QACF,CAEA,gCACE,eAAgB,CAChB,cAAe,CACf,cAAe,CACf,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CACnB,UAAW,CACX,+BACF,CAEA,sCACE,yBACF,CAGA,yCACE,wBAAyB,CACzB,UACF,CAEA,+CACE,oBACF,CAEA,4BACE,kBAAmB,CACnB,eAAgB,CAChB,sBAAuB,CACvB,MACF,CAEA,6BACE,aAAc,CACd,gBAAiB,CACjB,cACF,CAEA,mCACE,SACF,CACA,2DACE,aACF,CAGA,wDACE,UACF,CACA,8DACE,kBAAmB,CACnB,0BACF,CACA,8DACE,kBAAmB,CACnB,qBAAsB,CACtB,uBAAwB,CACxB,wBAAyB,CACzB,6BACF,CAGA,4BACE,eAAgB,CAChB,cAAe,CACf,UAAW,CACX,6BAA8B,CAC9B,kBAAmB,CACnB,iBACF,CAEA,kCACE,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CAC9B,eAAgB,CAChB,gBACF,CAEA,2BACE,YAAa,CACb,OACF,CAGA,sBACE,cAAe,CACf,WAAY,CACZ,aAAc,CACd,kBAAmB,CACnB,UAAW,CACX,yBAA0B,CAC1B,0BAA2B,CAC3B,2BAA4B,CAC5B,4BAA6B,CAC7B,kCAAmC,CACnC,cAAe,CACf,cAAe,CACf,YAAa,CACb,kBAAmB,CACnB,sBAAuB,CACvB,eACF,CAEA,6BACE,yBAA0B,CAC1B,0BAA2B,CAC3B,2BAA4B,CAC5B,4BAA6B,CAC7B,eAAgB,CAChB,eAAgB,CAChB,gBACF,CAEA,wBACE,cACF,CAEA,mCACE,YAAa,CACb,kBAAmB,CACnB,OAAQ,CACR,WACF,CAEA,2BACE,UAAW,CACX,cACF,CAGA,mDACE,kCAAmC,CACnC,0BAA2B,CAC3B,iCAAkC,CAClC,sBAAuB,CACvB,sBAAuB,CACvB,0BAA2B,CAC3B,uBAAwB,CACxB,0BAA2B,CAC3B,qBAAsB,CACtB,sBAAuB,CACvB,mBAAoB,CACpB,oBAAqB,CACrB,yBACF,CAEA,kFACE,qBAAsB,CACtB,qBAAsB,CACtB,0BAA2B,CAC3B,uCAAwC,CACxC,wCAAyC,CACzC,sCAAuC,CACvC,uCAAwC,CACxC,wCAAyC,CACzC,0BACF,CAEA,yEACE,kCAAmC,CACnC,0BAA2B,CAC3B,qBAAsB,CACtB,sBAAuB,CACvB,0BAA2B,CAC3B,6BAA8B,CAC9B,oCAAqC,CACrC,qCAAsC,CACtC,sCAAuC,CACvC,uCAAwC,CACxC,6CAA8C,CAC9C,0BACF,CAEA,8CACE,6BACF,CAEA,iCACE,iBAAkB,CAElB,UAAW,CACX,YAAa,CACb,UAAW,CACX,WAAY,CACZ,cAAe,CACf,WAAY,CACZ,yBACF,CAGA,wCACE,oBACF,CAEA,qCACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,yBAA0B,CAE1B,+CACF,CAGA,yDACE,YACF,CAIA,iCACE,iBAAkB,CAClB,UAAW,CACX,YAAa,CACb,UAAW,CACX,UAAW,CACX,WAAY,CACZ,cAAe,CACf,WAAY,CAGZ,uBAAwB,CAGxB,kDACF,CAGA,qCACE,UAAW,CACX,WAAY,CACZ,kBAAmB,CACnB,yBAA0B,CAG1B,+CAAmD,CACnD,sBACF,CAGA,uCAEE,oDAAqD,CACrD,WACF,CAEA,2CAEE,+DACF,CAGA,wCACE,iDACF,CAEA,4CACE,+CACF,CAGA,yDACE,YAAa,CACb,mBACF',sourcesContent:['<template>\\n  <div\\n    id=\"lyricsWidget\"\\n    ref=\"widget\"\\n    class=\"lyrics-widget\"\\n    :class=\"{ expanded: widget?.classList.contains(\\'expanded\\') }\"\\n    :style=\"`top:${dragY};left:${dragX}`\"\\n    @mousedown=\"startDrag\"\\n    @touchstart=\"startDrag\"\\n    @contextmenu=\"onContextMenu\"\\n    @mouseenter=\"onMouseEnter\"\\n    @mouseleave=\"onMouseLeave\"\\n    @touchend=\"onTouchEnd\"\\n  >\\n    \\x3c!-- 【新增代码 开始】 游戏手柄展开按钮 --\\x3e\\n    \\x3c!-- mousedown.stop 防止点击按钮时触发父级的拖拽逻辑 --\\x3e\\n    <div class=\"expand-trigger\" @click.stop=\"toggleExpand\" @mousedown.stop @touchstart.stop>\\n      <img src=\"https://i.postimg.cc/jSKcXjdM/Controller-Pixel-Art.png\" alt=\"Open\" />\\n    </div>\\n    \\x3c!-- Windows 标题栏 --\\x3e\\n    <div class=\"win-title-bar\">\\n      <div class=\"win-title-text\">\\n        <i class=\"fas fa-music\" style=\"margin-right: 4px; font-size: 10px\"></i>WinAmp.exe\\n      </div>\\n      <div class=\"win-controls\">\\n        <div class=\"win-btn\" title=\"最小化\">_</div>\\n        \\x3c!-- 【修改点】点击最大化按钮切换播放列表 --\\x3e\\n        <div class=\"win-btn\" :title=\"showПлейлист ? \\'显示歌词\\' : \\'播放列表\\'\" @click.stop=\"toggleViewMode\">\\n          {{ showПлейлист ? \\'≡\\' : \\'□\\' }}\\n        </div>\\n        \\x3c!-- 点击关闭按钮触发收缩 --\\x3e\\n        <div class=\"win-btn close\" @click.stop=\"toggleExpand\">×</div>\\n      </div>\\n    </div>\\n\\n    <div class=\"content\">\\n      <div class=\"song-info\">\\n        <div class=\"song-title\">{{ currentSong }} - {{ currentSinger }}</div>\\n      </div>\\n\\n      \\x3c!--\\n         内容显示区\\n         这里根据 showПлейлист 状态切换显示\\n      --\\x3e\\n      <div class=\"display-area\" @click=\"toggleExpand\">\\n        \\x3c!-- 视图 A: 歌词 (默认) --\\x3e\\n        <div v-show=\"!showПлейлист\" class=\"lyrics-box\">\\n          <div class=\"lyric-line lyric-current current\">{{ currentLine }}</div>\\n          <div class=\"lyric-line lyric-next next\">{{ nextLine }}</div>\\n        </div>\\n\\n        \\x3c!-- 视图 B: 播放列表与搜索 (Windows 风格) --\\x3e\\n        <div v-show=\"showПлейлист\" class=\"playlist-box\" @click.stop>\\n          \\x3c!-- 搜索栏 --\\x3e\\n          <div class=\"win-search-row\">\\n            <input\\n              type=\"text\"\\n              class=\"win-input\"\\n              v-model=\"searchKeyword\"\\n              placeholder=\"Search...\"\\n              @keyup.enter=\"performSearch\"\\n            />\\n            <button class=\"btn btn-sm\" @click=\"performSearch\">Go</button>\\n          </div>\\n\\n          \\x3c!-- 列表区域 (白色凹陷框) --\\x3e\\n          <div class=\"win-list-container\">\\n            <ul class=\"win-list\">\\n              <li\\n                v-for=\"(song, index) in sharedState.music.list\"\\n                :key=\"index\"\\n                class=\"win-list-item\"\\n                :class=\"{ selected: index === sharedState.music.index }\"\\n                @click=\"playFromList(index)\"\\n              >\\n                <span class=\"item-text\">{{ index + 1 }}. {{ song.song || song.name || \\'Unknown\\' }}</span>\\n                <span class=\"item-close\" @click.stop=\"removeSong(index)\">×</span>\\n              </li>\\n              <li v-if=\"sharedState.music.list.length === 0\" class=\"win-list-item empty\">(Пусто List)</li>\\n            </ul>\\n          </div>\\n        </div>\\n      </div>\\n\\n      <div class=\"bottom-controls controls-area\" @click.stop>\\n        <div class=\"controls btn-group\">\\n          <button class=\"btn prev-btn\" title=\"上一首\" @click=\"e => controlAction(e, \\'prev\\')\">\\n            <i class=\"fas fa-step-backward\"></i>\\n          </button>\\n          <button class=\"btn btn-play\" title=\"播放/暂停\" @click=\"e => controlAction(e, !isPlaying ? \\'play\\' : \\'stop\\')\">\\n            <i :class=\"[\\'fas\\', isPlaying ? \\'fa-pause\\' : \\'fa-play\\']\"></i>\\n          </button>\\n          <button class=\"btn next-btn\" title=\"下一首\" @click=\"e => controlAction(e, \\'next\\')\">\\n            <i class=\"fas fa-step-forward\"></i>\\n          </button>\\n        </div>\\n\\n        <div class=\"volume-control volume-container\">\\n          <i class=\"fas fa-volume-down vol-icon\"></i>\\n          <input\\n            type=\"range\"\\n            class=\"volume-slider volume-track\"\\n            min=\"0\"\\n            max=\"100\"\\n            v-model=\"volume\"\\n            @click.stop\\n            :style=\"{ \\'--volume-fill\\': volume + \\'%\\' }\"\\n          />\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\"ts\">\\nimport { onBeforeUnmount, onMounted, ref, watch } from \\'vue\\';\\n\\n// 假设 sharedState 依然存在于你的项目中\\nimport { sharedState } from \\'./shared-state\\';\\n\\nconst isPlaying = ref(false);\\nconst volume = ref(65);\\nconst currentLine = ref(\\'Ready...\\');\\nconst nextLine = ref(`Waiting for command`);\\nconst currentSong = ref(``);\\nconst currentSinger = ref(``);\\nconst currentLyricStr = ref(``);\\nconst parsedLyrics = ref<{ time: number; text: string }[]>([]);\\nconst currentLyricIndex = ref(-1);\\nconst hasStarted = ref(false);\\nconst playingIndex = ref(-1);\\n\\n// --- 新增状态 ---\\nconst showПлейлист = ref(false);\\nconst searchKeyword = ref(\\'\\');\\n// ----------------\\n\\nconst musicAudio = new Audio();\\nconst musicObj = {\\n  list: new Array(),\\n  nowIndex: -1,\\n};\\nmusicAudio.volume = volume.value / 100;\\nwatch(volume, newVal => {\\n  musicAudio.volume = newVal / 100;\\n});\\nconst Music = (globalThis as any).Music;\\n\\nwatch(\\n  () => sharedState.music.index,\\n  (newVal, oldVal) => {\\n    console.log(\\'index 变化:\\', oldVal, \\'->\\', newVal);\\n    if (oldVal == -1 && newVal > -1) {\\n      controlAction(null, \\'play\\');\\n    }\\n  },\\n);\\n\\n// --- 新增功能逻辑 (从你给的参考代码移植) ---\\n\\nfunction toggleViewMode() {\\n  showПлейлист.value = !showПлейлист.value;\\n  startHideTimer();\\n}\\n\\n// --- 在 musicPlayer.vue 的 <script setup> 中找到这两个函数进行替换 ---\\n\\nasync function performSearch() {\\n  const keyword = searchKeyword.value.trim();\\n  if (!keyword) return;\\n\\n  // 构造歌曲对象\\n  const newSong = {\\n    song: keyword,\\n    name: keyword, // 兼容不同字段名\\n    singer: \\'Поиск...\\',\\n    isCustom: true // 【关键】标记这是手动搜索的，用于删除时区分\\n  };\\n\\n  // 【修改】添加到自定义列表并永久保存\\n  sharedState.music.customList.push(newSong);\\n  sharedState.music.saveCustomList();\\n\\n  // 同时更新当前显示的列表（这样不用刷新页面就能看到）\\n  sharedState.music.list.push(newSong);\\n\\n  searchKeyword.value = \\'\\';\\n\\n  // 播放刚添加的这首歌\\n  const newIndex = sharedState.music.list.length - 1;\\n  sharedState.music.index = newIndex;\\n  PlayMusic(newIndex);\\n}\\n\\nfunction removeSong(index: number) {\\n  const songToRemove = sharedState.music.list[index];\\n\\n  // 调整播放索引\\n  if (index < sharedState.music.index) {\\n    sharedState.music.index--;\\n  } else if (index === sharedState.music.index) {\\n    // 如果删除的是正在播放的，停止播放或切歌（根据需求，这里简单处理为索引-1如果不小于0）\\n    if(sharedState.music.index > 0) sharedState.music.index--;\\n    else sharedState.music.index = -1;\\n  }\\n\\n  // 从当前视图列表中移除\\n  sharedState.music.list.splice(index, 1);\\n\\n  // 【修改】如果是自定义歌曲，也从永久存储中移除\\n  if (songToRemove.isCustom) {\\n    // 在 customList 中找到对应的对象进行删除\\n    // 注意：这里用 indexOf 可能因为对象引用问题不一定准，如果是刚加载的页面引用是相同的\\n    // 如果引用不同，可以尝试通过 song 名字匹配\\n    const customIndex = sharedState.music.customList.indexOf(songToRemove);\\n\\n    if (customIndex !== -1) {\\n      sharedState.music.customList.splice(customIndex, 1);\\n    } else {\\n        // 如果引用对不上（极少数情况），用歌名匹配删除\\n        const fallbackIndex = sharedState.music.customList.findIndex(\\n            (item: any) => item.song === songToRemove.song && item.name === songToRemove.name\\n        );\\n        if (fallbackIndex !== -1) {\\n            sharedState.music.customList.splice(fallbackIndex, 1);\\n        }\\n    }\\n    // 保存更改到 localStorage\\n    sharedState.music.saveCustomList();\\n  }\\n}\\n\\n\\nfunction playFromList(index: number) {\\n  if (index === sharedState.music.index && isPlaying.value) return;\\n  sharedState.music.index = index;\\n  PlayMusic(index);\\n}\\n\\n\\n\\n// ------------------------------------------\\n\\nfunction parseLyricToTimeline(lyric: string) {\\n  const lines = lyric.split(/\\\\r?\\\\n/);\\n  const entries: { time: number; text: string }[] = [];\\n\\n  for (const line of lines) {\\n    const timeTags = line.match(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/g);\\n    const text = line.replace(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/g, \\'\\').trim();\\n    if (!timeTags || !text) continue;\\n\\n    for (const tag of timeTags) {\\n      const match = tag.match(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/);\\n      if (!match) continue;\\n      const minutes = Number(match[1]);\\n      const seconds = Number(match[2]);\\n      const millis = match[3] ? Number(match[3].padEnd(3, \\'0\\')) : 0;\\n      const time = minutes * 60 + seconds + millis / 1000;\\n      entries.push({ time, text });\\n    }\\n  }\\n\\n  entries.sort((a, b) => a.time - b.time);\\n  return entries;\\n}\\n\\nfunction updateLyricDisplayByTime(currentTime: number) {\\n  const list = parsedLyrics.value;\\n  if (!list.length) {\\n    currentLine.value = \\'\\';\\n    nextLine.value = \\'\\';\\n    currentLyricIndex.value = -1;\\n    return;\\n  }\\n\\n  let idx = list.length - 1;\\n  for (let i = 0; i < list.length; i++) {\\n    if (currentTime < list[i].time) {\\n      idx = i - 1;\\n      break;\\n    }\\n  }\\n\\n  if (idx < 0) {\\n    currentLine.value = \\'\\';\\n    nextLine.value = list[0]?.text ?? \\'\\';\\n    currentLyricIndex.value = -1;\\n    return;\\n  }\\n\\n  if (idx !== currentLyricIndex.value) {\\n    currentLyricIndex.value = idx;\\n    currentLine.value = list[idx]?.text ?? \\'\\';\\n    nextLine.value = list[idx + 1]?.text ?? \\'\\';\\n  }\\n}\\n\\nfunction onTimeUpdate() {\\n  updateLyricDisplayByTime(musicAudio.currentTime || 0);\\n}\\n\\nasync function controlAction(event: any, action: any) {\\n  event?.stopPropagation();\\n  startHideTimer();\\n\\n  if (action == \\'stop\\') {\\n    musicAudio.pause();\\n    isPlaying.value = false;\\n    return;\\n  }\\n\\n  let index = sharedState.music.index;\\n  // 逻辑增强：如果列表非空但index为-1，尝试重置为0\\n  if (index == -1 && sharedState.music.list.length > 0) index = 0;\\n  if (index == -1 && action !== \\'play\\') return;\\n\\n  if (index > sharedState.music.list.length - 1) {\\n    index = sharedState.music.list.length - 1;\\n    sharedState.music.index = index;\\n  }\\n\\n  if (action == \\'play\\') {\\n    if (index === -1) return; // 列表为空\\n\\n    const canResume = hasStarted.value && playingIndex.value === index && musicAudio.src;\\n    if (!isPlaying.value && canResume) {\\n      musicAudio.play();\\n      isPlaying.value = true;\\n      return;\\n    }\\n    PlayMusic(index);\\n  }\\n\\n  if (action == \\'prev\\') {\\n    if (index > 0) {\\n      index -= 1;\\n    } else if (index <= 0) {\\n      index = sharedState.music.list.length - 1;\\n    }\\n\\n    sharedState.music.index = index;\\n    PlayMusic(index);\\n  }\\n\\n  if (action == \\'next\\') {\\n    if (index >= sharedState.music.list.length - 1) {\\n      index = 0;\\n    } else {\\n      index += 1;\\n    }\\n\\n    sharedState.music.index = index;\\n    PlayMusic(index);\\n  }\\n}\\n\\nasync function PlayMusic(index: number) {\\n  if (!sharedState.music.list[index]) return;\\n\\n  const song = sharedState.music.list[index];\\n  const name = song.song || song.name;\\n  let playUrl = \\'\\';\\n  const cached = sharedState.music.cache[name];\\n  const cachedMeta = cached && typeof cached === \\'object\\' ? cached : null;\\n\\n  if (cached) {\\n    const cachedUrl = typeof cached === \\'string\\' ? cached : cached.Url;\\n    if (cachedUrl) {\\n      const available = await sharedState.music.checkAudioAvailability(cachedUrl);\\n      if (available) {\\n        playUrl = cachedUrl;\\n        if (cachedMeta) {\\n          currentSinger.value = cachedMeta.Singer;\\n          currentSong.value = cachedMeta.Name;\\n          currentLyricStr.value = cachedMeta.Lyric;\\n        }\\n      }\\n    }\\n  }\\n\\n  let fetchedMeta: any = null;\\n  if (!playUrl) {\\n    currentLine.value = \\'Поиск...\\';\\n    nextLine.value = \\'Подождите\\';\\n\\n    const result = await Music.SearchMusic(name);\\n    console.log(JSON.stringify(result));\\n\\n    if (!result?.Url) {\\n      currentLine.value = \\'Ошибка\\';\\n      nextLine.value = \\'Retry manually\\';\\n      return;\\n    }\\n    playUrl = result.Url;\\n    fetchedMeta = result;\\n    sharedState.music.cache[name] = result;\\n  }\\n\\n  if (playUrl != musicAudio.src) {\\n    musicAudio.src = playUrl;\\n  }\\n\\n  const meta = fetchedMeta || cachedMeta;\\n  if (meta) {\\n    currentSinger.value = meta.Singer;\\n    currentSong.value = meta.Name;\\n    currentLyricStr.value = meta.Lyric;\\n  } else {\\n    currentSinger.value = song.singer || \\'Unknown\\';\\n    currentSong.value = name;\\n  }\\n\\n  if (currentLyricStr.value) {\\n    parsedLyrics.value = parseLyricToTimeline(currentLyricStr.value || \\'\\');\\n    currentLyricIndex.value = -1;\\n    updateLyricDisplayByTime(0);\\n  } else {\\n    // 没歌词时清空\\n    parsedLyrics.value = [];\\n    currentLine.value = currentSong.value;\\n    nextLine.value = \\'Нет текста\\';\\n  }\\n\\n  musicAudio.play();\\n  isPlaying.value = true;\\n  hasStarted.value = true;\\n  playingIndex.value = index;\\n}\\n\\n// 拖拽实现\\nconst widget = ref<HTMLElement | null>(null);\\nlet startX = 0,\\n  startY = 0,\\n  initialX = 0,\\n  initialY = 0;\\nconst dragX = ref(`50%`);\\nconst dragY = ref(`20%`);\\nlet hideTimer: any = null;\\nconst isDragging = ref(false);\\nconst hasMovedWhileDragging = ref(false);\\nconst isRightClick = ref(false);\\nconst windowWidth = $(\\'body\\').width() || 0;\\nconst windowHeight = $(\\'body\\').height() || 0;\\nconst isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\\n\\nfunction startHideTimer() {\\n  clearTimeout(hideTimer);\\n  const el = widget.value;\\n  if (el && el.classList.contains(\\'expanded\\')) {\\n    hideTimer = setTimeout(() => {\\n      // 如果正在操作播放列表，就不自动收缩了，防止体验不好\\n      if (!showПлейлист.value) {\\n        el.classList.remove(\\'expanded\\');\\n      }\\n    }, 5000);\\n  }\\n}\\n\\nfunction startDrag(e: any) {\\n  const el = widget.value;\\n  if (!el) return;\\n\\n  if (e.button === 2 || e.which === 3) {\\n    isRightClick.value = true;\\n    return;\\n  }\\n\\n  // 阻止拖拽的区域：控制区、列表区、输入框、按钮\\n  if (\\n    e.target.closest(\\'.bottom-controls\\') ||\\n    e.target.closest(\\'.win-btn\\') ||\\n    e.target.closest(\\'.playlist-box\\') ||\\n    e.target.closest(\\'input\\')\\n  ) {\\n    if (el.classList.contains(\\'expanded\\')) {\\n      clearTimeout(hideTimer);\\n    }\\n    return;\\n  }\\n\\n  isRightClick.value = false;\\n  isDragging.value = true;\\n  hasMovedWhileDragging.value = false;\\n  el.classList.add(\\'dragging\\');\\n\\n  clearTimeout(hideTimer);\\n\\n  const rect = el.getBoundingClientRect();\\n  initialX = rect.left + rect.width / 2;\\n  initialY = rect.top + rect.height / 2;\\n\\n  if (e.type === \\'mousedown\\') {\\n    startX = e.clientX;\\n    startY = e.clientY;\\n    $(\\'body\\').on(\\'mousemove\\', drag);\\n    $(\\'body\\').on(\\'mouseup\\', stopDrag);\\n  } else if (e.type === \\'touchstart\\') {\\n    startX = e.touches[0].clientX;\\n    startY = e.touches[0].clientY;\\n    $(\\'body\\').on(\\'touchmove\\', drag);\\n    $(\\'body\\').on(\\'touchend\\', stopDrag);\\n  }\\n}\\n\\nfunction drag(e: any) {\\n  if (!isDragging.value || isRightClick.value) {\\n    return;\\n  }\\n  if (e && typeof e.preventDefault === \\'function\\') e.preventDefault();\\n\\n  hasMovedWhileDragging.value = true;\\n\\n  let clientX, clientY;\\n  if (e.type === \\'mousemove\\') {\\n    clientX = e.clientX;\\n    clientY = e.clientY;\\n  } else if (e.type === \\'touchmove\\') {\\n    clientX = e.touches[0].clientX;\\n    clientY = e.touches[0].clientY;\\n  }\\n\\n  const deltaX = clientX - startX;\\n  const deltaY = clientY - startY;\\n\\n  const newX = initialX + deltaX;\\n  const newY = initialY + deltaY;\\n\\n  const margin = 20;\\n  const maxX = windowWidth - margin;\\n  const maxY = windowHeight - margin;\\n\\n  const clampedX = Math.max(margin, Math.min(maxX, newX));\\n  const clampedY = Math.max(margin, Math.min(maxY, newY));\\n  if (newX !== clampedX || newY !== clampedY) {\\n    widget.value!.classList.add(\\'near-boundary\\');\\n  } else {\\n    widget.value!.classList.remove(\\'near-boundary\\');\\n  }\\n\\n  dragX.value = `${newX}px`;\\n  dragY.value = `${newY}px`;\\n}\\n\\nfunction stopDrag(e: any) {\\n  if (!isDragging.value && !isRightClick.value) return;\\n\\n  $(\\'body\\').off(\\'mousemove\\', drag);\\n  $(\\'body\\').off(\\'mouseup\\', stopDrag);\\n  $(\\'body\\').off(\\'touchmove\\', drag);\\n  $(\\'body\\').off(\\'touchend\\', stopDrag);\\n\\n  if (isRightClick.value) {\\n    isRightClick.value = false;\\n    return;\\n  }\\n\\n  const el = widget.value;\\n  const wasExpanded = el && el.classList.contains(\\'expanded\\');\\n\\n  isDragging.value = false;\\n  el && el.classList.remove(\\'dragging\\', \\'near-boundary\\');\\n\\n  const currentTransform = el ? el.style.transform : \\'\\';\\n  if (currentTransform && currentTransform.includes(\\'scale\\')) {\\n    el!.style.transform = \\'\\';\\n  }\\n\\n  if (hasMovedWhileDragging.value) {\\n    savePosition();\\n    if (wasExpanded) {\\n      setTimeout(() => {\\n        startHideTimer();\\n      }, 100);\\n    }\\n  } else {\\n    /*setTimeout(() => {\\n      // 点击非功能区时切换展开/收缩\\n      const target = e.target;\\n      const isInteractive = target && (\\n        target.closest(\\'.bottom-controls\\') ||\\n        target.closest(\\'.win-btn\\') ||\\n        target.closest(\\'.playlist-box\\') ||\\n        target.tagName === \\'INPUT\\' ||\\n        target.tagName === \\'BUTTON\\'\\n      );\\n\\n      if (!isInteractive) {\\n        toggleExpand(e);\\n      }\\n    }, 50);*/\\n  }\\n\\n  hasMovedWhileDragging.value = false;\\n}\\n\\nfunction savePosition() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const rect = el.getBoundingClientRect();\\n  const position = {\\n    x: ((rect.left + rect.width / 2) / windowWidth) * 100,\\n    y: ((rect.top + rect.height / 2) / windowHeight) * 100,\\n  };\\n  localStorage.setItem(\\'lyricsWidgetPosition\\', JSON.stringify(position));\\n}\\n\\nfunction restorePosition() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const saved = localStorage.getItem(\\'lyricsWidgetPosition\\');\\n  if (saved) {\\n    const position = JSON.parse(saved);\\n    let x = `50`;\\n    if (position.x < 100 && position.x > 0) x = position.x;\\n    let y = `20`;\\n    if (position.y < 100 && position.y > 0) y = position.y;\\n    el.style.left = x + \\'%\\';\\n    el.style.top = y + \\'%\\';\\n  }\\n}\\n\\nfunction toggleExpand(event: any) {\\n  const el = widget.value;\\n  if (!el) return;\\n  if (isDragging.value || hasMovedWhileDragging.value || isRightClick.value) return;\\n\\n  if (el.classList.contains(\\'expanded\\')) {\\n    el.classList.remove(\\'expanded\\');\\n    showПлейлист.value = false; // 收缩时重置为歌词界面\\n    clearTimeout(hideTimer);\\n  } else {\\n    el.classList.add(\\'expanded\\');\\n    startHideTimer();\\n  }\\n}\\n\\nfunction onContextMenu(e: any) {\\n  const el = widget.value;\\n  isRightClick.value = true;\\n  if (isDragging.value) {\\n    isDragging.value = false;\\n    el && el.classList.remove(\\'dragging\\', \\'near-boundary\\');\\n  }\\n}\\n\\nfunction onMouseEnter() {\\n  if (isMobile) return;\\n  const el = widget.value;\\n  if (el && el.classList.contains(\\'expanded\\') && !isDragging.value && !isRightClick.value) {\\n    clearTimeout(hideTimer);\\n  }\\n}\\n\\nfunction onMouseLeave() {\\n  if (isMobile) return;\\n  const el = widget.value;\\n  // 仅在非播放列表模式下自动收缩，防止看列表时消失\\n  if (el && el.classList.contains(\\'expanded\\') && !isDragging.value && !isRightClick.value && !showПлейлист.value) {\\n    clearTimeout(hideTimer);\\n    hideTimer = setTimeout(() => {\\n      el.classList.remove(\\'expanded\\');\\n    }, 2000);\\n  }\\n}\\n\\nfunction onTouchEnd() {\\n  if (!isMobile) return;\\n  clearTimeout(hideTimer);\\n  const el = widget.value;\\n  if (el && el.classList.contains(\\'expanded\\') && !isDragging.value) {\\n    hideTimer = setTimeout(() => {\\n      startHideTimer();\\n    }, 100);\\n  }\\n}\\n\\nfunction onResize() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const rect = el.getBoundingClientRect();\\n  const centerX = rect.left + rect.width / 2;\\n  const centerY = rect.top + rect.height / 2;\\n  const margin = 50;\\n  const maxX = windowWidth - margin;\\n  const maxY = windowHeight - margin;\\n  const newX = Math.max(margin, Math.min(maxX, centerX));\\n  const newY = Math.max(margin, Math.min(maxY, centerY));\\n  el.style.left = (newX / windowWidth) * 100 + \\'%\\';\\n  el.style.top = (newY / windowHeight) * 100 + \\'%\\';\\n  savePosition();\\n}\\n\\nfunction onVisibilityChange() {\\n  const el = widget.value;\\n  if (document.hidden) {\\n    clearTimeout(hideTimer);\\n  } else if (el && el.classList.contains(\\'expanded\\')) {\\n    startHideTimer();\\n  }\\n}\\n\\nfunction onDocumentClick(e: any) {\\n  if (isRightClick.value && !(e.target && e.target.closest && e.target.closest(\\'.lyrics-widget\\'))) {\\n    isRightClick.value = false;\\n  }\\n}\\n\\nfunction onKeyDown(e: any) {\\n  if (e.key === \\'Escape\\') {\\n    isRightClick.value = false;\\n  }\\n}\\n\\nonMounted(() => {\\n  if (widget.value) {\\n    widget.value.addEventListener(\\n      \\'touchmove\\',\\n      e => {\\n        if (isDragging.value && !isRightClick.value) {\\n          e.preventDefault();\\n        }\\n      },\\n      { passive: false },\\n    );\\n  }\\n\\n  $(\\'body\\').on(\\'visibilitychange\\', onVisibilityChange);\\n  $(\\'body\\').on(\\'click\\', onDocumentClick);\\n  $(\\'body\\').on(\\'keydown\\', onKeyDown);\\n  window.addEventListener(\\'resize\\', onResize);\\n\\n  restorePosition();\\n\\n  musicAudio.addEventListener(\\'timeupdate\\', onTimeUpdate);\\n});\\n\\nonBeforeUnmount(() => {\\n  clearTimeout(hideTimer);\\n  $(\\'body\\').off(\\'mousemove\\', drag);\\n  $(\\'body\\').off(\\'mouseup\\', stopDrag);\\n  $(\\'body\\').off(\\'touchmove\\', drag);\\n  $(\\'body\\').off(\\'touchend\\', stopDrag);\\n  $(\\'body\\').off(\\'visibilitychange\\', onVisibilityChange);\\n  $(\\'body\\').off(\\'click\\', onDocumentClick);\\n  $(\\'body\\').off(\\'keydown\\', onKeyDown);\\n  window.removeEventListener(\\'resize\\', onResize);\\n  musicAudio.removeEventListener(\\'timeupdate\\', onTimeUpdate);\\n});\\n<\\/script>\\n\\n<style scoped>\\n@import url(\\'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\\');\\n@import url(\\'https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap\\');\\n\\n/* =========================================\\n   全局 Widget 基础样式\\n   ========================================= */\\n.lyrics-widget {\\n  position: absolute;\\n  top: 20%;\\n  left: 50%;\\n  transform: translate(-50%, -50%);\\n  width: 100px;\\n  height: 90px;\\n  padding: 0;\\n  border-radius: 0;\\n  box-shadow: none;\\n  background-image: url(\\'https://i.postimg.cc/y8bZ8mKH/Hello-World-Stickers-Sticker.png\\');\\n  background-size: contain;\\n  background-repeat: no-repeat;\\n  background-position: center;\\n  background-color: transparent;\\n  user-select: none;\\n  cursor: grab;\\n  z-index: 9999999;\\n  animation: floatAnim 3s ease-in-out infinite;\\n  transition:\\n    width 0.3s,\\n    height 0.3s;\\n}\\n\\n@keyframes floatAnim {\\n  0%,\\n  100% {\\n    transform: translate(-50%, -50%);\\n  }\\n  50% {\\n    transform: translate(-50%, -58%);\\n  }\\n}\\n\\n/* 收缩状态下隐藏内部 */\\n.lyrics-widget:not(.expanded) .content,\\n.lyrics-widget:not(.expanded) .win-title-bar {\\n  display: none !important;\\n  opacity: 0;\\n  pointer-events: none;\\n}\\n\\n.lyrics-widget.dragging {\\n  cursor: grabbing;\\n  animation-play-state: paused;\\n}\\n\\n/* =========================================\\n   展开状态 (Windows 95/98 窗口)\\n   ========================================= */\\n.lyrics-widget.expanded {\\n  width: 360px;\\n  height: auto;\\n  min-height: 200px;\\n  background-image: url(\\'https://i.postimg.cc/YChxRq2x/xia-zai-(4).jpg\\');\\n  background-size: cover;\\n  background-position: center;\\n  background-color: #c0c0c0;\\n\\n  /* Windows 经典 3D 凸起边框 */\\n  border: 2px solid #dfdfdf;\\n  border-right-color: #000;\\n  border-bottom-color: #000;\\n  box-shadow:\\n    inset 2px 2px #fff,\\n    inset -2px -2px #808080,\\n    4px 4px 10px rgba(0, 0, 0, 0.5);\\n\\n  border-radius: 0;\\n  padding: 2px;\\n  animation: none;\\n  cursor: default;\\n  display: flex;\\n  flex-direction: column;\\n}\\n\\n/* 标题栏 */\\n.win-title-bar {\\n  height: 24px;\\n  background: navy;\\n  background: linear-gradient(90deg, navy, #1084d0);\\n  color: white;\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  padding: 0 4px;\\n  font-family: \\'Verdana\\', sans-serif;\\n  font-size: 12px;\\n  font-weight: bold;\\n}\\n\\n.win-controls {\\n  display: flex;\\n  gap: 2px;\\n}\\n\\n/* 窗口控制按钮 (最小化、关闭等) */\\n.win-btn {\\n  width: 16px;\\n  height: 14px;\\n  background: #c0c0c0;\\n  color: black;\\n\\n  /* 经典的 Windows 按钮边框 */\\n  border-top: 1px solid #fff;\\n  border-left: 1px solid #fff;\\n  border-right: 1px solid #000;\\n  border-bottom: 1px solid #000;\\n  box-shadow: inset -1px -1px #808080;\\n\\n  font-size: 10px;\\n  line-height: 12px;\\n  text-align: center;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.win-btn:active {\\n  border-top: 1px solid #000;\\n  border-left: 1px solid #000;\\n  border-right: 1px solid #fff;\\n  border-bottom: 1px solid #fff;\\n  box-shadow: none;\\n  padding-top: 2px;\\n  padding-left: 2px;\\n}\\n\\n.win-btn.close {\\n  font-size: 14px;\\n}\\n\\n/* 内容容器 */\\n.content {\\n  position: relative;\\n  display: flex;\\n  flex-direction: column;\\n  height: 100%;\\n  padding: 10px;\\n  background: rgba(255, 255, 255, 0.7);\\n  backdrop-filter: blur(2px);\\n  /* 内凹区域边框 */\\n  border: 1px solid #808080;\\n  border-right-color: #fff;\\n  border-bottom-color: #fff;\\n  box-shadow: inset 1px 1px #000;\\n  margin: 2px;\\n}\\n\\n/* 信息显示切换区 */\\n.display-area {\\n  min-height: 80px;\\n  margin: 10px 0;\\n  position: relative;\\n}\\n\\n/* 歌词盒子 */\\n.lyrics-box {\\n  text-align: center;\\n  font-family: \\'Microsoft YaHei\\', sans-serif;\\n  color: #000;\\n  min-height: 60px;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n}\\n\\n.lyric-line.current {\\n  font-size: 18px;\\n  font-weight: bold;\\n  color: #000;\\n  text-shadow: 0 0 2px #fff;\\n}\\n\\n.lyric-line.next {\\n  font-size: 14px;\\n  color: #333;\\n  margin-top: 5px;\\n}\\n\\n/* =========================================\\n   新增：Windows 风格播放列表 (.playlist-box)\\n   ========================================= */\\n.playlist-box {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 8px;\\n  height: 150px; /* 固定高度，内部滚动 */\\n}\\n\\n/* 搜索行 */\\n.win-search-row {\\n  display: flex;\\n  gap: 4px;\\n}\\n\\n.win-input {\\n  flex: 1;\\n  background: #fff;\\n  border: 2px solid;\\n  border-color: #808080 #fff #fff #808080; /* 内凹边框 */\\n  font-family: \\'Microsoft YaHei\\', sans-serif;\\n  font-size: 12px;\\n  padding: 2px 4px;\\n  outline: none;\\n  color: #000;\\n}\\n\\n.btn-sm {\\n  min-width: 30px;\\n  font-size: 11px;\\n  height: 22px; /* 稍微矮一点适配输入框 */\\n}\\n\\n/* 列表容器 */\\n.win-list-container {\\n  flex: 1;\\n  background: #fff;\\n  border: 2px solid;\\n  border-color: #808080 #fff #fff #808080; /* 内凹 */\\n  overflow-y: auto;\\n  overflow-x: hidden;\\n}\\n\\n/* 列表主体 */\\n.win-list {\\n  list-style: none;\\n  padding: 0;\\n  margin: 0;\\n}\\n\\n.win-list-item {\\n  padding: 2px 4px;\\n  font-size: 12px;\\n  cursor: pointer;\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  color: #000;\\n  font-family: \\'Tahoma\\', sans-serif; /* 经典系统字体 */\\n}\\n\\n.win-list-item:hover {\\n  text-decoration: underline;\\n}\\n\\n/* 选中项：Windows 经典蓝底白字 */\\n.win-list-item.selected {\\n  background-color: #000080;\\n  color: #fff;\\n}\\n\\n.win-list-item.selected:hover {\\n  text-decoration: none;\\n}\\n\\n.item-text {\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  flex: 1;\\n}\\n\\n.item-close {\\n  padding: 0 4px;\\n  font-weight: bold;\\n  cursor: pointer;\\n}\\n\\n.item-close:hover {\\n  color: red;\\n}\\n.win-list-item.selected .item-close:hover {\\n  color: #ffff00;\\n}\\n\\n/* 滚动条 Webkit (Chrome/Edge) */\\n.win-list-container::-webkit-scrollbar {\\n  width: 12px;\\n}\\n.win-list-container::-webkit-scrollbar-track {\\n  background: #dfdfdf;\\n  border-left: 1px solid #fff;\\n}\\n.win-list-container::-webkit-scrollbar-thumb {\\n  background: #c0c0c0;\\n  border: 1px solid #fff;\\n  border-right-color: #000;\\n  border-bottom-color: #000;\\n  box-shadow: inset 1px 1px #fff;\\n}\\n\\n/* 歌曲信息栏 */\\n.song-info {\\n  text-align: left;\\n  font-size: 12px;\\n  color: #333;\\n  border-bottom: 1px dashed #666;\\n  padding-bottom: 5px;\\n  margin-bottom: 5px;\\n}\\n\\n.bottom-controls {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between;\\n  margin-top: auto;\\n  padding-top: 10px;\\n}\\n\\n.controls {\\n  display: flex;\\n  gap: 6px;\\n}\\n\\n/* 复古按钮样式 (.btn) */\\n.btn {\\n  min-width: 32px;\\n  height: 28px;\\n  padding: 0 5px;\\n  background: #c0c0c0;\\n  color: #000;\\n  border-top: 1px solid #fff;\\n  border-left: 1px solid #fff;\\n  border-right: 1px solid #000;\\n  border-bottom: 1px solid #000;\\n  box-shadow: inset -1px -1px #808080;\\n  font-size: 12px;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  transition: none;\\n}\\n\\n.btn:active {\\n  border-top: 1px solid #000;\\n  border-left: 1px solid #000;\\n  border-right: 1px solid #fff;\\n  border-bottom: 1px solid #fff;\\n  box-shadow: none;\\n  padding-top: 2px;\\n  padding-left: 2px;\\n}\\n\\n.btn i {\\n  font-size: 12px;\\n}\\n\\n.volume-container {\\n  display: flex;\\n  align-items: center;\\n  gap: 5px;\\n  width: 100px;\\n}\\n\\n.vol-icon {\\n  color: #333;\\n  font-size: 12px;\\n}\\n\\n/* Input 强制重置 */\\ninput[type=\\'range\\'].volume-slider {\\n  -webkit-appearance: none !important;\\n  appearance: none !important;\\n  background: transparent !important;\\n  filter: none !important;\\n  border: none !important;\\n  border-radius: 0 !important;\\n  outline: none !important;\\n  box-shadow: none !important;\\n  width: 100% !important;\\n  height: 20px !important;\\n  margin: 0 !important;\\n  padding: 0 !important;\\n  cursor: pointer !important;\\n}\\n\\ninput[type=\\'range\\'].volume-slider::-webkit-slider-runnable-track {\\n  width: 100% !important;\\n  height: 6px !important;\\n  background: #fff !important;\\n  border-top: 1px solid #808080 !important;\\n  border-left: 1px solid #808080 !important;\\n  border-right: 1px solid #fff !important;\\n  border-bottom: 1px solid #fff !important;\\n  box-shadow: inset 1px 1px #000 !important;\\n  border-radius: 0 !important;\\n}\\n\\ninput[type=\\'range\\'].volume-slider::-webkit-slider-thumb {\\n  -webkit-appearance: none !important;\\n  appearance: none !important;\\n  width: 10px !important;\\n  height: 16px !important;\\n  margin-top: -6px !important;\\n  background: #c0c0c0 !important;\\n  border-top: 1px solid #fff !important;\\n  border-left: 1px solid #fff !important;\\n  border-right: 1px solid #000 !important;\\n  border-bottom: 1px solid #000 !important;\\n  box-shadow: inset -1px -1px #808080 !important;\\n  border-radius: 0 !important;\\n}\\n\\n.lyrics-widget.near-boundary {\\n  box-shadow: inset 0 0 10px red;\\n}\\n/* 【新增样式】 游戏手柄按钮 */\\n.expand-trigger {\\n  position: absolute;\\n  /* 调整这里控制左下角的位置 */\\n  left: -10px;\\n  bottom: -10px;\\n  width: 40px; /* 根据图片大小调整 */\\n  height: 40px;\\n  cursor: pointer;\\n  z-index: 100; /* 确保在背景贴纸上面 */\\n  transition: transform 0.1s;\\n}\\n\\n/* 简单的点击按压效果 */\\n.expand-trigger:active {\\n  transform: scale(0.9);\\n}\\n\\n.expand-trigger img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: contain;\\n  image-rendering: pixelated; /* 保持像素画清晰，不模糊 */\\n  /* 给手柄加一点阴影让它更明显 */\\n  filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.5));\\n}\\n\\n/* 当窗口展开 (.expanded) 时，隐藏这个手柄，因为已经变成了 Windows 界面 */\\n.lyrics-widget.expanded .expand-trigger {\\n  display: none;\\n}\\n/* =========================================\\n   【修改】游戏手柄展开按钮\\n   ========================================= */\\n.expand-trigger {\\n  position: absolute;\\n  left: -12px; /* 根据旋转角度微调位置 */\\n  bottom: -12px;\\n  width: 48px;\\n  width: 48px;        /* 稍微加大一点尺寸 */\\n  height: 48px;\\n  cursor: pointer;\\n  z-index: 100;\\n\\n  /* 1. 向右旋转 20度 */\\n  transform: rotate(20deg);\\n\\n  /* 添加平滑过渡动画 */\\n  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\\n}\\n\\n/* 图片渲染设置 */\\n.expand-trigger img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: contain;\\n  image-rendering: pixelated; /* 像素画必须加这个 */\\n\\n  /* 2. 添加效果：硬边投影（像素风格阴影） */\\n  filter: drop-shadow(3px 3px 0px rgba(0, 0, 0, 0.4));\\n  transition: filter 0.3s;\\n}\\n\\n/* 3. 鼠标悬停效果：变大、变亮、微微上浮 */\\n.expand-trigger:hover {\\n  /* 保持旋转的同时放大 1.15 倍，并向上浮动 3像素 */\\n  transform: rotate(20deg) scale(1.15) translateY(-3px);\\n  z-index: 101;\\n}\\n\\n.expand-trigger:hover img {\\n  /* 悬停时投影变远一点，产生悬浮感，并增加亮度 */\\n  filter: drop-shadow(5px 5px 0px rgba(0, 0, 0, 0.3)) brightness(1.1);\\n}\\n\\n/* 点击时的按压效果 */\\n.expand-trigger:active {\\n  transform: rotate(20deg) scale(0.95) translateY(0);\\n}\\n\\n.expand-trigger:active img {\\n  filter: drop-shadow(1px 1px 0px rgba(0, 0, 0, 0.5));\\n}\\n\\n/* 展开成窗口后隐藏 */\\n.lyrics-widget.expanded .expand-trigger {\\n  display: none;\\n  pointer-events: none;\\n}\\n</style>\\n'],sourceRoot:''}]);const r=s},400:(n,e)=>{e.A=(n,e)=>{const t=n.__vccOpts||n;for(const[n,i]of e)t[n]=i;return t}},424:(n,e,t)=>{function i(n,e){for(var t=[],i={},o=0;o<e.length;o++){var a=e[o],s=a[0],r={id:n+':'+o,css:a[1],media:a[2],sourceMap:a[3]};i[s]?i[s].parts.push(r):t.push(i[s]={id:s,parts:[r]})}return t}t.d(e,{A:()=>A});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Ошибка('vue-style-loader cannot be used in a non-browser environment. Use { target: \\'node\\' } in your Webpack config to indicate a server-rendering environment.');var a={},s=o&&(document.head||document.getElementsByTagName('head')[0]),r=null,l=0,d=!1,c=function(){},u=null,p='data-vue-ssr-id',f='undefined'!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function A(n,e,t,o){d=t,u=o||{};var s=i(n,e);return m(s),function(e){for(var t=[],o=0;o<s.length;o++){var r=s[o];(l=a[r.id]).refs--,t.push(l)}e?m(s=i(n,e)):s=[];for(o=0;o<t.length;o++){var l;if(0===(l=t[o]).refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete a[l.id]}}}}function m(n){for(var e=0;e<n.length;e++){var t=n[e],i=a[t.id];if(i){i.refs++;for(var o=0;o<i.parts.length;o++)i.parts[o](t.parts[o]);for(;o<t.parts.length;o++)i.parts.push(C(t.parts[o]));i.parts.length>t.parts.length&&(i.parts.length=t.parts.length)}else{var s=[];for(o=0;o<t.parts.length;o++)s.push(C(t.parts[o]));a[t.id]={id:t.id,refs:1,parts:s}}}}function g(){var n=document.createElement('style');return n.type='text/css',s.appendChild(n),n}function C(n){var e,t,i=document.querySelector('style['+p+'~=\"'+n.id+'\"]');if(i){if(d)return c;i.parentNode.removeChild(i)}if(f){var o=l++;i=r||(r=g()),e=h.bind(null,i,o,!1),t=h.bind(null,i,o,!0)}else i=g(),e=b.bind(null,i),t=function(){i.parentNode.removeChild(i)};return e(n),function(i){if(i){if(i.css===n.css&&i.media===n.media&&i.sourceMap===n.sourceMap)return;e(n=i)}else t()}}var x,v=(x=[],function(n,e){return x[n]=e,x.filter(Boolean).join('\\n')});function h(n,e,t,i){var o=t?'':i.css;if(n.styleSheet)n.styleSheet.cssText=v(e,o);else{var a=document.createTextNode(o),s=n.childNodes;s[e]&&n.removeChild(s[e]),s.length?n.insertBefore(a,s[e]):n.appendChild(a)}}function b(n,e){var t=e.css,i=e.media,o=e.sourceMap;if(i&&n.setAttribute('media',i),u.ssrId&&n.setAttribute(p,e.id),o&&(t+='\\n/*# sourceURL='+o.sources[0]+' */',t+='\\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),n.styleSheet)n.styleSheet.cssText=t;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(document.createTextNode(t))}}}},e={};function t(i){var o=e[i];if(void 0!==o)return o.exports;var a=e[i]={id:i,exports:{}};return n[i](a,a.exports,t),a.exports}t.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return t.d(e,{a:e}),e},t.d=(n,e)=>{for(var i in e)t.o(e,i)&&!t.o(n,i)&&Object.defineProperty(n,i,{enumerable:!0,get:e[i]})},t.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),t.r=n=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(n,'__esModule',{value:!0})};const i=Vue,o=(0,i.reactive)({music:{cache:{},regex:/<bgm>текущая музыка[:：](.+?) - (.+?)<\\/bgm>/g,list:[],customList:JSON.parse(localStorage.getItem('tavern_music_custom_list')||'[]'),index:-1,autoPlayer:!1,saveCustomList(){localStorage.setItem('tavern_music_custom_list',JSON.stringify(this.customList))},async getAllChatMessages(){this.index=-1;const n=await triggerSlash('/pass {{lastMessageId}}');if(!n)return void(this.customList.length>0&&(this.list=[...this.customList],this.index=0));const e=[],t=await getChatMessages(`0-${n}`,{role:'all'});for(const n of t){const t=[...n.message.matchAll(this.regex)];if(0==t.length)continue;const i=t.at(-1),o={song:i[1],singer:i[2],message_id:n.message_id,isCustom:!1};e.push(o)}this.list=e.concat(this.customList),console.log('合并后的播放列表:',this.list),this.list.length>0&&(this.index=this.list.length-1)},checkAudioAvailability:async n=>new Promise(e=>{const t=new Audio;let i;const o=()=>{s(),e(!0)},a=()=>{s(),e(!1)},s=()=>{t.removeEventListener('loadedmetadata',o),t.removeEventListener('error',a),clearTimeout(i),t.src=''};t.preload='metadata',t.src=n,i=setTimeout(a,3e3),t.addEventListener('loadedmetadata',o),t.addEventListener('error',a)})}}),a={class:'win-title-bar'},s={class:'win-controls'},r=['title'],l={class:'content'},d={class:'song-info'},c={class:'song-title'},u={class:'lyrics-box'},p={class:'lyric-line lyric-current current'},f={class:'lyric-line lyric-next next'},A={class:'win-search-row'},m={class:'win-list-container'},g={class:'win-list'},C=['onClick'],x={class:'item-text'},v=['onClick'],h={key:0,class:'win-list-item empty'},b={class:'controls btn-group'},y={class:'volume-control volume-container'},w=(0,i.defineComponent)({__name:'musicPlayer',setup(n){const e=(0,i.ref)(!1),t=(0,i.ref)(65),w=(0,i.ref)('Ready...'),B=(0,i.ref)('Waiting for command'),E=(0,i.ref)(''),k=(0,i.ref)(''),S=(0,i.ref)(''),L=(0,i.ref)([]),M=(0,i.ref)(-1),T=(0,i.ref)(!1),N=(0,i.ref)(-1),Y=(0,i.ref)(!1),D=(0,i.ref)(''),W=new Audio;new Array;W.volume=t.value/100,(0,i.watch)(t,n=>{W.volume=n/100});const P=globalThis.Music;function V(){Y.value=!Y.value,sn()}async function F(){const n=D.value.trim();if(!n)return;const e={song:n,name:n,singer:'Поиск...',isCustom:!0};o.music.customList.push(e),o.music.saveCustomList(),o.music.list.push(e),D.value='';const t=o.music.list.length-1;o.music.index=t,I(t)}function U(n){const e=L.value;if(!e.length)return w.value='',B.value='',void(M.value=-1);let t=e.length-1;for(let i=0;i<e.length;i++)if(n<e[i].time){t=i-1;break}if(t<0)return w.value='',B.value=e[0]?.text??'',void(M.value=-1);t!==M.value&&(M.value=t,w.value=e[t]?.text??'',B.value=e[t+1]?.text??'')}function X(){U(W.currentTime||0)}async function j(n,t){if(n?.stopPropagation(),sn(),'stop'==t)return W.pause(),void(e.value=!1);let i=o.music.index;if(-1==i&&o.music.list.length>0&&(i=0),-1!=i||'play'===t){if(i>o.music.list.length-1&&(i=o.music.list.length-1,o.music.index=i),'play'==t){if(-1===i)return;const n=T.value&&N.value===i&&W.src;if(!e.value&&n)return W.play(),void(e.value=!0);I(i)}'prev'==t&&(i>0?i-=1:i<=0&&(i=o.music.list.length-1),o.music.index=i,I(i)),'next'==t&&(i>=o.music.list.length-1?i=0:i+=1,o.music.index=i,I(i))}}async function I(n){if(!o.music.list[n])return;const t=o.music.list[n],i=t.song||t.name;let a='';const s=o.music.cache[i],r=s&&'object'==typeof s?s:null;if(s){const n='string'==typeof s?s:s.Url;if(n){await o.music.checkAudioAvailability(n)&&(a=n,r&&(k.value=r.Singer,E.value=r.Name,S.value=r.Lyric))}}let l=null;if(!a){w.value='Поиск...',B.value='Подождите';const n=await P.SearchMusic(i);if(console.log(JSON.stringify(n)),!n?.Url)return w.value='Ошибка',void(B.value='Retry manually');a=n.Url,l=n,o.music.cache[i]=n}a!=W.src&&(W.src=a);const d=l||r;d?(k.value=d.Singer,E.value=d.Name,S.value=d.Lyric):(k.value=t.singer||'Unknown',E.value=i),S.value?(L.value=function(n){const e=n.split(/\\r?\\n/),t=[];for(const n of e){const e=n.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g),i=n.replace(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g,'').trim();if(e&&i)for(const n of e){const e=n.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/);if(!e)continue;const o=60*Number(e[1])+Number(e[2])+(e[3]?Number(e[3].padEnd(3,'0')):0)/1e3;t.push({time:o,text:i})}}return t.sort((n,e)=>n.time-e.time),t}(S.value||''),M.value=-1,U(0)):(L.value=[],w.value=E.value,B.value='Нет текста'),W.play(),e.value=!0,T.value=!0,N.value=n}(0,i.watch)(()=>o.music.index,(n,e)=>{console.log('index 变化:',e,'->',n),-1==e&&n>-1&&j(null,'play')});const R=(0,i.ref)(null);let O=0,G=0,H=0,q=0;const Z=(0,i.ref)('50%'),K=(0,i.ref)('20%');let J=null;const Q=(0,i.ref)(!1),nn=(0,i.ref)(!1),en=(0,i.ref)(!1),tn=$('body').width()||0,on=$('body').height()||0,an=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function sn(){clearTimeout(J);const n=R.value;n&&n.classList.contains('expanded')&&(J=setTimeout(()=>{Y.value||n.classList.remove('expanded')},5e3))}function rn(n){const e=R.value;if(!e)return;if(2===n.button||3===n.which)return void(en.value=!0);if(n.target.closest('.bottom-controls')||n.target.closest('.win-btn')||n.target.closest('.playlist-box')||n.target.closest('input'))return void(e.classList.contains('expanded')&&clearTimeout(J));en.value=!1,Q.value=!0,nn.value=!1,e.classList.add('dragging'),clearTimeout(J);const t=e.getBoundingClientRect();H=t.left+t.width/2,q=t.top+t.height/2,'mousedown'===n.type?(O=n.clientX,G=n.clientY,$('body').on('mousemove',ln),$('body').on('mouseup',dn)):'touchstart'===n.type&&(O=n.touches[0].clientX,G=n.touches[0].clientY,$('body').on('touchmove',ln),$('body').on('touchend',dn))}function ln(n){if(!Q.value||en.value)return;let e,t;n&&'function'==typeof n.preventDefault&&n.preventDefault(),nn.value=!0,'mousemove'===n.type?(e=n.clientX,t=n.clientY):'touchmove'===n.type&&(e=n.touches[0].clientX,t=n.touches[0].clientY);const i=H+(e-O),o=q+(t-G),a=tn-20,s=on-20,r=Math.max(20,Math.min(a,i)),l=Math.max(20,Math.min(s,o));i!==r||o!==l?R.value.classList.add('near-boundary'):R.value.classList.remove('near-boundary'),Z.value=`${i}px`,K.value=`${o}px`}function dn(n){if(!Q.value&&!en.value)return;if($('body').off('mousemove',ln),$('body').off('mouseup',dn),$('body').off('touchmove',ln),$('body').off('touchend',dn),en.value)return void(en.value=!1);const e=R.value,t=e&&e.classList.contains('expanded');Q.value=!1,e&&e.classList.remove('dragging','near-boundary');const i=e?e.style.transform:'';i&&i.includes('scale')&&(e.style.transform=''),nn.value&&(cn(),t&&setTimeout(()=>{sn()},100)),nn.value=!1}function cn(){const n=R.value;if(!n)return;const e=n.getBoundingClientRect(),t={x:(e.left+e.width/2)/tn*100,y:(e.top+e.height/2)/on*100};localStorage.setItem('lyricsWidgetPosition',JSON.stringify(t))}function un(n){const e=R.value;e&&(Q.value||nn.value||en.value||(e.classList.contains('expanded')?(e.classList.remove('expanded'),Y.value=!1,clearTimeout(J)):(e.classList.add('expanded'),sn())))}function pn(n){const e=R.value;en.value=!0,Q.value&&(Q.value=!1,e&&e.classList.remove('dragging','near-boundary'))}function fn(){if(an)return;const n=R.value;n&&n.classList.contains('expanded')&&!Q.value&&!en.value&&clearTimeout(J)}function An(){if(an)return;const n=R.value;!n||!n.classList.contains('expanded')||Q.value||en.value||Y.value||(clearTimeout(J),J=setTimeout(()=>{n.classList.remove('expanded')},2e3))}function mn(){if(!an)return;clearTimeout(J);const n=R.value;n&&n.classList.contains('expanded')&&!Q.value&&(J=setTimeout(()=>{sn()},100))}function gn(){const n=R.value;if(!n)return;const e=n.getBoundingClientRect(),t=e.left+e.width/2,i=e.top+e.height/2,o=tn-50,a=on-50,s=Math.max(50,Math.min(o,t)),r=Math.max(50,Math.min(a,i));n.style.left=s/tn*100+'%',n.style.top=r/on*100+'%',cn()}function Cn(){const n=R.value;document.hidden?clearTimeout(J):n&&n.classList.contains('expanded')&&sn()}function xn(n){!en.value||n.target&&n.target.closest&&n.target.closest('.lyrics-widget')||(en.value=!1)}function vn(n){'Escape'===n.key&&(en.value=!1)}return(0,i.onMounted)(()=>{R.value&&R.value.addEventListener('touchmove',n=>{Q.value&&!en.value&&n.preventDefault()},{passive:!1}),$('body').on('visibilitychange',Cn),$('body').on('click',xn),$('body').on('keydown',vn),window.addEventListener('resize',gn),function(){const n=R.value;if(!n)return;const e=localStorage.getItem('lyricsWidgetPosition');if(e){const t=JSON.parse(e);let i='50';t.x<100&&t.x>0&&(i=t.x);let o='20';t.y<100&&t.y>0&&(o=t.y),n.style.left=i+'%',n.style.top=o+'%'}}(),W.addEventListener('timeupdate',X)}),(0,i.onBeforeUnmount)(()=>{clearTimeout(J),$('body').off('mousemove',ln),$('body').off('mouseup',dn),$('body').off('touchmove',ln),$('body').off('touchend',dn),$('body').off('visibilitychange',Cn),$('body').off('click',xn),$('body').off('keydown',vn),window.removeEventListener('resize',gn),W.removeEventListener('timeupdate',X)}),(n,S)=>((0,i.openBlock)(),(0,i.createElementBlock)('div',{id:'lyricsWidget',ref_key:'widget',ref:R,class:(0,i.normalizeClass)(['lyrics-widget',{expanded:R.value?.classList.contains('expanded')}]),style:(0,i.normalizeStyle)(`top:${K.value};left:${Z.value}`),onMousedown:rn,onTouchstart:rn,onContextmenu:pn,onMouseenter:fn,onMouseleave:An,onTouchend:mn},[(0,i.createCommentVNode)(' 【新增代码 开始】 游戏手柄展开按钮 '),(0,i.createCommentVNode)(' mousedown.stop 防止点击按钮时触发父级的拖拽逻辑 '),(0,i.createElementVNode)('div',{class:'expand-trigger',onClick:(0,i.withModifiers)(un,['stop']),onMousedown:S[0]||(S[0]=(0,i.withModifiers)(()=>{},['stop'])),onTouchstart:S[1]||(S[1]=(0,i.withModifiers)(()=>{},['stop']))},[...S[10]||(S[10]=[(0,i.createElementVNode)('img',{src:'https://i.postimg.cc/jSKcXjdM/Controller-Pixel-Art.png',alt:'Open'},null,-1)])],32),(0,i.createCommentVNode)(' Windows 标题栏 '),(0,i.createElementVNode)('div',a,[S[12]||(S[12]=(0,i.createElementVNode)('div',{class:'win-title-text'},[(0,i.createElementVNode)('i',{class:'fas fa-music',style:{'margin-right':'4px','font-size':'10px'}}),(0,i.createTextVNode)('WinAmp.exe ')],-1)),(0,i.createElementVNode)('div',s,[S[11]||(S[11]=(0,i.createElementVNode)('div',{class:'win-btn',title:'最小化'},'_',-1)),(0,i.createCommentVNode)(' 【修改点】点击最大化按钮切换播放列表 '),(0,i.createElementVNode)('div',{class:'win-btn',title:Y.value?'显示歌词':'播放列表',onClick:(0,i.withModifiers)(V,['stop'])},(0,i.toDisplayString)(Y.value?'≡':'□'),9,r),(0,i.createCommentVNode)(' 点击关闭按钮触发收缩 '),(0,i.createElementVNode)('div',{class:'win-btn close',onClick:(0,i.withModifiers)(un,['stop'])},'×')])]),(0,i.createElementVNode)('div',l,[(0,i.createElementVNode)('div',d,[(0,i.createElementVNode)('div',c,(0,i.toDisplayString)(E.value)+' - '+(0,i.toDisplayString)(k.value),1)]),(0,i.createCommentVNode)('\\n         内容显示区\\n         这里根据 showПлейлист 状态切换显示\\n      '),(0,i.createElementVNode)('div',{class:'display-area',onClick:un},[(0,i.createCommentVNode)(' 视图 A: 歌词 (默认) '),(0,i.withDirectives)((0,i.createElementVNode)('div',u,[(0,i.createElementVNode)('div',p,(0,i.toDisplayString)(w.value),1),(0,i.createElementVNode)('div',f,(0,i.toDisplayString)(B.value),1)],512),[[i.vShow,!Y.value]]),(0,i.createCommentVNode)(' 视图 B: 播放列表与搜索 (Windows 风格) '),(0,i.withDirectives)((0,i.createElementVNode)('div',{class:'playlist-box',onClick:S[3]||(S[3]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.createCommentVNode)(' 搜索栏 '),(0,i.createElementVNode)('div',A,[(0,i.withDirectives)((0,i.createElementVNode)('input',{type:'text',class:'win-input','onUpdate:modelValue':S[2]||(S[2]=n=>D.value=n),placeholder:'Search...',onKeyup:(0,i.withKeys)(F,['enter'])},null,544),[[i.vModelText,D.value]]),(0,i.createElementVNode)('button',{class:'btn btn-sm',onClick:F},'Go')]),(0,i.createCommentVNode)(' 列表区域 (白色凹陷框) '),(0,i.createElementVNode)('div',m,[(0,i.createElementVNode)('ul',g,[((0,i.openBlock)(!0),(0,i.createElementBlock)(i.Fragment,null,(0,i.renderList)((0,i.unref)(o).music.list,(n,t)=>((0,i.openBlock)(),(0,i.createElementBlock)('li',{key:t,class:(0,i.normalizeClass)(['win-list-item',{selected:t===(0,i.unref)(o).music.index}]),onClick:n=>function(n){n===o.music.index&&e.value||(o.music.index=n,I(n))}(t)},[(0,i.createElementVNode)('span',x,(0,i.toDisplayString)(t+1)+'. '+(0,i.toDisplayString)(n.song||n.name||'Unknown'),1),(0,i.createElementVNode)('span',{class:'item-close',onClick:(0,i.withModifiers)(n=>function(n){const e=o.music.list[n];if(n<o.music.index?o.music.index--:n===o.music.index&&(o.music.index>0?o.music.index--:o.music.index=-1),o.music.list.splice(n,1),e.isCustom){const n=o.music.customList.indexOf(e);if(-1!==n)o.music.customList.splice(n,1);else{const n=o.music.customList.findIndex(n=>n.song===e.song&&n.name===e.name);-1!==n&&o.music.customList.splice(n,1)}o.music.saveCustomList()}}(t),['stop'])},'×',8,v)],10,C))),128)),0===(0,i.unref)(o).music.list.length?((0,i.openBlock)(),(0,i.createElementBlock)('li',h,'(Пусто List)')):(0,i.createCommentVNode)('v-if',!0)])])],512),[[i.vShow,Y.value]])]),(0,i.createElementVNode)('div',{class:'bottom-controls controls-area',onClick:S[9]||(S[9]=(0,i.withModifiers)(()=>{},['stop']))},[(0,i.createElementVNode)('div',b,[(0,i.createElementVNode)('button',{class:'btn prev-btn',title:'上一首',onClick:S[4]||(S[4]=n=>j(n,'prev'))},[...S[13]||(S[13]=[(0,i.createElementVNode)('i',{class:'fas fa-step-backward'},null,-1)])]),(0,i.createElementVNode)('button',{class:'btn btn-play',title:'播放/暂停',onClick:S[5]||(S[5]=n=>j(n,e.value?'stop':'play'))},[(0,i.createElementVNode)('i',{class:(0,i.normalizeClass)(['fas',e.value?'fa-pause':'fa-play'])},null,2)]),(0,i.createElementVNode)('button',{class:'btn next-btn',title:'下一首',onClick:S[6]||(S[6]=n=>j(n,'next'))},[...S[14]||(S[14]=[(0,i.createElementVNode)('i',{class:'fas fa-step-forward'},null,-1)])])]),(0,i.createElementVNode)('div',y,[S[15]||(S[15]=(0,i.createElementVNode)('i',{class:'fas fa-volume-down vol-icon'},null,-1)),(0,i.withDirectives)((0,i.createElementVNode)('input',{type:'range',class:'volume-slider volume-track',min:'0',max:'100','onUpdate:modelValue':S[7]||(S[7]=n=>t.value=n),onClick:S[8]||(S[8]=(0,i.withModifiers)(()=>{},['stop'])),style:(0,i.normalizeStyle)({'--volume-fill':t.value+'%'})},null,4),[[i.vModelText,t.value]])])])])],38))}});t(336);const B=(0,t(400).A)(w,[['__scopeId','data-v-62df65df']]),E=(0,i.createApp)(B);function k(){return globalThis.Music?Promise.resolve():new Promise((n,e)=>{const t=document.createElement('script');t.src='https://drive.baibai.cv/f/ZKEBuW/Music.js',t.onload=()=>n(),t.onerror=()=>e(),document.head.appendChild(t)})}async function S(n,e){if(console.log(n),e-=1,'Сообщение создано'==n){const n=await getChatMessages(`${e}-${e}`,{role:'all'}),t=o.music.list.filter(n=>n.message_id!==e);for(const e of n){const n=[...e.message.matchAll(o.music.regex)];if(0==n.length)continue;const i=n.at(-1),a={song:i[1],singer:i[2],message_id:e.message_id};t.push(a)}t.sort((n,e)=>n.message_id-e.message_id),o.music.list=t,o.music.index=t.length>0?t.length-1:-1}else await o.music.getAllChatMessages()}function L(){try{$(`head > div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('Ошибка при удалении стилей')}}function M(){try{$(`div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('Ошибка при удалении div')}}$(async()=>{try{await k(),await function(){try{L(),M()}catch{}const n=$('<div>').attr('script_id',getScriptId());$('body').append(n),E.mount(n[0]),function(){try{if($(`head > div[script_id=\"${getScriptId()}\"]`).length>0)return;const n=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(n)}catch{console.log('Ошибка при перемещении CSS')}}()}(),console.log('Плеер загружен!'),eventOn(tavern_events.CHAT_CHANGED,()=>S('Чат переключён')),eventOn(tavern_events.MESSAGE_UPDATED,n=>S('Сообщение обновлено',n)),eventOn(tavern_events.GENERATION_ENDED,n=>S('Сообщение создано',n)),eventOn(tavern_events.MESSAGE_SWIPED,()=>S('Сообщение переключено')),eventOn(tavern_events.MESSAGE_DELETED,()=>S('Сообщение удалено')),eventOn(tavern_events.MESSAGE_SENT,()=>{console.log('Сообщение отправлено')}),eventOn(tavern_events.GENERATION_STOPPED,()=>{console.log('Генерация остановлена')}),await o.music.getAllChatMessages()}catch(n){console.error(n),toastr.error(`Ошибка загрузки:${n}`)}}),$(window).on('pagehide',()=>{console.log('Вызвано pagehide');try{E.unmount(),L(),M()}catch{}});export{k as ensureMusicLoaded};\n//# sourceMappingURL=index.js.map",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}