{
  "type": "script",
  "enabled": false,
  "name": "Оригинал фиол (RU)",
  "id": "97409556-b924-4d51-b789-0dc5e08ad857",
  "content": "import'https://testingcf.jsdelivr.net/npm/vue3-draggable-resizable/dist/Vue3DraggableResizable.css/+esm';var e={99:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n='',a=void 0!==t[5];return t[4]&&(n+='@supports ('.concat(t[4],') {')),t[2]&&(n+='@media '.concat(t[2],' {')),a&&(n+='@layer'.concat(t[5].length>0?' '.concat(t[5]):'',' {')),n+=e(t),a&&(n+='}'),t[2]&&(n+='}'),t[4]&&(n+='}'),n}).join('')},t.i=function(e,n,a,o,i){'string'==typeof e&&(e=[[null,e,void 0]]);var r={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(r[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&r[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]='@layer'.concat(d[5].length>0?' '.concat(d[5]):'',' {').concat(d[1],'}')),d[5]=i),n&&(d[2]?(d[1]='@media '.concat(d[2],' {').concat(d[1],'}'),d[2]=n):d[2]=n),o&&(d[4]?(d[1]='@supports ('.concat(d[4],') {').concat(d[1],'}'),d[4]=o):d[4]=''.concat(o)),t.push(d))}},t}},205:(e,t,n)=>{n.r(t),n.d(t,{default:()=>s});var a=n(226),o=n.n(a),i=n(99),r=n.n(i)()(o());r.push([e.id,'@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css);']),r.push([e.id,'.lyrics-widget[data-v-ce7a4204]{position:absolute;top:20%;left:50%;transform:translate(-50%,-50%);width:280px;padding:18px;border-radius:25px;box-shadow:0 10px 30px rgba(161,140,209,0.4);-webkit-user-select:none;user-select:none;transition:all 0.4s ease;cursor:pointer;z-index:9999999;overflow:hidden;color:#ffffff;font-family:\\'Varela Round\\',\\'Microsoft YaHei\\',\\'PingFang SC\\',sans-serif;background-image:linear-gradient(135deg,#a18cd1 0%,#fbc2eb 100%)}.lyrics-widget.dragging[data-v-ce7a4204]{cursor:grabbing;box-shadow:0 16px 36px rgba(161,140,209,0.55);transition:none}.lyrics-widget.expanded[data-v-ce7a4204]{padding:18px;cursor:default}.lyrics-widget.expanded.dragging[data-v-ce7a4204]{cursor:grabbing}.content[data-v-ce7a4204]{position:relative;z-index:1;text-align:center;display:flex;flex-direction:column;height:100%}.circle-deco[data-v-ce7a4204]{position:absolute;border-radius:50%;background:rgba(255,255,255,0.16);z-index:0}.circle-deco.c1[data-v-ce7a4204]{width:100px;height:100px;top:-30px;left:-30px}.circle-deco.c2[data-v-ce7a4204]{width:60px;height:60px;bottom:40px;right:-20px}.lyrics-display[data-v-ce7a4204]{text-align:center;min-height:84px;display:flex;flex-direction:column;justify-content:center;gap:6px;transition:all 0.4s ease;position:relative;z-index:2}.lyrics-widget.expanded .lyrics-display[data-v-ce7a4204]{min-height:78px;margin-bottom:14px;gap:6px}.lyric-line[data-v-ce7a4204]{font-size:16px;color:rgba(255,255,255,0.92);text-shadow:0 2px 4px rgba(0,0,0,0.12);transition:all 0.4s ease;line-height:1.35;letter-spacing:0.8px;pointer-events:none}.lyric-line.current[data-v-ce7a4204]{font-size:18px;color:#ffffff;font-weight:700;letter-spacing:1px;transform:scale(1.02)}.lyric-line.next[data-v-ce7a4204]{opacity:0.65;font-size:13px}.lyrics-widget.expanded .lyric-line[data-v-ce7a4204]{font-size:15px}.lyrics-widget.expanded .lyric-line.current[data-v-ce7a4204]{font-size:17px}.lyrics-widget.expanded .lyric-line.next[data-v-ce7a4204]{font-size:12px}.song-info[data-v-ce7a4204]{text-align:center;margin-bottom:6px;opacity:0;transform:translateY(-8px);transition:all 0.4s ease;pointer-events:none;display:none;position:relative;z-index:2}.lyrics-widget.expanded .song-info[data-v-ce7a4204]{display:block;opacity:0.85;transform:translateY(0);pointer-events:auto}.song-title[data-v-ce7a4204]{font-size:13px;color:rgba(255,255,255,0.8);font-weight:500;letter-spacing:1px}.bottom-controls[data-v-ce7a4204]{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:0;opacity:0;transform:translateY(10px);transition:all 0.4s ease;pointer-events:none;height:0;overflow:hidden;position:relative;z-index:3;background:rgba(255,255,255,0.25);border-radius:20px;backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px)}.lyrics-widget.expanded .bottom-controls[data-v-ce7a4204]{opacity:1;transform:translateY(0);pointer-events:auto;height:auto;padding:8px 14px}.controls[data-v-ce7a4204]{display:flex;align-items:center;gap:15px}.btn[data-v-ce7a4204]{background:none;border:none;color:#ffffff;cursor:pointer;transition:transform 0.2s ease;padding:0;font-size:14px}.btn[data-v-ce7a4204]:hover{transform:scale(1.15)}.btn-play[data-v-ce7a4204]{font-size:18px}.volume-control[data-v-ce7a4204]{flex:0 0 auto !important;display:flex !important;align-items:center !important;gap:8px !important;width:90px !important;height:100%}.vol-icon[data-v-ce7a4204]{font-size:12px;color:#fff;opacity:1 !important;text-shadow:0 1px 2px rgba(0,0,0,0.1)}.volume-slider[data-v-ce7a4204]{-webkit-appearance:none !important;appearance:none !important;border:none !important;outline:none !important;background:transparent !important;filter:none !important;box-shadow:none !important;margin:0 !important;padding:0 !important;width:100% !important;height:100% !important;display:flex;align-items:center;cursor:pointer !important}.volume-slider[data-v-ce7a4204]::-webkit-slider-runnable-track{width:100%;height:4px;border-radius:2px;border:none;background-image:linear-gradient(90deg,#ffffff 0%,#ffffff var(--volume-fill,0%),rgba(255,255,255,0.3) var(--volume-fill,0%),rgba(255,255,255,0.3) 100%);background-size:100% 100% !important;background-repeat:no-repeat}.volume-slider[data-v-ce7a4204]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;height:14px !important;width:14px !important;border-radius:50%;background:#ffffff !important;box-shadow:0 1px 3px rgba(0,0,0,0.3) !important;margin-top:-5px !important;border:none !important;cursor:pointer !important;-webkit-transition:transform 0.1s cubic-bezier(0.4,0,0.2,1);transition:transform 0.1s cubic-bezier(0.4,0,0.2,1);position:relative;z-index:2}.volume-slider[data-v-ce7a4204]::-webkit-slider-thumb:hover{transform:scale(1.2)}.volume-slider[data-v-ce7a4204]::-moz-range-track{width:100%;height:4px;border-radius:2px;background-image:linear-gradient(90deg,#ffffff 0%,#ffffff var(--volume-fill,0%),rgba(255,255,255,0.3) var(--volume-fill,0%),rgba(255,255,255,0.3) 100%);background-size:100% 100% !important}.volume-slider[data-v-ce7a4204]::-moz-range-thumb{height:14px !important;width:14px !important;border:none !important;border-radius:50%;background:#ffffff !important;cursor:pointer !important;box-shadow:0 1px 3px rgba(0,0,0,0.3) !important}.lyrics-widget.near-boundary[data-v-ce7a4204]{box-shadow:0 10px 30px rgba(255,0,0,0.35)}@media (max-width:380px){.lyrics-widget[data-v-ce7a4204]{width:260px}.lyric-line[data-v-ce7a4204]{font-size:15px}.lyric-line.current[data-v-ce7a4204]{font-size:17px}.btn[data-v-ce7a4204]{font-size:16px}.btn-play[data-v-ce7a4204]{font-size:20px}}\\n','']);const s=r},226:e=>{e.exports=function(e){return e[1]}},354:(e,t,n)=>{var a=n(205);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,n(424).A)('47b0bfaa',a,!1,{ssrId:!0})},424:(e,t,n)=>{function a(e,t){for(var n=[],a={},o=0;o<t.length;o++){var i=t[o],r=i[0],s={id:e+':'+o,css:i[1],media:i[2],sourceMap:i[3]};a[r]?a[r].parts.push(s):n.push(a[r]={id:r,parts:[s]})}return n}n.d(t,{A:()=>v});var o='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!o)throw new Error('vue-style-loader cannot be used in a non-browser environment. Use { target: \\'node\\' } in your Webpack config to indicate a server-rendering environment.');var i={},r=o&&(document.head||document.getElementsByTagName('head')[0]),s=null,l=0,c=!1,d=function(){},u=null,p='data-vue-ssr-id',f='undefined'!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function v(e,t,n,o){c=n,u=o||{};var r=a(e,t);return m(r),function(t){for(var n=[],o=0;o<r.length;o++){var s=r[o];(l=i[s.id]).refs--,n.push(l)}t?m(r=a(e,t)):r=[];for(o=0;o<n.length;o++){var l;if(0===(l=n[o]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete i[l.id]}}}}function m(e){for(var t=0;t<e.length;t++){var n=e[t],a=i[n.id];if(a){a.refs++;for(var o=0;o<a.parts.length;o++)a.parts[o](n.parts[o]);for(;o<n.parts.length;o++)a.parts.push(h(n.parts[o]));a.parts.length>n.parts.length&&(a.parts.length=n.parts.length)}else{var r=[];for(o=0;o<n.parts.length;o++)r.push(h(n.parts[o]));i[n.id]={id:n.id,refs:1,parts:r}}}}function g(){var e=document.createElement('style');return e.type='text/css',r.appendChild(e),e}function h(e){var t,n,a=document.querySelector('style['+p+'~=\"'+e.id+'\"]');if(a){if(c)return d;a.parentNode.removeChild(a)}if(f){var o=l++;a=s||(s=g()),t=x.bind(null,a,o,!1),n=x.bind(null,a,o,!0)}else a=g(),t=w.bind(null,a),n=function(){a.parentNode.removeChild(a)};return t(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;t(e=a)}else n()}}var y,b=(y=[],function(e,t){return y[e]=t,y.filter(Boolean).join('\\n')});function x(e,t,n,a){var o=n?'':a.css;if(e.styleSheet)e.styleSheet.cssText=b(t,o);else{var i=document.createTextNode(o),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(i,r[t]):e.appendChild(i)}}function w(e,t){var n=t.css,a=t.media,o=t.sourceMap;if(a&&e.setAttribute('media',a),u.ssrId&&e.setAttribute(p,t.id),o&&(n+='\\n/*# sourceURL='+o.sources[0]+' */',n+='\\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+' */'),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},772:(e,t)=>{t.A=(e,t)=>{const n=e.__vccOpts||e;for(const[e,a]of t)n[e]=a;return n}}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var i=t[a]={id:a,exports:{}};return e[a](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const a=Vue,o=(0,a.reactive)({music:{cache:{},regex: /<bgm>текущая музыка[:：](.+?) - (.+?)<\\/bgm>/g,list:[],index:-1,autoPlayer:!1,async getAllChatMessages(){this.index=-1;const e=await triggerSlash('/pass {{lastMessageId}}');if(!e)return;const t=[],n=await getChatMessages(`0-${e}`,{role:'all'});for(const e of n){const n=[...e.message.matchAll(this.regex)];if(0==n.length)continue;const a=n.at(-1),o={song:a[1],singer:a[2],message_id:e.message_id};t.push(o)}this.list=t,console.log(this.list),t.length>0&&(this.index=t.length-1)},checkAudioAvailability:async e=>new Promise(t=>{const n=new Audio;let a;const o=()=>{r(),t(!0)},i=()=>{r(),t(!1)},r=()=>{n.removeEventListener('loadedmetadata',o),n.removeEventListener('error',i),clearTimeout(a),n.src=''};n.preload='metadata',n.src=e,a=setTimeout(i,3e3),n.addEventListener('loadedmetadata',o),n.addEventListener('error',i)})}}),i={class:'content'},r={class:'song-info'},s={class:'song-title'},l={class:'lyric-line lyric-current current'},c={class:'lyric-line lyric-next next'},d={class:'controls btn-group'},u={class:'volume-control volume-container'},p=(0,a.defineComponent)({__name:'musicPlayer',setup(e){const t=(0,a.ref)(!1),n=(0,a.ref)(65),p=(0,a.ref)('Первая строка текста'),f=(0,a.ref)('Вторая строка текста'),v=(0,a.ref)(''),m=(0,a.ref)(''),g=(0,a.ref)(''),h=(0,a.ref)([]),y=(0,a.ref)(-1),b=(0,a.ref)(!1),x=(0,a.ref)(-1),w=new Audio;new Array;w.volume=n.value/100,(0,a.watch)(n,e=>{w.volume=e/100});const E=globalThis.Music;function k(e){const t=h.value;if(!t.length)return p.value='',f.value='',void(y.value=-1);let n=t.length-1;for(let a=0;a<t.length;a++)if(e<t[a].time){n=a-1;break}if(n<0)return p.value='',f.value=t[0]?.text??'',void(y.value=-1);n!==y.value&&(y.value=n,p.value=t[n]?.text??'',f.value=t[n+1]?.text??'')}function S(){k(w.currentTime||0)}async function N(e,n){if(e?.stopPropagation(),Y(),console.log('Control action:',n),'stop'==n)return w.pause(),void(t.value=!1);let a=o.music.index;if(-1!=a){if(a>o.music.list.length-1&&(a=o.music.list.length-1,o.music.index=a),'play'==n){const e=b.value&&x.value===a&&w.src;if(!t.value&&e)return w.play(),void(t.value=!0);M(a)}'prev'==n&&(a>0?a-=1:a<=0&&(a=o.music.list.length-1),o.music.index=a,M(a)),'next'==n&&(a==o.music.list.length-1||a<0?a=0:a+=1,o.music.index=a,M(a))}}async function M(e){const n=o.music.list[e].song;let a='';const i=o.music.cache[n],r=i&&'object'==typeof i?i:null;if(i){const e='string'==typeof i?i:i.Url;if(e){await o.music.checkAudioAvailability(e)&&(a=e,r&&(m.value=r.Singer,v.value=r.Name,g.value=r.Lyric))}}let s=null;if(!a){p.value='Идёт поиск...',f.value='Идёт поиск...';const e=await E.SearchMusic(n);if(console.log(JSON.stringify(e)),!e?.Url)return p.value='Поиск не удался',void(f.value='Нажмите Play для повтора');a=e.Url,s=e,o.music.cache[n]=e}a!=w.src&&(w.src=a);const l=s||r;l&&(m.value=l.Singer,v.value=l.Name,g.value=l.Lyric),g.value&&(h.value=function(e){const t=e.split(/\\r?\\n/),n=[];for(const e of t){const t=e.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g),a=e.replace(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g,'').trim();if(t&&a)for(const e of t){const t=e.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/);if(!t)continue;const o=60*Number(t[1])+Number(t[2])+(t[3]?Number(t[3].padEnd(3,'0')):0)/1e3;n.push({time:o,text:a})}}return n.sort((e,t)=>e.time-t.time),n}(g.value||''),y.value=-1,k(0)),w.play(),t.value=!0,b.value=!0,x.value=e}(0,a.watch)(()=>o.music.index,(e,t)=>{console.log('index 变化:',t,'->',e),-1==t&&e>-1&&N(null,'play')});const T=(0,a.ref)(null);let C=0,A=0,L=0,O=0;const V=(0,a.ref)('50%'),D=(0,a.ref)('20%');let P=null;const I=(0,a.ref)(!1),j=(0,a.ref)(!1),B=(0,a.ref)(!1),U=$('body').width()||0,R=$('body').height()||0,G=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function Y(){clearTimeout(P);const e=T.value;e&&e.classList.contains('expanded')&&(P=setTimeout(()=>{e.classList.remove('expanded')},3e3))}function W(e){const t=T.value;if(!t)return;if(2===e.button||3===e.which)return void(B.value=!0);if(G&&e.target&&e.target.closest&&e.target.closest('.bottom-controls'))return void(t.classList.contains('expanded')&&clearTimeout(P));if(e.target.closest('.volume-control'))return void(t.classList.contains('expanded')&&clearTimeout(P));B.value=!1,I.value=!0,j.value=!1,t.classList.add('dragging'),clearTimeout(P);const n=t.getBoundingClientRect();L=n.left+n.width/2,O=n.top+n.height/2,'mousedown'===e.type?(C=e.clientX,A=e.clientY,$('body').on('mousemove',J),$('body').on('mouseup',X)):'touchstart'===e.type&&(C=e.touches[0].clientX,A=e.touches[0].clientY,$('body').on('touchmove',J),$('body').on('touchend',X))}function J(e){if(!I.value||B.value)return;let t,n;e&&'function'==typeof e.preventDefault&&e.preventDefault(),j.value=!0,'mousemove'===e.type?(t=e.clientX,n=e.clientY):'touchmove'===e.type&&(t=e.touches[0].clientX,n=e.touches[0].clientY);const a=L+(t-C),o=O+(n-A),i=U-20,r=R-20,s=Math.max(20,Math.min(i,a)),l=Math.max(20,Math.min(r,o));a!==s||o!==l?T.value.classList.add('near-boundary'):T.value.classList.remove('near-boundary'),V.value=`${a}px`,D.value=`${o}px`,T.value.style.transform='translate(-50%, -50%) scale(1.02)'}function X(e){if(!I.value&&!B.value)return;if($('body').off('mousemove',J),$('body').off('mouseup',X),$('body').off('touchmove',J),$('body').off('touchend',X),B.value)return void(B.value=!1);const t=T.value,n=t&&t.classList.contains('expanded');I.value=!1,t&&t.classList.remove('dragging','near-boundary');const a=t?t.style.transform:'';a&&a.includes('scale(1.02)')&&(t.style.transform=a.replace('scale(1.02)','')),j.value?(H(),n&&setTimeout(()=>{Y()},100)):setTimeout(()=>{e&&e.target&&e.target.closest&&e.target.closest('.bottom-controls')||q(e)},50),j.value=!1}function H(){const e=T.value;if(!e)return;const t=e.getBoundingClientRect(),n={x:(t.left+t.width/2)/U*100,y:(t.top+t.height/2)/R*100};console.log(`保存坐标位置:\\n${JSON.stringify(n)}`),localStorage.setItem('lyricsWidgetPosition',JSON.stringify(n))}function q(e){const t=T.value;t&&(I.value||j.value||B.value||e&&e.target&&e.target.closest&&e.target.closest('.bottom-controls')||(!e||2!==e.button&&3!==e.which)&&(t.classList.add('expanded'),Y()))}function F(e){const t=T.value;if(B.value=!0,I.value){I.value=!1,t&&t.classList.remove('dragging','near-boundary');const e=t?t.style.transform:'';e&&e.includes('scale(1.02)')&&(t.style.transform=e.replace('scale(1.02)',''))}}function K(){if(G)return;const e=T.value;e&&e.classList.contains('expanded')&&!I.value&&!B.value&&clearTimeout(P)}function Z(){if(G)return;const e=T.value;e&&e.classList.contains('expanded')&&!I.value&&!B.value&&(clearTimeout(P),P=setTimeout(()=>{e.classList.remove('expanded')},2e3))}function Q(){if(!G)return;clearTimeout(P);const e=T.value;e&&e.classList.contains('expanded')&&!I.value&&(P=setTimeout(()=>{Y()},100))}function ee(){const e=T.value;if(!e)return;const t=e.getBoundingClientRect(),n=t.left+t.width/2,a=t.top+t.height/2,o=U-50,i=R-50,r=Math.max(50,Math.min(o,n)),s=Math.max(50,Math.min(i,a));e.style.left=r/U*100+'%',e.style.top=s/R*100+'%',H()}function te(){const e=T.value;document.hidden?clearTimeout(P):e&&e.classList.contains('expanded')&&Y()}function ne(e){!B.value||e.target&&e.target.closest&&e.target.closest('.lyrics-widget')||(B.value=!1)}function ae(e){'Escape'===e.key&&(B.value=!1)}return(0,a.onMounted)(()=>{T.value&&T.value.addEventListener('touchmove',e=>{I.value&&!B.value&&e.preventDefault()},{passive:!1}),$('body').on('visibilitychange',te),$('body').on('click',ne),$('body').on('keydown',ae),window.addEventListener('resize',ee),function(){const e=T.value;if(!e)return;const t=localStorage.getItem('lyricsWidgetPosition');if(console.log(`读取到的坐标位置:${t}`),t){const n=JSON.parse(t);let a='50';console.log(n.x),n.x<100&&n.x>0&&(a=n.x);let o='20';n.y<100&&n.y>0&&(o=n.y),e.style.left=a+'%',e.style.top=o+'%'}}(),w.addEventListener('timeupdate',S)}),(0,a.onBeforeUnmount)(()=>{clearTimeout(P),$('body').off('mousemove',J),$('body').off('mouseup',X),$('body').off('touchmove',J),$('body').off('touchend',X),$('body').off('visibilitychange',te),$('body').off('click',ne),$('body').off('keydown',ae),window.removeEventListener('resize',ee),w.removeEventListener('timeupdate',S)}),(e,o)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{id:'lyricsWidget',class:'lyrics-widget player-card',onMousedown:W,onTouchstart:W,onContextmenu:F,onMouseenter:K,onMouseleave:Z,onTouchend:Q,ref_key:'widget',ref:T,style:(0,a.normalizeStyle)(`top:${D.value};left:${V.value}`)},[o[9]||(o[9]=(0,a.createElementVNode)('div',{class:'circle-deco c1'},null,-1)),o[10]||(o[10]=(0,a.createElementVNode)('div',{class:'circle-deco c2'},null,-1)),(0,a.createElementVNode)('div',i,[(0,a.createElementVNode)('div',r,[(0,a.createElementVNode)('div',s,(0,a.toDisplayString)(v.value)+' - '+(0,a.toDisplayString)(m.value),1)]),(0,a.createElementVNode)('div',{class:'lyrics-display lyrics-box',onClick:q},[(0,a.createElementVNode)('div',l,(0,a.toDisplayString)(p.value),1),(0,a.createElementVNode)('div',c,(0,a.toDisplayString)(f.value),1)]),(0,a.createElementVNode)('div',{class:'bottom-controls controls-area',onClick:o[5]||(o[5]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createElementVNode)('div',d,[(0,a.createElementVNode)('button',{class:'btn prev-btn',title:'Предыдущая',onClick:o[0]||(o[0]=e=>N(e,'prev'))},[...o[6]||(o[6]=[(0,a.createElementVNode)('i',{class:'fas fa-backward'},null,-1)])]),(0,a.createElementVNode)('button',{class:'btn btn-play',title:'Играть/Пауза',onClick:o[1]||(o[1]=e=>N(e,t.value?'stop':'play'))},[(0,a.createElementVNode)('i',{class:(0,a.normalizeClass)(['fas',t.value?'fa-pause':'fa-play'])},null,2)]),(0,a.createElementVNode)('button',{class:'btn next-btn',title:'Следующая',onClick:o[2]||(o[2]=e=>N(e,'next'))},[...o[7]||(o[7]=[(0,a.createElementVNode)('i',{class:'fas fa-forward'},null,-1)])])]),(0,a.createElementVNode)('div',u,[o[8]||(o[8]=(0,a.createElementVNode)('i',{class:'fas fa-volume-down vol-icon'},null,-1)),(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'range',class:'volume-slider volume-track',min:'0',max:'100','onUpdate:modelValue':o[3]||(o[3]=e=>n.value=e),onClick:o[4]||(o[4]=(0,a.withModifiers)(()=>{},['stop'])),style:(0,a.normalizeStyle)({'--volume-fill':n.value+'%'})},null,4),[[a.vModelText,n.value]])])])])],36))}});n(354);const f=(0,n(772).A)(p,[['__scopeId','data-v-ce7a4204']]),v=(0,a.createApp)(f);function m(){return globalThis.Music?Promise.resolve():new Promise((e,t)=>{const n=document.createElement('script');n.src='https://drive.baibai.cv/f/ZKEBuW/Music.js',n.onload=()=>e(),n.onerror=()=>t(),document.head.appendChild(n)})}async function g(e,t){if(console.log(e),t-=1,'Генерация завершена'==e){const e=await getChatMessages(`${t}-${t}`,{role:'all'}),n=o.music.list.filter(e=>e.message_id!==t);for(const t of e){const e=[...t.message.matchAll(o.music.regex)];if(0==e.length)continue;const a=e.at(-1),i={song:a[1],singer:a[2],message_id:t.message_id};n.push(i)}n.sort((e,t)=>e.message_id-t.message_id),o.music.list=n,o.music.index=n.length>0?n.length-1:-1}else await o.music.getAllChatMessages()}function h(){try{$(`head > div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('Ошибка удаления стилей')}}function y(){try{$(`div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('Ошибка удаления div')}}$(async()=>{try{await m(),await function(){try{h(),y()}catch{}const e=$('<div>').attr('script_id',getScriptId());$('body').append(e),v.mount(e[0]),function(){try{if($(`head > div[script_id=\"${getScriptId()}\"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}catch{console.log('Ошибка перемещения CSS')}}()}(),console.log('Плеер загружен!'),eventOn(tavern_events.CHAT_CHANGED,()=>g('Переключение чата')),eventOn(tavern_events.MESSAGE_UPDATED,e=>g('Обновление сообщения',e)),eventOn(tavern_events.GENERATION_ENDED,e=>g('Генерация завершена',e)),eventOn(tavern_events.MESSAGE_SWIPED,()=>g('Переключение сообщения')),eventOn(tavern_events.MESSAGE_DELETED,()=>g('Удаление сообщения')),eventOn(tavern_events.MESSAGE_SENT,()=>{console.log('Сообщение отправлено')}),eventOn(tavern_events.GENERATION_STOPPED,()=>{console.log('Генерация остановлена')}),await o.music.getAllChatMessages()}catch(e){console.error(e),toastr.error(`Ошибка плеера:${e}`)}}),$(window).on('pagehide',()=>{console.log('Сработало событие pagehide');try{v.unmount(),h(),y()}catch{}});export{m as ensureMusicLoaded};",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}