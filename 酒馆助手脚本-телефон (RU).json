{
  "type": "script",
  "enabled": true,
  "name": "телефон (RU)",
  "id": "86be9f22-0590-4198-8dc1-3f06a4b42f14",
  "content": "import'https://testingcf.jsdelivr.net/npm/vue3-draggable-resizable/dist/Vue3DraggableResizable.css/+esm';var e={314:e=>{e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),i='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),r='/*# '.concat(i,' */');return[n].concat([r]).join('\\n')}return[n].join('\\n')}},378:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,i,r){'string'==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var A=[].concat(e[c]);a&&o[A[0]]||(void 0!==r&&(void 0===A[5]||(A[1]='@layer'.concat(A[5].length>0?' '.concat(A[5]):'',' {').concat(A[1],'}')),A[5]=r),t&&(A[2]?(A[1]='@media '.concat(A[2],' {').concat(A[1],'}'),A[2]=t):A[2]=t),i&&(A[4]?(A[1]='@supports ('.concat(A[4],') {').concat(A[1],'}'),A[4]=i):A[4]=''.concat(i)),n.push(A))}},n}},400:(e,n)=>{n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},424:(e,n,t)=>{function a(e,n){for(var t=[],a={},i=0;i<n.length;i++){var r=n[i],o=r[0],s={id:e+':'+i,css:r[1],media:r[2],sourceMap:r[3]};a[o]?a[o].parts.push(s):t.push(a[o]={id:o,parts:[s]})}return t}t.d(n,{A:()=>g});var i='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!i)throw new Ошибка('vue-style-loader cannot be used in a non-browser environment. Use { target: \\'node\\' } in your Webpack config to indicate a server-rendering environment.');var r={},o=i&&(document.head||document.getElementsByTagName('head')[0]),s=null,l=0,c=!1,A=function(){},d=null,p='data-vue-ssr-id',u='undefined'!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function g(e,n,t,i){c=t,d=i||{};var o=a(e,n);return m(o),function(n){for(var t=[],i=0;i<o.length;i++){var s=o[i];(l=r[s.id]).refs--,t.push(l)}n?m(o=a(e,n)):o=[];for(i=0;i<t.length;i++){var l;if(0===(l=t[i]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete r[l.id]}}}}function m(e){for(var n=0;n<e.length;n++){var t=e[n],a=r[t.id];if(a){a.refs++;for(var i=0;i<a.parts.length;i++)a.parts[i](t.parts[i]);for(;i<t.parts.length;i++)a.parts.push(f(t.parts[i]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var o=[];for(i=0;i<t.parts.length;i++)o.push(f(t.parts[i]));r[t.id]={id:t.id,refs:1,parts:o}}}}function C(){var e=document.createElement('style');return e.type='text/css',o.appendChild(e),e}function f(e){var n,t,a=document.querySelector('style['+p+'~=\"'+e.id+'\"]');if(a){if(c)return A;a.parentNode.removeChild(a)}if(u){var i=l++;a=s||(s=C()),n=v.bind(null,a,i,!1),t=v.bind(null,a,i,!0)}else a=C(),n=x.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var b,h=(b=[],function(e,n){return b[e]=n,b.filter(Boolean).join('\\n')});function v(e,n,t,a){var i=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=h(n,i);else{var r=document.createTextNode(i),o=e.childNodes;o[n]&&e.removeChild(o[n]),o.length?e.insertBefore(r,o[n]):e.appendChild(r)}}function x(e,n){var t=n.css,a=n.media,i=n.sourceMap;if(a&&e.setAttribute('media',a),d.ssrId&&e.setAttribute(p,n.id),i&&(t+='\\n/*# sourceURL='+i.sources[0]+' */',t+='\\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},428:(e,n,t)=>{t.r(n),t.d(n,{default:()=>s});var a=t(314),i=t.n(a),r=t(378),o=t.n(r)()(i());o.push([e.id,'@import url(https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap);']),o.push([e.id,'@import url(https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap);']),o.push([e.id,'img[data-v-9c76bbee]{-webkit-user-drag:none;user-drag:none;-webkit-user-select:none;user-select:none;pointer-events:none}.arcade-btn img[data-v-9c76bbee],.collapsed-icon img[data-v-9c76bbee]{pointer-events:none}.lyrics-widget[data-v-9c76bbee]{position:absolute;top:20%;left:50%;transform:translate(-50%,-50%);width:70px;height:70px;border-radius:0;background:transparent;-webkit-user-select:none;user-select:none;transition:width 0.4s cubic-bezier(0.2,0.8,0.2,1);cursor:pointer;z-index:9999999;font-family:\\'M PLUS Rounded 1c\\',\\'Fredoka\\',sans-serif;will-change:transform,top,left}.lyrics-widget:not(.expanded) .collapsed-icon[data-v-9c76bbee]{position:absolute;top:0;left:0;width:100%;height:100%;animation:breatheFloat-9c76bbee 3s ease-in-out infinite;filter:drop-shadow(0 4px 10px rgba(135,206,250,0.4));display:flex;align-items:center;justify-content:center;transform:scale(1.2)}.collapsed-img-box[data-v-9c76bbee]{position:absolute;height:58px;width:33px;top:50%;left:50%;transform:translate(-50%,-50%);overflow:hidden;border-radius:2px;z-index:1;background:#fff}.c-avatar[data-v-9c76bbee]{width:100%;height:100%;object-fit:cover}.collapsed-frame-overlay[data-v-9c76bbee]{position:absolute;top:0;left:0;width:100%;height:100%;background-image:url(\\'https://i.postimg.cc/43nZMt3w/pai-li-de.png\\');background-size:contain;background-repeat:no-repeat;background-position:center;z-index:2;pointer-events:none}@keyframes breatheFloat-9c76bbee{0%,100%{transform:translateY(0) scale(1.2)}50%{transform:translateY(-8px) scale(1.28)}}.lyrics-widget.expanded[data-v-9c76bbee]{width:320px;height:680px;cursor:default}.purikura-machine[data-v-9c76bbee]{opacity:0;pointer-events:none;transform:translateY(10px) scale(0.95);transition:all 0.4s cubic-bezier(0.25,1,0.5,1);width:100%;height:100%;display:flex;flex-direction:column;position:relative;background:url(\\'https://i.postimg.cc/zGqbMdKz/下载_(10).jpg\\') center center no-repeat;background-size:cover;border-radius:30px;border:5px solid #fff;box-shadow:0 15px 35px rgba(0,0,0,0.25),inset 0 0 0 2px rgba(255,255,255,0.5);padding:14px}.lyrics-widget.expanded .purikura-machine[data-v-9c76bbee]{opacity:1;pointer-events:auto;transform:translateY(0) scale(1)}.lyrics-widget.expanded .collapsed-icon[data-v-9c76bbee]{display:none}.machine-charm[data-v-9c76bbee]{position:absolute;top:-15px;right:-28px;width:85px;height:auto;z-index:100;transform-origin:top center;animation:charmSwing-9c76bbee 3.5s ease-in-out infinite;filter:drop-shadow(2px 2px 3px rgba(0,0,0,0.2));pointer-events:auto;cursor:pointer}.machine-charm[data-v-9c76bbee]:hover{filter:drop-shadow(2px 2px 3px rgba(77,208,225,0.5))}.playlist-panel[data-v-9c76bbee]{position:absolute;top:40px;left:14px;right:14px;bottom:80px;background:rgba(255,255,255,0.98);border-radius:12px;z-index:200;padding:10px;border:3px solid #81d4fa;box-shadow:0 10px 20px rgba(0,0,0,0.1);display:flex;flex-direction:column;gap:8px;overflow:hidden;animation:fadeIn-9c76bbee 0.2s ease-out}@keyframes fadeIn-9c76bbee{from{opacity:0;transform:translateY(5px)}to{opacity:1;transform:translateY(0)}}.playlist-header[data-v-9c76bbee]{display:flex;justify-content:space-between;align-items:center;font-weight:700;color:#00838f;border-bottom:2px dashed #b3e5fc;padding-bottom:5px}.close-list-btn[data-v-9c76bbee]{background:none;border:none;font-size:20px;color:#00838f;cursor:pointer}.search-box[data-v-9c76bbee]{display:flex;gap:5px}.search-input[data-v-9c76bbee]{flex:1;border:2px solid #b3e5fc;border-radius:8px;padding:4px 8px;font-size:12px;outline:none;color:#455a64}.search-input[data-v-9c76bbee]:focus{border-color:#29b6f6}.search-btn[data-v-9c76bbee]{background:#b3e5fc;border:none;border-radius:8px;padding:0 10px;cursor:pointer;color:#0277bd}.list-section-title[data-v-9c76bbee]{font-size:10px;color:#90a4ae;margin-top:5px;font-weight:bold}.saved-list[data-v-9c76bbee],.search-results[data-v-9c76bbee]{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:5px;padding-right:2px}.saved-list[data-v-9c76bbee]::-webkit-scrollbar,.search-results[data-v-9c76bbee]::-webkit-scrollbar{width:4px}.saved-list[data-v-9c76bbee]::-webkit-scrollbar-thumb,.search-results[data-v-9c76bbee]::-webkit-scrollbar-thumb{background:#81d4fa;border-radius:2px}.playlist-item[data-v-9c76bbee]{display:flex;align-items:center;justify-content:space-between;background:#f0faff;border-radius:6px;padding:6px 8px;font-size:12px;border:1px solid transparent;transition:all 0.2s}.playlist-item[data-v-9c76bbee]:hover{background:#e1f5fe}.playlist-item.active[data-v-9c76bbee]{background:#e1f5fe;border-color:#29b6f6}.song-info[data-v-9c76bbee]{flex:1;overflow:hidden;cursor:pointer}.s-name[data-v-9c76bbee]{font-weight:bold;color:#37474f;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.s-singer[data-v-9c76bbee]{font-size:10px;color:#78909c}.del-btn[data-v-9c76bbee]{color:#90a4ae;background:none;border:none;cursor:pointer;font-size:12px}.del-btn[data-v-9c76bbee]:hover{color:#ef5350}.add-btn[data-v-9c76bbee]{color:#29b6f6;background:none;border:none;cursor:pointer;font-size:14px}.empty-tip[data-v-9c76bbee]{text-align:center;color:#b0bec5;font-size:12px;margin-top:20px}@keyframes charmSwing-9c76bbee{0%{transform:rotate(5deg)}50%{transform:rotate(-5deg)}100%{transform:rotate(5deg)}}.machine-header[data-v-9c76bbee]{height:36px;display:flex;align-items:center;justify-content:space-between;padding:0 8px;margin-bottom:8px;background:rgba(255,255,255,0.85);border-radius:15px;border:2px solid #fff;box-shadow:0 2px 5px rgba(0,0,0,0.05);flex-shrink:0}.camera-lens[data-v-9c76bbee]{width:24px;height:24px;background:#455a64;border-radius:50%;border:2px solid #cfd8dc;position:relative;cursor:pointer;transition:transform 0.2s}.camera-lens[data-v-9c76bbee]:active{transform:scale(0.9)}.lens-reflection[data-v-9c76bbee]{position:absolute;top:4px;right:4px;width:6px;height:6px;background:rgba(255,255,255,0.6);border-radius:50%}.brand-logo[data-v-9c76bbee]{font-size:10px;font-weight:900;color:#00bcd4;letter-spacing:1px;text-shadow:1px 1px 0 #fff}.flash-light[data-v-9c76bbee]{width:24px;height:8px;background:#fff;border-radius:4px;box-shadow:0 0 5px rgba(255,255,255,0.8)}.screen-frame[data-v-9c76bbee]{flex:1;background:rgba(255,255,255,0.4);border-radius:12px;padding:10px;border:2px solid rgba(255,255,255,0.8);display:flex;flex-direction:column;gap:12px;overflow:hidden}.photo-zone[data-v-9c76bbee]{position:relative;width:100%;height:0;padding-bottom:100%;flex:0 0 auto;background:#fff;border-radius:8px;cursor:pointer;border:4px solid #fff;box-sizing:border-box;box-shadow:0 2px 8px rgba(0,0,0,0.1);overflow:visible !important;transition:transform 0.2s}.photo-zone[data-v-9c76bbee]:hover{transform:scale(0.99)}.photo-wrapper[data-v-9c76bbee]{position:absolute;top:0;left:0;width:100%;height:100%}.photo-crop-box[data-v-9c76bbee]{position:absolute;top:0;left:0;width:100%;height:100%;overflow:hidden;border-radius:4px;z-index:10}.deco-sticker-tl[data-v-9c76bbee]{position:absolute;top:-30px;left:-30px;width:120px;height:auto;z-index:30;transform:rotate(-15deg);filter:drop-shadow(2px 2px 3px rgba(0,0,0,0.2));pointer-events:none}.purikura-img[data-v-9c76bbee]{width:100%;height:100%;object-fit:cover;display:block}.gloss-layer[data-v-9c76bbee]{position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,0.4) 0%,rgba(255,255,255,0) 50%);pointer-events:none}.deco-layer[data-v-9c76bbee]{position:absolute;inset:0;pointer-events:none;z-index:20}.d-date[data-v-9c76bbee]{position:absolute;bottom:5px;right:5px;font-size:10px;color:#00bcd4;font-weight:bold;background:rgba(255,255,255,0.8);padding:2px 5px;border-radius:4px}.upload-hint[data-v-9c76bbee]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:24px;opacity:0;transition:opacity 0.2s;background:rgba(0,0,0,0.3);border-radius:50%;width:40px;height:40px;display:flex;align-items:center;justify-content:center;z-index:40}.photo-zone:hover .upload-hint[data-v-9c76bbee]{opacity:1}.digital-display[data-v-9c76bbee]{flex:1;min-height:110px;background:rgba(224,247,250,0.65);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);border-radius:12px;padding:8px 12px;border:2px solid rgba(255,255,255,0.6);box-shadow:inset 0 0 15px rgba(255,255,255,0.8),inset 0 0 5px rgba(0,188,212,0.2),0 4px 10px rgba(77,208,225,0.3);display:flex;flex-direction:column;position:relative;justify-content:space-between;overflow:hidden}.digital-display[data-v-9c76bbee]::after{content:\\'\\';position:absolute;top:0;left:0;right:0;height:40%;background:linear-gradient(180deg,rgba(255,255,255,0.7) 0%,rgba(255,255,255,0) 100%);pointer-events:none;border-radius:10px 10px 40% 40%/10px 10px 20px 20px;opacity:0.8}.lcd-header[data-v-9c76bbee]{display:flex;align-items:center;gap:6px;border-bottom:1px dashed rgba(129,212,250,0.5);padding-bottom:4px;margin-bottom:4px;color:#546e7a;font-size:12px;z-index:2;flex-shrink:0}.spin-icon[data-v-9c76bbee]{animation:spin-9c76bbee 4s linear infinite;font-size:10px;color:#29b6f6}@keyframes spin-9c76bbee{100%{transform:rotate(360deg)}}.info-text[data-v-9c76bbee]{overflow:hidden;white-space:nowrap;text-overflow:ellipsis;max-width:90%;font-weight:600}.lyrics-water-box[data-v-9c76bbee]{flex:1;display:flex;flex-direction:column;justify-content:center;text-align:center;gap:2px;z-index:2;overflow:hidden;min-height:40px}.lyric-line-main[data-v-9c76bbee]{color:#00838f;font-size:15px;font-weight:700;line-height:1.3;text-shadow:0 1px 1px rgba(255,255,255,0.8)}.lyric-line-sub[data-v-9c76bbee]{color:#78909c;font-size:12px}.lcd-footer[data-v-9c76bbee]{display:flex;justify-content:space-between;align-items:center;padding-top:4px;margin-top:2px;opacity:0.7;z-index:2;flex-shrink:0}.status-dots span[data-v-9c76bbee]{display:inline-block;width:4px;height:4px;background:#81d4fa;border-radius:50%;margin-right:2px;box-shadow:0 0 2px #fff}.time-readout[data-v-9c76bbee]{font-family:monospace;font-size:10px;color:#546e7a}.control-panel[data-v-9c76bbee]{flex-shrink:0;margin-top:12px;background:rgba(255,255,255,0.85);border-radius:12px;padding:10px;border:2px solid #fff;display:flex;flex-direction:column;gap:10px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}.arcade-buttons[data-v-9c76bbee]{display:flex;justify-content:space-evenly;align-items:center}.arcade-btn[data-v-9c76bbee]{border:none;outline:none;cursor:pointer;transition:all 0.1s;display:flex;align-items:center;justify-content:center}.arcade-btn.img-btn[data-v-9c76bbee]{width:44px;height:44px;background:transparent;box-shadow:none;padding:0}.arcade-btn.img-btn img[data-v-9c76bbee]{width:100%;height:100%;object-fit:contain;filter:drop-shadow(0 2px 3px rgba(0,0,0,0.1))}.arcade-btn.img-btn[data-v-9c76bbee]:active{transform:scale(0.9)}.play-btn-custom[data-v-9c76bbee]{width:58px !important;height:58px !important}.volume-slider-box[data-v-9c76bbee]{height:12px;display:flex;align-items:center;background:rgba(0,0,0,0.05);border-radius:10px;padding:0 8px}.print-slot[data-v-9c76bbee]{height:6px;background:rgba(0,0,0,0.1);width:60%;margin:10px auto 0;border-radius:3px;flex-shrink:0}.volume-slider[data-v-9c76bbee]{-webkit-appearance:none !important;appearance:none !important;background:transparent !important;border:none !important;width:100% !important;height:100% !important;cursor:pointer !important;display:block !important}.volume-slider[data-v-9c76bbee]::-webkit-slider-runnable-track{width:100% !important;height:6px !important;border-radius:3px !important;background:#fff !important;background-image:linear-gradient(90deg,#81d4fa 0%,#81d4fa var(--volume-fill,0%),transparent var(--volume-fill,0%),transparent 100%) !important;background-repeat:no-repeat !important}.volume-slider[data-v-9c76bbee]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;height:14px !important;width:14px !important;border-radius:50% !important;background:#fff !important;box-shadow:0 1px 3px rgba(0,0,0,0.3) !important;border:2px solid #29b6f6 !important;margin-top:-4px !important}.lyrics-widget.dragging[data-v-9c76bbee]{cursor:grabbing}.lyrics-widget.near-boundary[data-v-9c76bbee]{box-shadow:0 0 20px rgba(129,212,250,0.6)}.spin-img[data-v-9c76bbee]{animation:discSpin-9c76bbee 6s linear infinite}@keyframes discSpin-9c76bbee{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.small-btn[data-v-9c76bbee]{width:30px;height:30px;color:#29b6f6;background:#e1f5fe;border-radius:50%;font-size:14px;box-shadow:0 2px 5px rgba(0,0,0,0.1);margin-right:5px}.small-btn[data-v-9c76bbee]:hover{background:#b3e5fc}.lcd-footer[data-v-9c76bbee]{width:100%;display:flex;align-items:center;margin-top:auto}.progress-bar-box[data-v-9c76bbee]{width:100%;height:8px;display:flex;align-items:center;position:relative}.music-slider[data-v-9c76bbee]{-webkit-appearance:none !important;appearance:none !important;background:transparent !important;border:none !important;width:100% !important;height:100% !important;cursor:pointer !important;display:block !important;position:relative;z-index:10}.music-slider[data-v-9c76bbee]::-webkit-slider-runnable-track{width:100% !important;height:4px !important;border-radius:2px !important;background:rgba(84,110,122,0.2) !important;background-image:linear-gradient(90deg,#29b6f6 0%,#29b6f6 var(--prog-fill,0%),transparent var(--prog-fill,0%),transparent 100%) !important;background-repeat:no-repeat !important}.music-slider[data-v-9c76bbee]::-webkit-slider-thumb{-webkit-appearance:none !important;appearance:none !important;height:10px !important;width:10px !important;border-radius:50% !important;background:#00bcd4 !important;box-shadow:0 0 4px rgba(0,0,0,0.3) !important;margin-top:-3px !important;border:1px solid #fff !important;-webkit-transition:transform 0.1s;transition:transform 0.1s}.music-slider[data-v-9c76bbee]:hover::-webkit-slider-thumb{transform:scale(1.2)}.lcd-header[data-v-9c76bbee]{display:flex;align-items:center;justify-content:space-between;border-bottom:1px dashed rgba(129,212,250,0.5);padding-bottom:4px;margin-bottom:4px;color:#546e7a;font-size:12px;z-index:2;flex-shrink:0}.header-left[data-v-9c76bbee]{display:flex;align-items:center;gap:6px;flex:1;overflow:hidden}.mode-btn-lcd[data-v-9c76bbee]{background:transparent;border:none;color:#00bcd4;cursor:pointer;font-size:12px;padding:2px 6px;border-radius:4px;transition:all 0.2s;display:flex;align-items:center;justify-content:center}.mode-btn-lcd[data-v-9c76bbee]:hover{background:rgba(129,212,250,0.2);transform:scale(1.1);color:#00838f}.progress-bar-box[data-v-9c76bbee]{width:100%;height:14px;display:flex;align-items:center;position:relative}\\n\\n','',{version:3,sources:['webpack://./src/大头贴播放器/musicPlayer.vue'],names:[],mappings:'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',sourcesContent:['<template>\\n  <div\\n    id=\"lyricsWidget\"\\n    class=\"lyrics-widget\"\\n    @mousedown=\"startDrag\"\\n    @touchstart=\"startDrag\"\\n    @contextmenu=\"onContextMenu\"\\n    @mouseenter=\"onMouseEnter\"\\n    @mouseleave=\"onMouseLeave\"\\n    @touchend=\"onTouchEnd\"\\n    ref=\"widget\"\\n    :style=\"`top:${dragY};left:${dragX}`\"\\n  >\\n    \\x3c!-- 收缩状态 --\\x3e\\n    <div class=\"collapsed-icon\" @click=\"expandWidget\">\\n      <div class=\"collapsed-img-box\">\\n        <img\\n          :src=\"savedImage || \\'https://i.postimg.cc/k4kM905J/anime-girl-blue.jpg\\'\"\\n          class=\"c-avatar\"\\n          alt=\"avatar\"\\n          draggable=\"false\"\\n        />\\n      </div>\\n      <div class=\"collapsed-frame-overlay\"></div>\\n    </div>\\n\\n    \\x3c!-- 展开状态 --\\x3e\\n    <div class=\"purikura-machine\">\\n\\n      \\x3c!-- ★★★ 挂件：点击打开播放列表 ★★★ --\\x3e\\n      <img\\n        src=\"https://i.postimg.cc/ZRFs4bVj/播放列表.png\"\\n        class=\"machine-charm\"\\n        alt=\"charm\"\\n        draggable=\"false\"\\n        @click.stop=\"toggleПлейлист\"\\n        title=\"Открыть/закрыть плейлист\"\\n      />\\n\\n      \\x3c!-- ★★★ 播放列表面板 ★★★ --\\x3e\\n      <div class=\"playlist-panel\" v-if=\"showПлейлист\" @click.stop @mousedown.stop>\\n        <div class=\"playlist-header\">\\n          <span><i class=\"fas fa-list-ul\"></i> Плейлист</span>\\n          <button class=\"close-list-btn\" @click=\"showПлейлист = false\">×</button>\\n        </div>\\n\\n        \\x3c!-- 搜索区 --\\x3e\\n        <div class=\"search-box\">\\n          <input\\n            v-model=\"searchQuery\"\\n            @keyup.enter=\"doSearch\"\\n            placeholder=\"Поиск песни...\"\\n            class=\"search-input\"\\n          />\\n          <button @click=\"doSearch\" class=\"search-btn\"><i class=\"fas fa-search\"></i></button>\\n        </div>\\n\\n        \\x3c!-- 搜索结果 --\\x3e\\n        <div class=\"search-results\" v-if=\"searchResults.length > 0\">\\n           <div class=\"list-section-title\">Результаты:</div>\\n           <div\\n             v-for=\"(res, idx) in searchResults\"\\n             :key=\"\\'res-\\'+idx\"\\n             class=\"playlist-item search-item\"\\n           >\\n             <div class=\"song-info\">\\n               <div class=\"s-name\">{{ res.SongName }}</div>\\n               <div class=\"s-singer\">{{ res.Singer }}</div>\\n             </div>\\n             <button class=\"add-btn\" @click=\"addToLibrary(res)\">\\n                <i class=\"fas fa-plus-circle\"></i>\\n             </button>\\n           </div>\\n        </div>\\n\\n\\x3c!-- musicPlayer.vue - template区域 --\\x3e\\n\\n<div class=\"saved-list\">\\n  <div class=\"list-section-title\">Текущий плейлист:</div>\\n  <div v-if=\"sharedState.music.list.length === 0\" class=\"empty-tip\">Песни не найдены...</div>\\n\\n  \\x3c!-- 循环渲染 list --\\x3e\\n  <div\\n    v-for=\"(item, idx) in sharedState.music.list\"\\n    :key=\"\\'song-\\'+idx\"\\n    class=\"playlist-item\"\\n    :class=\"{ \\'active\\': sharedState.music.index === idx }\"\\n  >\\n    \\x3c!-- ★★★ 修改这里：点击时调用 switchSong(idx) ★★★ --\\x3e\\n    <div class=\"song-info\" @click=\"switchSong(idx)\">\\n      <div class=\"s-name\">\\n        <i v-if=\"item.source === \\'chat\\'\" class=\"fas fa-comment-dots\" style=\"font-size:10px; margin-right:2px; opacity:0.6;\"></i>\\n        {{ item.song }}\\n      </div>\\n      <div class=\"s-singer\">{{ item.singer }}</div>\\n    </div>\\n\\n    \\x3c!-- 删除按钮保持不变 --\\x3e\\n    <button v-if=\"item.source === \\'user\\'\" class=\"del-btn\" @click=\"removeFromLibrary(item)\">\\n        <i class=\"fas fa-trash-alt\"></i>\\n    </button>\\n  </div>\\n</div>\\n      </div>\\n\\n      \\x3c!-- 机器顶部 --\\x3e\\n      <div class=\"machine-header\">\\n        <div class=\"camera-lens\" @click.stop=\"collapseWidget\" title=\"Нажмите для закрытия\">\\n          <div class=\"lens-reflection\"></div>\\n        </div>\\n        <div class=\"flash-light\"></div>\\n        \\x3c!-- ★★★ 这里修改了文字：PURIKURA -> КРОЛИК ★★★ --\\x3e\\n        <div class=\"brand-logo\">КРОЛИК</div>\\n      </div>\\n\\n      \\x3c!-- 机器屏幕 --\\x3e\\n      <div class=\"screen-frame\">\\n\\n        \\x3c!-- 照片显示区 --\\x3e\\n        <div class=\"photo-zone\" @click=\"triggerUpload\" title=\"Нажмите для смены фото\">\\n          <div class=\"photo-wrapper\">\\n            <div class=\"photo-crop-box\">\\n               <img\\n                :src=\"savedImage || \\'https://i.postimg.cc/k4kM905J/anime-girl-blue.jpg\\'\"\\n                class=\"purikura-img\"\\n                alt=\"фото-стикер\"\\n                draggable=\"false\"\\n              />\\n              <div class=\"gloss-layer\"></div>\\n            </div>\\n            \\x3c!-- 贴纸 --\\x3e\\n            <img\\n               src=\"https://i.postimg.cc/sxSGFqTf/拍立得贴纸.png\"\\n               class=\"deco-sticker-tl\"\\n               alt=\"sticker\"\\n               draggable=\"false\"\\n            />\\n            <div class=\"deco-layer\">\\n              <span class=\"d-date\">{{ currentDateStr }}</span>\\n              <div class=\"upload-hint\"><i class=\"fas fa-camera\"></i></div>\\n            </div>\\n          </div>\\n        </div>\\n\\n      \\x3c!-- 歌词区 (保证高度) --\\x3e\\n      <div class=\"digital-display\">\\n        \\x3c!-- 修改头部：使用 flex-between 分开左边的信息和右边的按钮 --\\x3e\\n        <div class=\"lcd-header\">\\n           <div class=\"header-left\">\\n             <i class=\"fas fa-compact-disc spin-icon\"></i>\\n             <span class=\"info-text\">{{ formatTime(currentTime) }} / {{ formatTime(duration) }}</span>\\n           </div>\\n\\n           \\x3c!-- ★★★ 新位置：播放模式切换按钮 ★★★ --\\x3e\\n           \\x3c!-- 使用 @click.stop 防止误触拖拽 --\\x3e\\n           <button class=\"mode-btn-lcd\" @click.stop=\"togglePlayMode\" :title=\"playModeText\">\\n             <i :class=\"playModeIcon\"></i>\\n           </button>\\n        </div>\\n\\n        <div class=\"lyrics-water-box\">\\n          <div class=\"lyric-line-main\">{{ currentLine }}</div>\\n          <div class=\"lyric-line-sub\">{{ nextLine }}</div>\\n        </div>\\n\\n        <div class=\"lcd-footer\">\\n          \\x3c!-- ★★★ 修复：添加 .stop 修饰符防止拖动进度条时拖动窗口 ★★★ --\\x3e\\n          <div class=\"progress-bar-box\">\\n             <input\\n              type=\"range\"\\n              class=\"music-slider\"\\n              min=\"0\"\\n              :max=\"duration\"\\n              step=\"0.1\"\\n              :value=\"currentTime\"\\n              @input.stop=\"onSeekInput\"\\n              @change.stop=\"onSeekChange\"\\n              @mousedown.stop\\n              @touchstart.stop\\n              :style=\"{ \\'--prog-fill\\': (currentTime / (duration || 1)) * 100 + \\'%\\' }\"\\n            />\\n          </div>\\n        </div>\\n      </div>\\n    </div>\\n\\n    \\x3c!-- 底部控制台 --\\x3e\\n    <div class=\"control-panel\" @click.stop>\\n      <div class=\"arcade-buttons\">\\n\\n        <button class=\"arcade-btn img-btn\" @click=\"e => controlAction(e, \\'prev\\')\">\\n          <img src=\"https://i.postimg.cc/NFT2hSdf/上一首.png\" alt=\"Назад\" draggable=\"false\" />\\n        </button>\\n\\n        \\x3c!-- ★★★ 修改：播放按钮图片添加 :class=\"{ \\'spin-img\\': isPlaying }\" ★★★ --\\x3e\\n        <button class=\"arcade-btn img-btn play-btn-custom\" @click=\"e => controlAction(e, !isPlaying ? \\'play\\' : \\'stop\\')\">\\n          <img\\n            :src=\"isPlaying ? \\'https://i.postimg.cc/pTYcRWqC/水色播放中.png\\' : \\'https://i.postimg.cc/9MtgCmJp/水色播放键.png\\'\"\\n            :class=\"{ \\'spin-img\\': isPlaying }\"\\n            alt=\"Играть/Пауза\"\\n            draggable=\"false\"\\n          />\\n        </button>\\n\\n        <button class=\"arcade-btn img-btn\" @click=\"e => controlAction(e, \\'next\\')\">\\n           <img src=\"https://i.postimg.cc/1X6Vx2vm/下一首.png\" alt=\"Вперёд\" draggable=\"false\" />\\n        </button>\\n      </div>\\n\\n\\n        <div class=\"volume-slider-box\">\\n           <input\\n            type=\"range\"\\n            class=\"volume-slider\"\\n            min=\"0\"\\n            max=\"100\"\\n            v-model=\"volume\"\\n            :style=\"{ \\'--volume-fill\\': volume + \\'%\\' }\"\\n          />\\n        </div>\\n      </div>\\n\\n      <div class=\"print-slot\"></div>\\n\\n      <input\\n        type=\"file\"\\n        ref=\"fileInput\"\\n        accept=\"image/png, image/jpeg, image/jpg\"\\n        style=\"display: none\"\\n        @change=\"handleImageUpload\"\\n      />\\n    </div>\\n  </div>\\n</template>\\n\\n\\n<script setup lang=\"ts\">\\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from \\'vue\\';\\nimport { sharedState } from \\'./shared-state\\';\\n\\n// --- JS 逻辑 ---\\nconst fileInput = ref<HTMLInputElement | null>(null);\\nconst savedImage = ref<string>(\\'\\');\\nconst currentDateStr = computed(() => {\\n  const d = new Date();\\n  return `${d.getFullYear()}.${d.getMonth() + 1}.${d.getDate()}`;\\n});\\n// --- 新增状态变量 ---\\nconst duration = ref(0);\\nconst currentTime = ref(0);\\nconst isSeeking = ref(false); // 是否正在拖动进度条\\nconst playMode = ref<\\'list\\' | \\'single\\' | \\'random\\'>(\\'list\\'); // 播放模式\\n\\n// 计算属性：模式图标和提示文字\\nconst playModeIcon = computed(() => {\\n  switch (playMode.value) {\\n    case \\'random\\': return \\'fas fa-random\\';\\n    case \\'single\\': return \\'fas fa-redo-alt\\'; // 带个1那种图标可以用 fa-redo\\n    default: return \\'fas fa-list\\'; // Повтор плейлиста\\n  }\\n});\\nconst playModeText = computed(() => {\\n  switch (playMode.value) {\\n    case \\'random\\': return \\'Случайное воспроизведение\\';\\n    case \\'single\\': return \\'Повтор трека\\';\\n    default: return \\'Повтор плейлиста\\';\\n  }\\n});\\n\\n// --- 新增功能函数 ---\\n// 切换模式\\nfunction togglePlayMode() {\\n  if (playMode.value === \\'list\\') playMode.value = \\'random\\';\\n  else if (playMode.value === \\'random\\') playMode.value = \\'single\\';\\n  else playMode.value = \\'list\\';\\n}\\n\\n// 格式化时间 (秒 -> mm:ss)\\nfunction formatTime(seconds: number) {\\n  if (!seconds || isNaN(seconds)) return \\'00:00\\';\\n  const m = Math.floor(seconds / 60);\\n  const s = Math.floor(seconds % 60);\\n  return `${m.toString().padStart(2, \\'0\\')}:${s.toString().padStart(2, \\'0\\')}`;\\n}\\n\\n// 进度条拖动时 (实时更新UI，但不改变音频)\\nfunction onSeekInput(e: Event) {\\n  isSeeking.value = true;\\n  currentTime.value = parseFloat((e.target as HTMLInputElement).value);\\n}\\n\\n// 进度条松开时 (改变音频进度)\\nfunction onSeekChange(e: Event) {\\n  const val = parseFloat((e.target as HTMLInputElement).value);\\n  musicAudio.currentTime = val;\\n  isSeeking.value = false;\\n}\\n\\nfunction triggerUpload() { fileInput.value?.click(); }\\n\\nfunction handleImageUpload(event: Event) {\\n  const input = event.target as HTMLInputElement;\\n  if (input.files && input.files[0]) {\\n    const file = input.files[0];\\n\\n    // ★★★ 修改这里：把 2 改成了 10 (也就是 10MB) ★★★\\n    if (file.size > 10 * 1024 * 1024) {\\n      alert(\\'Изображение слишком большое! Загрузите файл до 10MB\\');\\n      return;\\n    }\\n\\n    const reader = new FileReader();\\n    reader.onload = (e) => {\\n      savedImage.value = e.target?.result as string;\\n      try {\\n        // 尝试保存到缓存\\n        localStorage.setItem(\\'lyrics_widget_bg_img\\', savedImage.value);\\n      } catch (err) {\\n        // 如果图片太大存不进缓存，给个提示，但不会影响当前显示\\n        console.error(\"缓存存不下了:\", err);\\n        // 你可以把下面这行注释去掉，如果想要提示用户缓存失败的话\\n        // alert(\\'图片已显示！但因为文件过大，刷新页面后可能无法自动保存哦~\\');\\n      }\\n    };\\n    reader.readAsDataURL(file);\\n  }\\n}\\n\\n\\n// --- 播放列表逻辑 ---\\nconst showПлейлист = ref(false); // 默认关闭\\nconst searchQuery = ref(\\'\\');\\nconst searchResults = ref<any[]>([]);\\n\\nfunction toggleПлейлист() {\\n  showПлейлист.value = !showПлейлист.value;\\n  if (showПлейлист.value) sharedState.music.loadUserList();\\n}\\n\\nasync function doSearch() {\\n  if (!searchQuery.value) return;\\n  const Music = (globalThis as any).Music;\\n  if (!Music) return;\\n\\n  searchResults.value = [];\\n  try {\\n    const res = await Music.SearchMusic(searchQuery.value);\\n    if (res && res.Name) {\\n      searchResults.value = [{\\n        SongName: res.Name,\\n        Singer: res.Singer || \\'Unknown\\',\\n      }];\\n    } else {\\n      alert(\\'Песня не найдена\\');\\n    }\\n  } catch (e) {\\n    console.error(e);\\n    alert(\\'Ошибка поиска\\');\\n  }\\n}\\n\\n// ... 其他代码 ...\\n\\n// ★★★ 修改：addToLibrary 保持不变，确认有 source: \\'user\\' ★★★\\nfunction addToLibrary(res: any) {\\n  const newItem = {\\n    song: res.SongName,\\n    singer: res.Singer,\\n    message_id: -1,\\n    source: \\'user\\' // 这一行很重要\\n  };\\n  // ... (中间的去重逻辑保持不变) ...\\n\\n  sharedState.music.userList.push(newItem);\\n  sharedState.music.saveUserList();\\n  sharedState.music.getAllChatMessages(); // 刷新总列表\\n  searchResults.value = [];\\n  searchQuery.value = \\'\\';\\n}\\n\\n// ★★★ 修改：根据对象内容去 userList 里找并删除 ★★★\\nfunction removeFromLibrary(item: any) {\\n  // 在 userList 中找到这个对象\\n  const userIdx = sharedState.music.userList.findIndex(\\n    u => u.song === item.song && u.singer === item.singer\\n  );\\n\\n  if (userIdx !== -1) {\\n    sharedState.music.userList.splice(userIdx, 1);\\n    sharedState.music.saveUserList();\\n    sharedState.music.getAllChatMessages(); // 刷新总列表，界面会自动更新\\n  }\\n}\\n\\nfunction isCurrentSong(item: any) {\\n  const current = sharedState.music.list[sharedState.music.index];\\n  if (!current) return false;\\n  return current.song === item.song && current.singer === item.singer;\\n}\\n\\n// --- 核心播放逻辑 ---\\nonMounted(() => {\\n  const cachedImg = localStorage.getItem(\\'lyrics_widget_bg_img\\');\\n  if (cachedImg) savedImage.value = cachedImg;\\n  sharedState.music.loadUserList();\\n  showПлейлист.value = false; // 强制初始化为关闭\\n});\\n\\nconst isPlaying = ref(false);\\nconst volume = ref(65);\\nconst currentLine = ref(\\'Музыка\\');\\nconst nextLine = ref(`Вставьте монету...`);\\nconst currentSong = ref(``);\\nconst currentSinger = ref(``);\\nconst currentLyricStr = ref(``);\\nconst parsedLyrics = ref<{ time: number; text: string }[]>([]);\\nconst currentLyricIndex = ref(-1);\\nconst hasStarted = ref(false);\\nconst playingIndex = ref(-1);\\nconst musicAudio = new Audio();\\n\\nmusicAudio.volume = volume.value / 100;\\nwatch(volume, newVal => { musicAudio.volume = newVal / 100; });\\nconst Music = (globalThis as any).Music;\\n\\nwatch(\\n  () => sharedState.music.index,\\n  (newVal, oldVal) => {\\n    if (oldVal == -1 && newVal > -1) controlAction(null, \\'play\\');\\n  },\\n);\\n\\nfunction parseLyricToTimeline(lyric: string) {\\n  const lines = lyric.split(/\\\\r?\\\\n/);\\n  const entries: { time: number; text: string }[] = [];\\n  for (const line of lines) {\\n    const timeTags = line.match(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/g);\\n    const text = line.replace(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/g, \\'\\').trim();\\n    if (!timeTags || !text) continue;\\n    for (const tag of timeTags) {\\n      const match = tag.match(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/);\\n      if (!match) continue;\\n      const minutes = Number(match[1]);\\n      const seconds = Number(match[2]);\\n      const millis = match[3] ? Number(match[3].padEnd(3, \\'0\\')) : 0;\\n      const time = minutes * 60 + seconds + millis / 1000;\\n      entries.push({ time, text });\\n    }\\n  }\\n  entries.sort((a, b) => a.time - b.time);\\n  return entries;\\n}\\n\\nfunction updateLyricDisplayByTime(currentTime: number) {\\n  const list = parsedLyrics.value;\\n  if (!list.length) {\\n    currentLine.value = \\'\\'; nextLine.value = \\'\\'; currentLyricIndex.value = -1; return;\\n  }\\n  let idx = list.length - 1;\\n  for (let i = 0; i < list.length; i++) {\\n    if (currentTime < list[i].time) { idx = i - 1; break; }\\n  }\\n  if (idx < 0) {\\n    currentLine.value = \\'\\'; nextLine.value = list[0]?.text ?? \\'\\'; currentLyricIndex.value = -1; return;\\n  }\\n  if (idx !== currentLyricIndex.value) {\\n    currentLyricIndex.value = idx;\\n    currentLine.value = list[idx]?.text ?? \\'\\';\\n    nextLine.value = list[idx + 1]?.text ?? \\'\\';\\n  }\\n}\\n\\n\\n// ★★★ 新增：专门用于点击列表切换歌曲的函数 ★★★\\nfunction switchSong(index: number) {\\n  // 1. 更新全局索引，这样界面上的高亮颜色才会变\\n  sharedState.music.index = index;\\n  // 2. 播放音乐\\n  PlayMusic(index);\\n}\\n\\n\\n\\n// --- 找到这个函数并完全替换 ---\\nfunction onTimeUpdate() {\\n  const audioTime = musicAudio.currentTime || 0;\\n\\n  // 1. 更新歌词 (保留你原有的逻辑)\\n  updateLyricDisplayByTime(audioTime);\\n\\n  // 2. ★★★ 修复核心问题：获取歌曲总时长 ★★★\\n  // 如果 audio 有时长且不是 NaN，就赋值给 duration\\n  if (musicAudio.duration && !isNaN(musicAudio.duration)) {\\n    duration.value = musicAudio.duration;\\n  }\\n\\n  // 3. ★★★ 修复核心问题：更新当前播放时间 ★★★\\n  // 只有在“没有拖动”进度条的时候才更新，防止拖动时滑块乱跳\\n  if (!isSeeking.value) {\\n    currentTime.value = audioTime;\\n  }\\n}\\n// --- 新增：处理播放结束的逻辑 ---\\nfunction onAudioEnded() {\\n  const list = sharedState.music.list;\\n  const len = list.length;\\n  if (len === 0) return;\\n\\n  // 根据当前模式决定下一首\\n  if (playMode.value === \\'single\\') {\\n    // === Повтор трека ===\\n    // 直接重置进度并重新播放，无需重新加载\\n    musicAudio.currentTime = 0;\\n    musicAudio.play();\\n  } else if (playMode.value === \\'random\\') {\\n    // === Случайное воспроизведение ===\\n    // 随机取一个索引\\n    let newIndex = Math.floor(Math.random() * len);\\n    // (可选优化) 如果列表有多首歌，尽量避免随机到刚播完的这一首\\n    if (len > 1 && newIndex === sharedState.music.index) {\\n      newIndex = Math.floor(Math.random() * len);\\n    }\\n    sharedState.music.index = newIndex;\\n    PlayMusic(newIndex);\\n  } else {\\n    // === Повтор плейлиста (playMode.value === \\'list\\') ===\\n    let newIndex = sharedState.music.index + 1;\\n    if (newIndex >= len) {\\n      newIndex = 0; // 播完最后一首，回到第一首\\n    }\\n    sharedState.music.index = newIndex;\\n    PlayMusic(newIndex);\\n  }\\n}\\n\\n\\nasync function controlAction(event: any, action: any) {\\n  event?.stopPropagation();\\n\\n  if (action == \\'stop\\') {\\n    musicAudio.pause();\\n    isPlaying.value = false;\\n    return;\\n  }\\n\\n  let index = sharedState.music.index;\\n  if (sharedState.music.list.length === 0) return;\\n  if (index >= sharedState.music.list.length) index = 0;\\n  if (index < 0) index = 0;\\n\\n  if (action == \\'play\\') {\\n    const canResume = hasStarted.value && playingIndex.value === index && musicAudio.src;\\n    if (!isPlaying.value && canResume) {\\n      musicAudio.play();\\n      isPlaying.value = true;\\n      return;\\n    }\\n    PlayMusic(index);\\n  }\\n\\n  if (action == \\'prev\\') {\\n    if (index > 0) index -= 1;\\n    else index = sharedState.music.list.length - 1;\\n    sharedState.music.index = index;\\n    PlayMusic(index);\\n  }\\n\\n  if (action == \\'next\\') {\\n    if (index < sharedState.music.list.length - 1) index += 1;\\n    else index = 0;\\n    sharedState.music.index = index;\\n    PlayMusic(index);\\n  }\\n}\\n\\nasync function PlayMusic(index: number) {\\n  if (!sharedState.music.list[index]) return;\\n  const song = sharedState.music.list[index];\\n  const name = song.song;\\n  let playUrl = \\'\\';\\n  const cached = sharedState.music.cache[name];\\n  const cachedMeta = cached && typeof cached === \\'object\\' ? cached : null;\\n  if (cached) {\\n    const cachedUrl = typeof cached === \\'string\\' ? cached : cached.Url;\\n    if (cachedUrl) {\\n      const available = await sharedState.music.checkAudioAvailability(cachedUrl);\\n      if (available) {\\n        playUrl = cachedUrl;\\n        if (cachedMeta) {\\n          currentSinger.value = cachedMeta.Singer;\\n          currentSong.value = cachedMeta.Name;\\n          currentLyricStr.value = cachedMeta.Lyric;\\n        }\\n      }\\n    }\\n  }\\n\\n  let fetchedMeta: any = null;\\n  if (!playUrl) {\\n    currentLine.value = \\'Поиск...\\'; nextLine.value = \\'...\\';\\n    try {\\n        const result = await Music.SearchMusic(name);\\n        if (!result?.Url) {\\n          currentLine.value = \\'Ошибка\\'; nextLine.value = \\'Попробуйте снова\\'; return;\\n        }\\n        playUrl = result.Url;\\n        fetchedMeta = result;\\n        sharedState.music.cache[name] = result;\\n    } catch (e) {\\n        currentLine.value = \\'Ошибка\\';\\n        return;\\n    }\\n  }\\n  duration.value = 0;\\n  currentTime.value = 0;\\n  if (playUrl != musicAudio.src) musicAudio.src = playUrl;\\n\\n  const meta = fetchedMeta || cachedMeta;\\n  if (meta) {\\n    currentSinger.value = meta.Singer;\\n    currentSong.value = meta.Name;\\n    currentLyricStr.value = meta.Lyric;\\n  } else {\\n     currentSong.value = name;\\n     currentSinger.value = song.singer || \\'\\';\\n  }\\n\\n  if (currentLyricStr.value) {\\n    parsedLyrics.value = parseLyricToTimeline(currentLyricStr.value || \\'\\');\\n    currentLyricIndex.value = -1;\\n    updateLyricDisplayByTime(0);\\n  } else {\\n      parsedLyrics.value = [];\\n      currentLine.value = name;\\n      nextLine.value = \\'Нет текста\\';\\n  }\\n\\n  musicAudio.play().catch(e => console.log(\\'play fail\\', e));\\n  isPlaying.value = true;\\n  hasStarted.value = true;\\n  playingIndex.value = index;\\n}\\n\\nconst widget = ref<HTMLElement | null>(null);\\nlet startX = 0, startY = 0, initialX = 0, initialY = 0;\\nconst dragX = ref(`50%`);\\nconst dragY = ref(`20%`);\\nconst isDragging = ref(false);\\nconst hasMovedWhileDragging = ref(false);\\nconst isRightClick = ref(false);\\nconst windowWidth = $(\\'body\\').width() || 0;\\nconst windowHeight = $(\\'body\\').height() || 0;\\n\\nfunction startDrag(e: any) {\\n  const el = widget.value;\\n  if (!el) return;\\n  if (e.button === 2 || e.which === 3) {\\n    isRightClick.value = true; return;\\n  }\\n  // ★★★ 修改这里：添加 .music-slider 和 .mode-btn-lcd 到排除列表 ★★★\\n  if (e.target.closest(\\'.photo-zone\\') ||\\n      e.target.closest(\\'.camera-lens\\') ||\\n      e.target.closest(\\'.volume-slider-box\\') ||\\n      e.target.closest(\\'.arcade-btn\\') ||\\n      e.target.closest(\\'.playlist-panel\\') ||\\n      e.target.closest(\\'.music-slider\\') ||  // 新增：排除进度条\\n      e.target.closest(\\'.mode-btn-lcd\\')     // 新增：排除模式按钮\\n     ) return;\\n\\n  isRightClick.value = false;\\n  isDragging.value = true;\\n  hasMovedWhileDragging.value = false;\\n  el.classList.add(\\'dragging\\');\\n  const rect = el.getBoundingClientRect();\\n  initialX = rect.left + rect.width / 2;\\n  initialY = rect.top + rect.height / 2;\\n\\n  if (e.type === \\'mousedown\\') {\\n    startX = e.clientX; startY = e.clientY;\\n    $(\\'body\\').on(\\'mousemove\\', drag);\\n    $(\\'body\\').on(\\'mouseup\\', stopDrag);\\n  } else if (e.type === \\'touchstart\\') {\\n    startX = e.touches[0].clientX; startY = e.touches[0].clientY;\\n    $(\\'body\\').on(\\'touchmove\\', drag);\\n    $(\\'body\\').on(\\'touchend\\', stopDrag);\\n  }\\n}\\n\\nfunction drag(e: any) {\\n  if (!isDragging.value || isRightClick.value) return;\\n  if (e && typeof e.preventDefault === \\'function\\') e.preventDefault();\\n  hasMovedWhileDragging.value = true;\\n  let clientX, clientY;\\n  if (e.type === \\'mousemove\\') {\\n    clientX = e.clientX; clientY = e.clientY;\\n  } else if (e.type === \\'touchmove\\') {\\n    clientX = e.touches[0].clientX; clientY = e.touches[0].clientY;\\n  }\\n  const deltaX = clientX - startX;\\n  const deltaY = clientY - startY;\\n  const newX = initialX + deltaX;\\n  const newY = initialY + deltaY;\\n  const margin = 20;\\n  const maxX = windowWidth - margin;\\n  const maxY = windowHeight - margin;\\n  const clampedX = Math.max(margin, Math.min(maxX, newX));\\n  const clampedY = Math.max(margin, Math.min(maxY, newY));\\n  if (newX !== clampedX || newY !== clampedY) {\\n    widget.value!.classList.add(\\'near-boundary\\');\\n  } else {\\n    widget.value!.classList.remove(\\'near-boundary\\');\\n  }\\n  dragX.value = `${newX}px`;\\n  dragY.value = `${newY}px`;\\n  widget.value!.style.transform = \\'translate(-50%, -50%) scale(1.02)\\';\\n}\\n\\nfunction stopDrag(e: any) {\\n  if (!isDragging.value && !isRightClick.value) return;\\n  $(\\'body\\').off(\\'mousemove\\', drag);\\n  $(\\'body\\').off(\\'mouseup\\', stopDrag);\\n  $(\\'body\\').off(\\'touchmove\\', drag);\\n  $(\\'body\\').off(\\'touchend\\', stopDrag);\\n  if (isRightClick.value) {\\n    isRightClick.value = false; return;\\n  }\\n  const el = widget.value;\\n  isDragging.value = false;\\n  el && el.classList.remove(\\'dragging\\', \\'near-boundary\\');\\n  const currentTransform = el ? el.style.transform : \\'\\';\\n  if (currentTransform && currentTransform.includes(\\'scale\\')) {\\n    el!.style.transform = currentTransform.replace(/scale\\\\([\\\\d.]+\\\\)/, \\'\\');\\n  }\\n  if (hasMovedWhileDragging.value) {\\n    savePosition();\\n  } else {\\n    setTimeout(() => {\\n      if (!(e && e.target && e.target.closest &&\\n           (e.target.closest(\\'.control-panel\\') || e.target.closest(\\'.photo-zone\\') || e.target.closest(\\'.playlist-panel\\')))) {\\n        if(el && !el.classList.contains(\\'expanded\\')) {\\n            expandWidget(e);\\n        }\\n      }\\n    }, 50);\\n  }\\n  hasMovedWhileDragging.value = false;\\n}\\n\\nfunction savePosition() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const rect = el.getBoundingClientRect();\\n  const position = {\\n    x: ((rect.left + rect.width / 2) / windowWidth) * 100,\\n    y: ((rect.top + rect.height / 2) / windowHeight) * 100,\\n  };\\n  localStorage.setItem(\\'lyricsWidgetPosition\\', JSON.stringify(position));\\n}\\n\\nfunction restorePosition() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const saved = localStorage.getItem(\\'lyricsWidgetPosition\\');\\n  if (saved) {\\n    const position = JSON.parse(saved);\\n    let x = `50`, y = `20`;\\n    if (position.x < 100 && position.x > 0) x = position.x;\\n    if (position.y < 100 && position.y > 0) y = position.y;\\n    el.style.left = x + \\'%\\';\\n    el.style.top = y + \\'%\\';\\n  }\\n}\\n\\nfunction expandWidget(event: any) {\\n  const el = widget.value;\\n  if (!el) return;\\n  if (isDragging.value || hasMovedWhileDragging.value || isRightClick.value) return;\\n  if (el.classList.contains(\\'expanded\\')) return;\\n  el.classList.add(\\'expanded\\');\\n  showПлейлист.value = false; // ★★★ 确保展开时不自动显示列表\\n}\\n\\nfunction collapseWidget(event: any) {\\n    const el = widget.value;\\n    if (!el) return;\\n    el.classList.remove(\\'expanded\\');\\n    showПлейлист.value = false;\\n}\\n\\nfunction onContextMenu(e: any) {\\n  const el = widget.value;\\n  isRightClick.value = true;\\n  if (isDragging.value) {\\n    isDragging.value = false;\\n    el && el.classList.remove(\\'dragging\\', \\'near-boundary\\');\\n    const currentTransform = el ? el.style.transform : \\'\\';\\n    if (currentTransform && currentTransform.includes(\\'scale\\')) {\\n      el!.style.transform = currentTransform.replace(/scale\\\\([\\\\d.]+\\\\)/, \\'\\');\\n    }\\n  }\\n}\\n\\nfunction onMouseEnter() { }\\nfunction onMouseLeave() { }\\nfunction onTouchEnd() { }\\n\\nonMounted(() => {\\n  if (widget.value) widget.value.addEventListener(\\'touchmove\\', e => { if (isDragging.value) e.preventDefault(); }, { passive: false });\\n  $(\\'body\\').on(\\'click\\', onDocumentClick);\\n  $(\\'body\\').on(\\'keydown\\', onKeyDown);\\n  window.addEventListener(\\'resize\\', onResize);\\n  restorePosition();\\n  musicAudio.addEventListener(\\'timeupdate\\', onTimeUpdate);\\n\\n  // ★★★ 新增这行：监听播放结束 ★★★\\n  musicAudio.addEventListener(\\'ended\\', onAudioEnded);\\n\\n  const cachedImg = localStorage.getItem(\\'lyrics_widget_bg_img\\');\\n  if (cachedImg) savedImage.value = cachedImg;\\n  sharedState.music.loadUserList();\\n  showПлейлист.value = false;\\n});\\n\\n\\nfunction onDocumentClick(e: any) { if (isRightClick.value && !(e.target.closest(\\'.lyrics-widget\\'))) isRightClick.value = false; }\\nfunction onKeyDown(e: any) { if (e.key === \\'Escape\\') isRightClick.value = false; }\\nfunction onResize() { savePosition(); }\\nonBeforeUnmount(() => { });\\n\\n<\\/script>\\n<style scoped>\\n@import url(\\'https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap\\');\\n@import url(\\'https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;700&display=swap\\');\\n\\nimg {\\n  -webkit-user-drag: none; user-drag: none; user-select: none; pointer-events: none;\\n}\\n.arcade-btn img, .collapsed-icon img { pointer-events: none; }\\n\\n.lyrics-widget {\\n  position: absolute; top: 20%; left: 50%; transform: translate(-50%, -50%);\\n  width: 70px; height: 70px; border-radius: 0; background: transparent;\\n  user-select: none; transition: width 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);\\n  cursor: pointer; z-index: 9999999;\\n  font-family: \\'M PLUS Rounded 1c\\', \\'Fredoka\\', sans-serif;\\n  will-change: transform, top, left;\\n}\\n\\n/* ★★★ 修改：收缩状态样式调整 ★★★ */\\n.lyrics-widget:not(.expanded) .collapsed-icon {\\n  position: absolute; top: 0; left: 0; width: 100%; height: 100%;\\n  /* 换成了新动画 breatheFloat */\\n  animation: breatheFloat 3s ease-in-out infinite;\\n  filter: drop-shadow(0 4px 10px rgba(135, 206, 250, 0.4));\\n  display: flex; align-items: center; justify-content: center;\\n  /* 默认放大 1.2 倍 */\\n  transform: scale(1.2);\\n}\\n\\n.collapsed-img-box {\\n  position: absolute; height: 58px; width: 33px;\\n  top: 50%; left: 50%; transform: translate(-50%, -50%);\\n  overflow: hidden; border-radius: 2px; z-index: 1; background: #fff;\\n}\\n.c-avatar { width: 100%; height: 100%; object-fit: cover; }\\n\\n.collapsed-frame-overlay {\\n  position: absolute; top: 0; left: 0; width: 100%; height: 100%;\\n  background-image: url(\\'https://i.postimg.cc/43nZMt3w/pai-li-de.png\\');\\n  background-size: contain; background-repeat: no-repeat; background-position: center;\\n  z-index: 2; pointer-events: none;\\n}\\n\\n/* ★★★ 新动画：呼吸悬浮 ★★★ */\\n@keyframes breatheFloat {\\n  0%, 100% {\\n    transform: translateY(0) scale(1.2);\\n  }\\n  50% {\\n    transform: translateY(-8px) scale(1.28);\\n  }\\n}\\n\\n/* ★★★ 固定高度: 调整为680px，保证歌词有地儿放 ★★★ */\\n.lyrics-widget.expanded {\\n  width: 320px;\\n  height: 680px;\\n  cursor: default;\\n}\\n\\n.purikura-machine {\\n  opacity: 0; pointer-events: none;\\n  transform: translateY(10px) scale(0.95);\\n  transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);\\n  width: 100%; height: 100%;\\n  display: flex; flex-direction: column; position: relative;\\n  background: url(\\'https://i.postimg.cc/zGqbMdKz/下载_(10).jpg\\') center center no-repeat;\\n  background-size: cover; border-radius: 30px; border: 5px solid #fff;\\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.25), inset 0 0 0 2px rgba(255,255,255,0.5);\\n  padding: 14px;\\n}\\n\\n.lyrics-widget.expanded .purikura-machine { opacity: 1; pointer-events: auto; transform: translateY(0) scale(1); }\\n.lyrics-widget.expanded .collapsed-icon { display: none; }\\n\\n.machine-charm {\\n  position: absolute;\\n  top: -15px;\\n  right: -28px;\\n  width: 85px;\\n  height: auto;\\n  z-index: 100;\\n  transform-origin: top center;\\n  animation: charmSwing 3.5s ease-in-out infinite;\\n  filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2));\\n  pointer-events: auto;\\n  cursor: pointer;\\n}\\n.machine-charm:hover {\\n    filter: drop-shadow(2px 2px 3px rgba(77, 208, 225, 0.5));\\n}\\n\\n/* ★★★ 播放列表面板 - 水色主题 ★★★ */\\n.playlist-panel {\\n  position: absolute;\\n  top: 40px; left: 14px; right: 14px; bottom: 80px;\\n  background: rgba(255, 255, 255, 0.98);\\n  border-radius: 12px;\\n  z-index: 200;\\n  padding: 10px;\\n  border: 3px solid #81d4fa;\\n  box-shadow: 0 10px 20px rgba(0,0,0,0.1);\\n  display: flex; flex-direction: column; gap: 8px;\\n  overflow: hidden;\\n  animation: fadeIn 0.2s ease-out;\\n}\\n@keyframes fadeIn { from{opacity:0; transform: translateY(5px);} to{opacity:1; transform:translateY(0);} }\\n\\n.playlist-header {\\n  display: flex; justify-content: space-between; align-items: center;\\n  font-weight: 700; color: #00838f;\\n  border-bottom: 2px dashed #b3e5fc;\\n  padding-bottom: 5px;\\n}\\n.close-list-btn {\\n  background: none; border: none; font-size: 20px; color: #00838f; cursor: pointer;\\n}\\n\\n.search-box { display: flex; gap: 5px; }\\n.search-input {\\n  flex: 1; border: 2px solid #b3e5fc; border-radius: 8px; padding: 4px 8px; font-size: 12px; outline: none;\\n  color: #455a64;\\n}\\n.search-input:focus { border-color: #29b6f6; }\\n.search-btn {\\n  background: #b3e5fc; border: none; border-radius: 8px; padding: 0 10px; cursor: pointer; color: #0277bd;\\n}\\n\\n.list-section-title { font-size: 10px; color: #90a4ae; margin-top: 5px; font-weight: bold; }\\n\\n.saved-list, .search-results {\\n  flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 5px; padding-right: 2px;\\n}\\n.saved-list::-webkit-scrollbar, .search-results::-webkit-scrollbar { width: 4px; }\\n.saved-list::-webkit-scrollbar-thumb, .search-results::-webkit-scrollbar-thumb { background: #81d4fa; border-radius: 2px; }\\n\\n.playlist-item {\\n  display: flex; align-items: center; justify-content: space-between;\\n  background: #f0faff;\\n  border-radius: 6px; padding: 6px 8px;\\n  font-size: 12px; border: 1px solid transparent;\\n  transition: all 0.2s;\\n}\\n.playlist-item:hover { background: #e1f5fe; }\\n.playlist-item.active {\\n  background: #e1f5fe; border-color: #29b6f6;\\n}\\n.song-info { flex: 1; overflow: hidden; cursor: pointer; }\\n.s-name { font-weight: bold; color: #37474f; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }\\n.s-singer { font-size: 10px; color: #78909c; }\\n.del-btn { color: #90a4ae; background: none; border: none; cursor: pointer; font-size: 12px; }\\n.del-btn:hover { color: #ef5350; }\\n.add-btn { color: #29b6f6; background: none; border: none; cursor: pointer; font-size: 14px; }\\n.empty-tip { text-align: center; color: #b0bec5; font-size: 12px; margin-top: 20px; }\\n\\n\\n@keyframes charmSwing {\\n  0% { transform: rotate(5deg); }\\n  50% { transform: rotate(-5deg); }\\n  100% { transform: rotate(5deg); }\\n}\\n\\n.machine-header {\\n  height: 36px; display: flex; align-items: center; justify-content: space-between;\\n  padding: 0 8px; margin-bottom: 8px;\\n  background: rgba(255, 255, 255, 0.85); border-radius: 15px; border: 2px solid #fff;\\n  box-shadow: 0 2px 5px rgba(0,0,0,0.05);\\n  flex-shrink: 0;\\n}\\n\\n.camera-lens {\\n  width: 24px; height: 24px; background: #455a64; border-radius: 50%; border: 2px solid #cfd8dc; position: relative;\\n  cursor: pointer; transition: transform 0.2s;\\n}\\n.camera-lens:active { transform: scale(0.9); }\\n.lens-reflection {\\n  position: absolute; top: 4px; right: 4px; width: 6px; height: 6px; background: rgba(255,255,255,0.6); border-radius: 50%;\\n}\\n.brand-logo { font-size: 10px; font-weight: 900; color: #00bcd4; letter-spacing: 1px; text-shadow: 1px 1px 0 #fff; }\\n.flash-light { width: 24px; height: 8px; background: #fff; border-radius: 4px; box-shadow: 0 0 5px rgba(255,255,255,0.8); }\\n\\n.screen-frame {\\n  flex: 1;\\n  background: rgba(255, 255, 255, 0.4); border-radius: 12px;\\n  padding: 10px; border: 2px solid rgba(255,255,255,0.8);\\n  display: flex; flex-direction: column; gap: 12px;\\n  overflow: hidden;\\n}\\n\\n.photo-zone {\\n  position: relative;\\n  width: 100%;\\n  height: 0;\\n  padding-bottom: 100%;\\n  flex: 0 0 auto;\\n  background: #fff;\\n  border-radius: 8px;\\n  cursor: pointer;\\n  border: 4px solid #fff;\\n  box-sizing: border-box;\\n  box-shadow: 0 2px 8px rgba(0,0,0,0.1);\\n  overflow: visible !important;\\n  transition: transform 0.2s;\\n}\\n.photo-zone:hover { transform: scale(0.99); }\\n\\n\\n.photo-wrapper {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  width: 100%;\\n  height: 100%;\\n}\\n\\n.photo-crop-box {\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  width: 100%;\\n  height: 100%;\\n  overflow: hidden;\\n  border-radius: 4px;\\n  z-index: 10;\\n}\\n\\n\\n.deco-sticker-tl {\\n  position: absolute;\\n  top: -30px;\\n  left: -30px;\\n  width: 120px;\\n  height: auto;\\n  z-index: 30;\\n  transform: rotate(-15deg);\\n  filter: drop-shadow(2px 2px 3px rgba(0,0,0,0.2));\\n  pointer-events: none;\\n}\\n\\n.purikura-img {\\n  width: 100%; height: 100%; object-fit: cover; display: block;\\n}\\n\\n.gloss-layer {\\n  position: absolute; inset: 0;\\n  background: linear-gradient(135deg, rgba(255,255,255,0.4) 0%, rgba(255,255,255,0) 50%);\\n  pointer-events: none;\\n}\\n.deco-layer { position: absolute; inset: 0; pointer-events: none; z-index: 20; }\\n\\n.d-date {\\n  position: absolute; bottom: 5px; right: 5px; font-size: 10px;\\n  color: #00bcd4; font-weight: bold; background: rgba(255,255,255,0.8);\\n  padding: 2px 5px; border-radius: 4px;\\n}\\n.upload-hint {\\n  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);\\n  color: #fff; font-size: 24px; opacity: 0; transition: opacity 0.2s;\\n  background: rgba(0,0,0,0.3); border-radius: 50%; width: 40px; height: 40px;\\n  display: flex; align-items: center; justify-content: center; z-index: 40;\\n}\\n.photo-zone:hover .upload-hint { opacity: 1; }\\n\\n/* 歌词区域：修正Flex逻辑，保证有高度 */\\n.digital-display {\\n  flex: 1;\\n  min-height: 110px; /* 强制给个最小高度 */\\n  background: rgba(224, 247, 250, 0.65);\\n  backdrop-filter: blur(8px);\\n  -webkit-backdrop-filter: blur(8px);\\n  border-radius: 12px;\\n  padding: 8px 12px;\\n  border: 2px solid rgba(255, 255, 255, 0.6);\\n\\n  box-shadow:\\n    inset 0 0 15px rgba(255, 255, 255, 0.8),\\n    inset 0 0 5px rgba(0, 188, 212, 0.2),\\n    0 4px 10px rgba(77, 208, 225, 0.3);\\n\\n  display: flex; flex-direction: column; position: relative;\\n  justify-content: space-between;\\n  overflow: hidden;\\n}\\n\\n.digital-display::after {\\n  content: \\'\\';\\n  position: absolute;\\n  top: 0; left: 0; right: 0;\\n  height: 40%;\\n  background: linear-gradient(180deg, rgba(255,255,255,0.7) 0%, rgba(255,255,255,0) 100%);\\n  pointer-events: none;\\n  border-radius: 10px 10px 40% 40% / 10px 10px 20px 20px;\\n  opacity: 0.8;\\n}\\n\\n.lcd-header {\\n  display: flex; align-items: center; gap: 6px;\\n  border-bottom: 1px dashed rgba(129, 212, 250, 0.5);\\n  padding-bottom: 4px; margin-bottom: 4px;\\n  color: #546e7a; font-size: 12px; z-index: 2;\\n  flex-shrink: 0;\\n}\\n.spin-icon { animation: spin 4s linear infinite; font-size: 10px; color: #29b6f6; }\\n@keyframes spin { 100% {transform: rotate(360deg);} }\\n.info-text { overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 90%; font-weight: 600; }\\n\\n.lyrics-water-box {\\n  flex: 1; display: flex; flex-direction: column; justify-content: center;\\n  text-align: center; gap: 2px; z-index: 2; overflow: hidden;\\n  min-height: 40px; /* 确保中间至少有40px放歌词 */\\n}\\n.lyric-line-main { color: #00838f; font-size: 15px; font-weight: 700; line-height: 1.3; text-shadow: 0 1px 1px rgba(255,255,255,0.8); }\\n.lyric-line-sub { color: #78909c; font-size: 12px; }\\n\\n.lcd-footer {\\n  display: flex; justify-content: space-between; align-items: center;\\n  padding-top: 4px; margin-top: 2px; opacity: 0.7; z-index: 2;\\n  flex-shrink: 0;\\n}\\n.status-dots span { display: inline-block; width: 4px; height: 4px; background: #81d4fa; border-radius: 50%; margin-right: 2px; box-shadow: 0 0 2px #fff; }\\n.time-readout { font-family: monospace; font-size: 10px; color: #546e7a; }\\n\\n.control-panel {\\n  flex-shrink: 0;\\n  margin-top: 12px;\\n  background: rgba(255, 255, 255, 0.85); border-radius: 12px;\\n  padding: 10px; border: 2px solid #fff;\\n  display: flex; flex-direction: column; gap: 10px;\\n  box-shadow: 0 4px 10px rgba(0,0,0,0.05);\\n}\\n.arcade-buttons { display: flex; justify-content: space-evenly; align-items: center; }\\n.arcade-btn {\\n  border: none; outline: none; cursor: pointer; transition: all 0.1s;\\n  display: flex; align-items: center; justify-content: center;\\n}\\n.arcade-btn.img-btn {\\n  width: 44px; height: 44px; background: transparent; box-shadow: none; padding: 0;\\n}\\n.arcade-btn.img-btn img {\\n  width: 100%; height: 100%; object-fit: contain; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.1));\\n}\\n.arcade-btn.img-btn:active { transform: scale(0.9); }\\n\\n.play-btn-custom {\\n  width: 58px !important;\\n  height: 58px !important;\\n}\\n\\n.volume-slider-box {\\n  height: 12px; display: flex; align-items: center;\\n  background: rgba(0,0,0,0.05); border-radius: 10px; padding: 0 8px;\\n}\\n.print-slot {\\n  height: 6px; background: rgba(0,0,0,0.1); width: 60%; margin: 10px auto 0; border-radius: 3px;\\n  flex-shrink: 0;\\n}\\n\\n.volume-slider {\\n  -webkit-appearance: none !important; appearance: none !important;\\n  background: transparent !important; border: none !important;\\n  width: 100% !important; height: 100% !important; cursor: pointer !important; display: block !important;\\n}\\n.volume-slider::-webkit-slider-runnable-track {\\n  width: 100% !important; height: 6px !important; border-radius: 3px !important;\\n  background: #fff !important;\\n  background-image: linear-gradient(90deg, #81d4fa 0%, #81d4fa var(--volume-fill, 0%), transparent var(--volume-fill, 0%), transparent 100%) !important;\\n  background-repeat: no-repeat !important;\\n}\\n.volume-slider::-webkit-slider-thumb {\\n  -webkit-appearance: none !important; appearance: none !important;\\n  height: 14px !important; width: 14px !important; border-radius: 50% !important;\\n  background: #fff !important; box-shadow: 0 1px 3px rgba(0,0,0,0.3) !important;\\n  border: 2px solid #29b6f6 !important; margin-top: -4px !important;\\n}\\n\\n.lyrics-widget.dragging { cursor: grabbing; }\\n.lyrics-widget.near-boundary { box-shadow: 0 0 20px rgba(129, 212, 250, 0.6); }\\n/* --- 新增：播放图标旋转动画 --- */\\n.spin-img {\\n  animation: discSpin 6s linear infinite;\\n}\\n@keyframes discSpin {\\n  0% { transform: rotate(0deg); }\\n  100% { transform: rotate(360deg); }\\n}\\n\\n/* --- 修改：控制按钮布局 --- */\\n.small-btn {\\n  width: 30px; height: 30px;\\n  color: #29b6f6;\\n  background: #e1f5fe;\\n  border-radius: 50%;\\n  font-size: 14px;\\n  box-shadow: 0 2px 5px rgba(0,0,0,0.1);\\n  margin-right: 5px; /* 给主按钮腾点位置 */\\n}\\n.small-btn:hover { background: #b3e5fc; }\\n\\n/* --- 修改：LCD 区域样式适配进度条 --- */\\n.lcd-footer {\\n  /* 原本有些样式可能需要微调 */\\n  width: 100%;\\n  display: flex;\\n  align-items: center;\\n  margin-top: auto; /* 推到底部 */\\n}\\n\\n.progress-bar-box {\\n  width: 100%;\\n  height: 8px; /* 增加一点高度给触摸 */\\n  display: flex;\\n  align-items: center;\\n  position: relative;\\n}\\n\\n/* 进度条样式 (仿照你的音量条风格) */\\n.music-slider {\\n  -webkit-appearance: none !important; appearance: none !important;\\n  background: transparent !important; border: none !important;\\n  width: 100% !important; height: 100% !important;\\n  cursor: pointer !important; display: block !important;\\n  position: relative; z-index: 10;\\n}\\n.music-slider::-webkit-slider-runnable-track {\\n  width: 100% !important; height: 4px !important; border-radius: 2px !important;\\n  background: rgba(84, 110, 122, 0.2) !important; /* 轨道底色 */\\n  /* 动态填充色 */\\n  background-image: linear-gradient(90deg, #29b6f6 0%, #29b6f6 var(--prog-fill, 0%), transparent var(--prog-fill, 0%), transparent 100%) !important;\\n  background-repeat: no-repeat !important;\\n}\\n.music-slider::-webkit-slider-thumb {\\n  -webkit-appearance: none !important; appearance: none !important;\\n  height: 10px !important; width: 10px !important; border-radius: 50% !important;\\n  background: #00bcd4 !important;\\n  box-shadow: 0 0 4px rgba(0,0,0,0.3) !important;\\n  margin-top: -3px !important; /* 垂直居中 */\\n  border: 1px solid #fff !important;\\n  transition: transform 0.1s;\\n}\\n.music-slider:hover::-webkit-slider-thumb {\\n  transform: scale(1.2);\\n}\\n/* 修改 lcd-header 布局 */\\n.lcd-header {\\n  display: flex;\\n  align-items: center;\\n  justify-content: space-between; /* 两端对齐 */\\n  border-bottom: 1px dashed rgba(129, 212, 250, 0.5);\\n  padding-bottom: 4px; margin-bottom: 4px;\\n  color: #546e7a; font-size: 12px; z-index: 2;\\n  flex-shrink: 0;\\n}\\n\\n/* 左侧信息包裹层 */\\n.header-left {\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n  flex: 1;\\n  overflow: hidden; /* 防止文字把按钮挤出去 */\\n}\\n\\n/* ★★★ 新增：LCD区域内的模式切换按钮样式 ★★★ */\\n.mode-btn-lcd {\\n  background: transparent;\\n  border: none;\\n  color: #00bcd4; /* 水色字体 */\\n  cursor: pointer;\\n  font-size: 12px;\\n  padding: 2px 6px;\\n  border-radius: 4px;\\n  transition: all 0.2s;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n}\\n.mode-btn-lcd:hover {\\n  background: rgba(129, 212, 250, 0.2);\\n  transform: scale(1.1);\\n  color: #00838f;\\n}\\n\\n/* 进度条样式微调（确保容易点中） */\\n.progress-bar-box {\\n  width: 100%;\\n  height: 14px; /* 稍微高一点，方便手指/鼠标拖动 */\\n  display: flex;\\n  align-items: center;\\n  position: relative;\\n}\\n\\n</style>\\n'],sourceRoot:''}]);const s=o},585:(e,n,t)=>{var a=t(428);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('91729894',a,!1,{ssrId:!0})}},n={};function t(a){var i=n[a];if(void 0!==i)return i.exports;var r=n[a]={id:a,exports:{}};return e[a](r,r.exports,t),r.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const a=Vue,i=(0,a.reactive)({music:{cache:{},regex: /<bgm>текущая музыка[:：](.+?) - (.+?)<\\/bgm>/g,list:[],userList:[],index:-1,autoPlayer:!1,loadUserList(){try{const e=localStorage.getItem('purikura_user_playlist');e&&(this.userList=JSON.parse(e))}catch(e){console.error('加载歌单失败',e)}},saveUserList(){try{localStorage.setItem('purikura_user_playlist',JSON.stringify(this.userList))}catch(e){console.error('保存歌单失败',e)}},async getAllChatMessages(){const e=await triggerSlash('/pass {{lastMessageId}}'),n=[];if(e){const t=await getChatMessages(`0-${e}`,{role:'all'});for(const e of t){const t=[...e.message.matchAll(this.regex)];if(0==t.length)continue;const a=t.at(-1);n.push({song:a[1],singer:a[2],message_id:e.message_id,source:'chat'})}}0===this.userList.length&&this.loadUserList(),this.list=[...this.userList,...n],console.log('播放列表更新:',this.list),-1===this.index&&this.list.length>0&&(this.index=this.list.length-1)},checkAudioAvailability:async e=>new Promise(n=>{const t=new Audio;let a;const i=()=>{o(),n(!0)},r=()=>{o(),n(!1)},o=()=>{t.removeEventListener('loadedmetadata',i),t.removeEventListener('error',r),clearTimeout(a),t.src=''};t.preload='metadata',t.src=e,a=setTimeout(r,3e3),t.addEventListener('loadedmetadata',i),t.addEventListener('error',r)})}}),r={class:'collapsed-img-box'},o=['src'],s={class:'purikura-machine'},l={class:'playlist-header'},c={class:'search-box'},A={key:0,class:'search-results'},d={class:'song-info'},p={class:'s-name'},u={class:'s-singer'},g=['onClick'],m={class:'saved-list'},C={key:0,class:'empty-tip'},f=['onClick'],b={class:'s-name'},h={key:0,class:'fas fa-comment-dots',style:{'font-size':'10px','margin-right':'2px',opacity:'0.6'}},v={class:'s-singer'},x=['onClick'],B={class:'machine-header'},y={class:'screen-frame'},E={class:'photo-wrapper'},w={class:'photo-crop-box'},k=['src'],S={class:'deco-layer'},M={class:'d-date'},N={class:'digital-display'},D={class:'lcd-header'},L={class:'header-left'},U={class:'info-text'},Y=['title'],V={class:'lyrics-water-box'},I={class:'lyric-line-main'},T={class:'lyric-line-sub'},F={class:'lcd-footer'},W={class:'progress-bar-box'},P=['max','value'],j={class:'arcade-buttons'},R=['src'],q={class:'volume-slider-box'},O=(0,a.defineComponent)({__name:'musicPlayer',setup(e){const n=(0,a.ref)(null),t=(0,a.ref)(''),O=(0,a.computed)(()=>{const e=new Date;return`${e.getFullYear()}.${e.getMonth()+1}.${e.getDate()}`}),X=(0,a.ref)(0),G=(0,a.ref)(0),Q=(0,a.ref)(!1),J=(0,a.ref)('list'),K=(0,a.computed)(()=>{switch(J.value){case'random':return'fas fa-random';case'single':return'fas fa-redo-alt';default:return'fas fa-list'}}),H=(0,a.computed)(()=>{switch(J.value){case'random':return'Случайное воспроизведение';case'single':return'Повтор трека';default:return'Повтор плейлиста'}});function Z(){'list'===J.value?J.value='random':'random'===J.value?J.value='single':J.value='list'}function ee(e){if(!e||isNaN(e))return'00:00';const n=Math.floor(e/60),t=Math.floor(e%60);return`${n.toString().padStart(2,'0')}:${t.toString().padStart(2,'0')}`}function ne(e){Q.value=!0,G.value=parseFloat(e.target.value)}function te(e){const n=parseFloat(e.target.value);xe.currentTime=n,Q.value=!1}function ae(){n.value?.click()}function ie(e){const n=e.target;if(n.files&&n.files[0]){const e=n.files[0];if(e.size>10485760)return void alert('Изображение слишком большое! Загрузите файл до 10MB');const a=new FileReader;a.onload=e=>{t.value=e.target?.result;try{localStorage.setItem('lyrics_widget_bg_img',t.value)}catch(e){console.error('缓存存不下了:',e)}},a.readAsDataURL(e)}}const re=(0,a.ref)(!1),oe=(0,a.ref)(''),se=(0,a.ref)([]);function le(){re.value=!re.value,re.value&&i.music.loadUserList()}async function ce(){if(!oe.value)return;const e=globalThis.Music;if(e){se.value=[];try{const n=await e.SearchMusic(oe.value);n&&n.Name?se.value=[{SongName:n.Name,Singer:n.Singer||'Unknown'}]:alert('Песня не найдена')}catch(e){console.error(e),alert('Ошибка поиска')}}}(0,a.onMounted)(()=>{const e=localStorage.getItem('lyrics_widget_bg_img');e&&(t.value=e),i.music.loadUserList(),re.value=!1});const Ae=(0,a.ref)(!1),de=(0,a.ref)(65),pe=(0,a.ref)('Музыка'),ue=(0,a.ref)('Вставьте монету...'),ge=(0,a.ref)(''),me=(0,a.ref)(''),Ce=(0,a.ref)(''),fe=(0,a.ref)([]),be=(0,a.ref)(-1),he=(0,a.ref)(!1),ve=(0,a.ref)(-1),xe=new Audio;xe.volume=de.value/100,(0,a.watch)(de,e=>{xe.volume=e/100});const Be=globalThis.Music;function ye(e){const n=fe.value;if(!n.length)return pe.value='',ue.value='',void(be.value=-1);let t=n.length-1;for(let a=0;a<n.length;a++)if(e<n[a].time){t=a-1;break}if(t<0)return pe.value='',ue.value=n[0]?.text??'',void(be.value=-1);t!==be.value&&(be.value=t,pe.value=n[t]?.text??'',ue.value=n[t+1]?.text??'')}function Ee(){const e=xe.currentTime||0;ye(e),xe.duration&&!isNaN(xe.duration)&&(X.value=xe.duration),Q.value||(G.value=e)}function we(){const e=i.music.list.length;if(0!==e)if('single'===J.value)xe.currentTime=0,xe.play();else if('random'===J.value){let n=Math.floor(Math.random()*e);e>1&&n===i.music.index&&(n=Math.floor(Math.random()*e)),i.music.index=n,Se(n)}else{let n=i.music.index+1;n>=e&&(n=0),i.music.index=n,Se(n)}}async function ke(e,n){if(e?.stopPropagation(),'stop'==n)return xe.pause(),void(Ae.value=!1);let t=i.music.index;if(0!==i.music.list.length){if(t>=i.music.list.length&&(t=0),t<0&&(t=0),'play'==n){const e=he.value&&ve.value===t&&xe.src;if(!Ae.value&&e)return xe.play(),void(Ae.value=!0);Se(t)}'prev'==n&&(t>0?t-=1:t=i.music.list.length-1,i.music.index=t,Se(t)),'next'==n&&(t<i.music.list.length-1?t+=1:t=0,i.music.index=t,Se(t))}}async function Se(e){if(!i.music.list[e])return;const n=i.music.list[e],t=n.song;let a='';const r=i.music.cache[t],o=r&&'object'==typeof r?r:null;if(r){const e='string'==typeof r?r:r.Url;if(e){await i.music.checkAudioAvailability(e)&&(a=e,o&&(me.value=o.Singer,ge.value=o.Name,Ce.value=o.Lyric))}}let s=null;if(!a){pe.value='Поиск...',ue.value='...';try{const e=await Be.SearchMusic(t);if(!e?.Url)return pe.value='Ошибка',void(ue.value='Попробуйте снова');a=e.Url,s=e,i.music.cache[t]=e}catch(e){return void(pe.value='Ошибка')}}X.value=0,G.value=0,a!=xe.src&&(xe.src=a);const l=s||o;l?(me.value=l.Singer,ge.value=l.Name,Ce.value=l.Lyric):(ge.value=t,me.value=n.singer||''),Ce.value?(fe.value=function(e){const n=e.split(/\\r?\\n/),t=[];for(const e of n){const n=e.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g),a=e.replace(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g,'').trim();if(n&&a)for(const e of n){const n=e.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/);if(!n)continue;const i=60*Number(n[1])+Number(n[2])+(n[3]?Number(n[3].padEnd(3,'0')):0)/1e3;t.push({time:i,text:a})}}return t.sort((e,n)=>e.time-n.time),t}(Ce.value||''),be.value=-1,ye(0)):(fe.value=[],pe.value=t,ue.value='Нет текста'),xe.play().catch(e=>console.log('play fail',e)),Ae.value=!0,he.value=!0,ve.value=e}(0,a.watch)(()=>i.music.index,(e,n)=>{-1==n&&e>-1&&ke(null,'play')});const Me=(0,a.ref)(null);let Ne=0,De=0,Le=0,ze=0;const Ue=(0,a.ref)('50%'),Ye=(0,a.ref)('20%'),Ve=(0,a.ref)(!1),Ie=(0,a.ref)(!1),Te=(0,a.ref)(!1),Fe=$('body').width()||0,We=$('body').height()||0;function Pe(e){const n=Me.value;if(!n)return;if(2===e.button||3===e.which)return void(Te.value=!0);if(e.target.closest('.photo-zone')||e.target.closest('.camera-lens')||e.target.closest('.volume-slider-box')||e.target.closest('.arcade-btn')||e.target.closest('.playlist-panel')||e.target.closest('.music-slider')||e.target.closest('.mode-btn-lcd'))return;Te.value=!1,Ve.value=!0,Ie.value=!1,n.classList.add('dragging');const t=n.getBoundingClientRect();Le=t.left+t.width/2,ze=t.top+t.height/2,'mousedown'===e.type?(Ne=e.clientX,De=e.clientY,$('body').on('mousemove',je),$('body').on('mouseup',_e)):'touchstart'===e.type&&(Ne=e.touches[0].clientX,De=e.touches[0].clientY,$('body').on('touchmove',je),$('body').on('touchend',_e))}function je(e){if(!Ve.value||Te.value)return;let n,t;e&&'function'==typeof e.preventDefault&&e.preventDefault(),Ie.value=!0,'mousemove'===e.type?(n=e.clientX,t=e.clientY):'touchmove'===e.type&&(n=e.touches[0].clientX,t=e.touches[0].clientY);const a=Le+(n-Ne),i=ze+(t-De),r=Fe-20,o=We-20,s=Math.max(20,Math.min(r,a)),l=Math.max(20,Math.min(o,i));a!==s||i!==l?Me.value.classList.add('near-boundary'):Me.value.classList.remove('near-boundary'),Ue.value=`${a}px`,Ye.value=`${i}px`,Me.value.style.transform='translate(-50%, -50%) scale(1.02)'}function _e(e){if(!Ve.value&&!Te.value)return;if($('body').off('mousemove',je),$('body').off('mouseup',_e),$('body').off('touchmove',je),$('body').off('touchend',_e),Te.value)return void(Te.value=!1);const n=Me.value;Ve.value=!1,n&&n.classList.remove('dragging','near-boundary');const t=n?n.style.transform:'';t&&t.includes('scale')&&(n.style.transform=t.replace(/scale\\([\\d.]+\\)/,'')),Ie.value?$e():setTimeout(()=>{e&&e.target&&e.target.closest&&(e.target.closest('.control-panel')||e.target.closest('.photo-zone')||e.target.closest('.playlist-panel'))||n&&!n.classList.contains('expanded')&&Re(e)},50),Ie.value=!1}function $e(){const e=Me.value;if(!e)return;const n=e.getBoundingClientRect(),t={x:(n.left+n.width/2)/Fe*100,y:(n.top+n.height/2)/We*100};localStorage.setItem('lyricsWidgetPosition',JSON.stringify(t))}function Re(e){const n=Me.value;n&&(Ve.value||Ie.value||Te.value||n.classList.contains('expanded')||(n.classList.add('expanded'),re.value=!1))}function qe(e){const n=Me.value;n&&(n.classList.remove('expanded'),re.value=!1)}function Oe(e){const n=Me.value;if(Te.value=!0,Ve.value){Ve.value=!1,n&&n.classList.remove('dragging','near-boundary');const e=n?n.style.transform:'';e&&e.includes('scale')&&(n.style.transform=e.replace(/scale\\([\\d.]+\\)/,''))}}function Xe(){}function Ge(){}function Qe(){}function Je(e){Te.value&&!e.target.closest('.lyrics-widget')&&(Te.value=!1)}function Ke(e){'Escape'===e.key&&(Te.value=!1)}function He(){$e()}return(0,a.onMounted)(()=>{Me.value&&Me.value.addEventListener('touchmove',e=>{Ve.value&&e.preventDefault()},{passive:!1}),$('body').on('click',Je),$('body').on('keydown',Ke),window.addEventListener('resize',He),function(){const e=Me.value;if(!e)return;const n=localStorage.getItem('lyricsWidgetPosition');if(n){const t=JSON.parse(n);let a='50',i='20';t.x<100&&t.x>0&&(a=t.x),t.y<100&&t.y>0&&(i=t.y),e.style.left=a+'%',e.style.top=i+'%'}}(),xe.addEventListener('timeupdate',Ee),xe.addEventListener('ended',we);const e=localStorage.getItem('lyrics_widget_bg_img');e&&(t.value=e),i.music.loadUserList(),re.value=!1}),(0,a.onBeforeUnmount)(()=>{}),(e,Q)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{id:'lyricsWidget',class:'lyrics-widget',onMousedown:Pe,onTouchstart:Pe,onContextmenu:Oe,onMouseenter:Xe,onMouseleave:Ge,onTouchend:Qe,ref_key:'widget',ref:Me,style:(0,a.normalizeStyle)(`top:${Ye.value};left:${Ue.value}`)},[(0,a.createCommentVNode)(' 收缩状态 '),(0,a.createElementVNode)('div',{class:'collapsed-icon',onClick:Re},[(0,a.createElementVNode)('div',r,[(0,a.createElementVNode)('img',{src:t.value||'https://i.postimg.cc/k4kM905J/anime-girl-blue.jpg',class:'c-avatar',alt:'avatar',draggable:'false'},null,8,o)]),Q[11]||(Q[11]=(0,a.createElementVNode)('div',{class:'collapsed-frame-overlay'},null,-1))]),(0,a.createCommentVNode)(' 展开状态 '),(0,a.createElementVNode)('div',s,[(0,a.createCommentVNode)(' ★★★ 挂件：点击打开播放列表 ★★★ '),(0,a.createElementVNode)('img',{src:'https://i.postimg.cc/ZRFs4bVj/播放列表.png',class:'machine-charm',alt:'charm',draggable:'false',onClick:(0,a.withModifiers)(le,['stop']),title:'Открыть/закрыть плейлист'}),(0,a.createCommentVNode)(' ★★★ 播放列表面板 ★★★ '),re.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:0,class:'playlist-panel',onClick:Q[2]||(Q[2]=(0,a.withModifiers)(()=>{},['stop'])),onMousedown:Q[3]||(Q[3]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createElementVNode)('div',l,[Q[12]||(Q[12]=(0,a.createElementVNode)('span',null,[(0,a.createElementVNode)('i',{class:'fas fa-list-ul'}),(0,a.createTextVNode)(' Плейлист')],-1)),(0,a.createElementVNode)('button',{class:'close-list-btn',onClick:Q[0]||(Q[0]=e=>re.value=!1)},'×')]),(0,a.createCommentVNode)(' 搜索区 '),(0,a.createElementVNode)('div',c,[(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':Q[1]||(Q[1]=e=>oe.value=e),onKeyup:(0,a.withKeys)(ce,['enter']),placeholder:'Поиск песни...',class:'search-input'},null,544),[[a.vModelText,oe.value]]),(0,a.createElementVNode)('button',{onClick:ce,class:'search-btn'},[...Q[13]||(Q[13]=[(0,a.createElementVNode)('i',{class:'fas fa-search'},null,-1)])])]),(0,a.createCommentVNode)(' 搜索结果 '),se.value.length>0?((0,a.openBlock)(),(0,a.createElementBlock)('div',A,[Q[15]||(Q[15]=(0,a.createElementVNode)('div',{class:'list-section-title'},'Результаты:',-1)),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(se.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:'res-'+n,class:'playlist-item search-item'},[(0,a.createElementVNode)('div',d,[(0,a.createElementVNode)('div',p,(0,a.toDisplayString)(e.SongName),1),(0,a.createElementVNode)('div',u,(0,a.toDisplayString)(e.Singer),1)]),(0,a.createElementVNode)('button',{class:'add-btn',onClick:n=>function(e){const n={song:e.SongName,singer:e.Singer,message_id:-1,source:'user'};i.music.userList.push(n),i.music.saveUserList(),i.music.getAllChatMessages(),se.value=[],oe.value=''}(e)},[...Q[14]||(Q[14]=[(0,a.createElementVNode)('i',{class:'fas fa-plus-circle'},null,-1)])],8,g)]))),128))])):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' musicPlayer.vue - template区域 '),(0,a.createElementVNode)('div',m,[Q[17]||(Q[17]=(0,a.createElementVNode)('div',{class:'list-section-title'},'Текущий плейлист:',-1)),0===(0,a.unref)(i).music.list.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',C,'Песни не найдены...')):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 循环渲染 list '),((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)((0,a.unref)(i).music.list,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:'song-'+n,class:(0,a.normalizeClass)(['playlist-item',{active:(0,a.unref)(i).music.index===n}])},[(0,a.createCommentVNode)(' ★★★ 修改这里：点击时调用 switchSong(idx) ★★★ '),(0,a.createElementVNode)('div',{class:'song-info',onClick:e=>{return t=n,i.music.index=t,void Se(t);var t}},[(0,a.createElementVNode)('div',b,['chat'===e.source?((0,a.openBlock)(),(0,a.createElementBlock)('i',h)):(0,a.createCommentVNode)('v-if',!0),(0,a.createTextVNode)(' '+(0,a.toDisplayString)(e.song),1)]),(0,a.createElementVNode)('div',v,(0,a.toDisplayString)(e.singer),1)],8,f),(0,a.createCommentVNode)(' 删除按钮保持不变 '),'user'===e.source?((0,a.openBlock)(),(0,a.createElementBlock)('button',{key:0,class:'del-btn',onClick:n=>function(e){const n=i.music.userList.findIndex(n=>n.song===e.song&&n.singer===e.singer);-1!==n&&(i.music.userList.splice(n,1),i.music.saveUserList(),i.music.getAllChatMessages())}(e)},[...Q[16]||(Q[16]=[(0,a.createElementVNode)('i',{class:'fas fa-trash-alt'},null,-1)])],8,x)):(0,a.createCommentVNode)('v-if',!0)],2))),128))])],32)):(0,a.createCommentVNode)('v-if',!0),(0,a.createCommentVNode)(' 机器顶部 '),(0,a.createElementVNode)('div',B,[(0,a.createElementVNode)('div',{class:'camera-lens',onClick:(0,a.withModifiers)(qe,['stop']),title:'Нажмите для закрытия'},[...Q[18]||(Q[18]=[(0,a.createElementVNode)('div',{class:'lens-reflection'},null,-1)])]),Q[19]||(Q[19]=(0,a.createElementVNode)('div',{class:'flash-light'},null,-1)),(0,a.createCommentVNode)(' ★★★ 这里修改了文字：PURIKURA -> КРОЛИК ★★★ '),Q[20]||(Q[20]=(0,a.createElementVNode)('div',{class:'brand-logo'},'КРОЛИК',-1))]),(0,a.createCommentVNode)(' 机器屏幕 '),(0,a.createElementVNode)('div',y,[(0,a.createCommentVNode)(' 照片显示区 '),(0,a.createElementVNode)('div',{class:'photo-zone',onClick:ae,title:'Нажмите для смены фото'},[(0,a.createElementVNode)('div',E,[(0,a.createElementVNode)('div',w,[(0,a.createElementVNode)('img',{src:t.value||'https://i.postimg.cc/k4kM905J/anime-girl-blue.jpg',class:'purikura-img',alt:'фото-стикер',draggable:'false'},null,8,k),Q[21]||(Q[21]=(0,a.createElementVNode)('div',{class:'gloss-layer'},null,-1))]),(0,a.createCommentVNode)(' 贴纸 '),Q[23]||(Q[23]=(0,a.createElementVNode)('img',{src:'https://i.postimg.cc/sxSGFqTf/拍立得贴纸.png',class:'deco-sticker-tl',alt:'sticker',draggable:'false'},null,-1)),(0,a.createElementVNode)('div',S,[(0,a.createElementVNode)('span',M,(0,a.toDisplayString)(O.value),1),Q[22]||(Q[22]=(0,a.createElementVNode)('div',{class:'upload-hint'},[(0,a.createElementVNode)('i',{class:'fas fa-camera'})],-1))])])]),(0,a.createCommentVNode)(' 歌词区 (保证高度) '),(0,a.createElementVNode)('div',N,[(0,a.createCommentVNode)(' 修改头部：使用 flex-between 分开左边的信息和右边的按钮 '),(0,a.createElementVNode)('div',D,[(0,a.createElementVNode)('div',L,[Q[24]||(Q[24]=(0,a.createElementVNode)('i',{class:'fas fa-compact-disc spin-icon'},null,-1)),(0,a.createElementVNode)('span',U,(0,a.toDisplayString)(ee(G.value))+' / '+(0,a.toDisplayString)(ee(X.value)),1)]),(0,a.createCommentVNode)(' ★★★ 新位置：播放模式切换按钮 ★★★ '),(0,a.createCommentVNode)(' 使用 @click.stop 防止误触拖拽 '),(0,a.createElementVNode)('button',{class:'mode-btn-lcd',onClick:(0,a.withModifiers)(Z,['stop']),title:H.value},[(0,a.createElementVNode)('i',{class:(0,a.normalizeClass)(K.value)},null,2)],8,Y)]),(0,a.createElementVNode)('div',V,[(0,a.createElementVNode)('div',I,(0,a.toDisplayString)(pe.value),1),(0,a.createElementVNode)('div',T,(0,a.toDisplayString)(ue.value),1)]),(0,a.createElementVNode)('div',F,[(0,a.createCommentVNode)(' ★★★ 修复：添加 .stop 修饰符防止拖动进度条时拖动窗口 ★★★ '),(0,a.createElementVNode)('div',W,[(0,a.createElementVNode)('input',{type:'range',class:'music-slider',min:'0',max:X.value,step:'0.1',value:G.value,onInput:(0,a.withModifiers)(ne,['stop']),onChange:(0,a.withModifiers)(te,['stop']),onMousedown:Q[4]||(Q[4]=(0,a.withModifiers)(()=>{},['stop'])),onTouchstart:Q[5]||(Q[5]=(0,a.withModifiers)(()=>{},['stop'])),style:(0,a.normalizeStyle)({'--prog-fill':G.value/(X.value||1)*100+'%'})},null,44,P)])])])]),(0,a.createCommentVNode)(' 底部控制台 '),(0,a.createElementVNode)('div',{class:'control-panel',onClick:Q[10]||(Q[10]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createElementVNode)('div',j,[(0,a.createElementVNode)('button',{class:'arcade-btn img-btn',onClick:Q[6]||(Q[6]=e=>ke(e,'prev'))},[...Q[25]||(Q[25]=[(0,a.createElementVNode)('img',{src:'https://i.postimg.cc/NFT2hSdf/上一首.png',alt:'Назад',draggable:'false'},null,-1)])]),(0,a.createCommentVNode)(' ★★★ 修改：播放按钮图片添加 :class=\"{ \\'spin-img\\': isPlaying }\" ★★★ '),(0,a.createElementVNode)('button',{class:'arcade-btn img-btn play-btn-custom',onClick:Q[7]||(Q[7]=e=>ke(e,Ae.value?'stop':'play'))},[(0,a.createElementVNode)('img',{src:Ae.value?'https://i.postimg.cc/pTYcRWqC/水色播放中.png':'https://i.postimg.cc/9MtgCmJp/水色播放键.png',class:(0,a.normalizeClass)({'spin-img':Ae.value}),alt:'Играть/Пауза',draggable:'false'},null,10,R)]),(0,a.createElementVNode)('button',{class:'arcade-btn img-btn',onClick:Q[8]||(Q[8]=e=>ke(e,'next'))},[...Q[26]||(Q[26]=[(0,a.createElementVNode)('img',{src:'https://i.postimg.cc/1X6Vx2vm/下一首.png',alt:'Вперёд',draggable:'false'},null,-1)])])]),(0,a.createElementVNode)('div',q,[(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'range',class:'volume-slider',min:'0',max:'100','onUpdate:modelValue':Q[9]||(Q[9]=e=>de.value=e),style:(0,a.normalizeStyle)({'--volume-fill':de.value+'%'})},null,4),[[a.vModelText,de.value]])])]),Q[27]||(Q[27]=(0,a.createElementVNode)('div',{class:'print-slot'},null,-1)),(0,a.createElementVNode)('input',{type:'file',ref_key:'fileInput',ref:n,accept:'image/png, image/jpeg, image/jpg',style:{display:'none'},onChange:ie},null,544)])],36))}});t(585);const X=(0,t(400).A)(O,[['__scopeId','data-v-9c76bbee']]),G=(0,a.createApp)(X);function Q(){return globalThis.Music?Promise.resolve():new Promise((e,n)=>{const t=document.createElement('script');t.src='https://drive.baibai.cv/f/ZKEBuW/Music.js',t.onload=()=>e(),t.onerror=()=>n(),document.head.appendChild(t)})}async function J(e,n){if(console.log(e),n-=1,'消息生成完成'==e){const e=await getChatMessages(`${n}-${n}`,{role:'all'}),t=i.music.list.filter(e=>e.message_id!==n);for(const n of e){const e=[...n.message.matchAll(i.music.regex)];if(0==e.length)continue;const a=e.at(-1),r={song:a[1],singer:a[2],message_id:n.message_id,source:'chat'};t.push(r)}t.sort((e,n)=>e.message_id-n.message_id),i.music.list=t,i.music.index=t.length>0?t.length-1:-1}else await i.music.getAllChatMessages()}function K(){try{$(`head > div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('移除样式时出现错误')}}function H(){try{$(`div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('移除div时出现错误')}}$(async()=>{try{await Q(),await function(){try{K(),H()}catch{}const e=$('<div>').attr('script_id',getScriptId());$('body').append(e),G.mount(e[0]),function(){try{if($(`head > div[script_id=\"${getScriptId()}\"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}catch{console.log('移动css样式时出错')}}()}(),console.log('播放器加载完成!!!!!!!!!!!!!!!!!'),eventOn(tavern_events.CHAT_CHANGED,()=>J('聊天切换')),eventOn(tavern_events.MESSAGE_UPDATED,e=>J('消息更新',e)),eventOn(tavern_events.GENERATION_ENDED,e=>J('消息生成完成',e)),eventOn(tavern_events.MESSAGE_SWIPED,()=>J('消息切换')),eventOn(tavern_events.MESSAGE_DELETED,()=>J('消息删除')),eventOn(tavern_events.MESSAGE_SENT,()=>{console.log('消息已发送')}),eventOn(tavern_events.GENERATION_STOPPED,()=>{console.log('生成暂停')}),await i.music.getAllChatMessages()}catch(e){console.error(e),toastr.error(`手机出现错误:${e}`)}}),$(window).on('pagehide',()=>{console.log('触发了pagehide');try{G.unmount(),K(),H()}catch{}});export{Q as ensureMusicLoaded};\n//# sourceMappingURL=index.js.map",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}