{
  "type": "script",
  "enabled": false,
  "name": " RPG консоль (RU)",
  "id": "150d90e6-83d9-4831-ad2d-507d6ce975dd",
  "content": "import'https://testingcf.jsdelivr.net/npm/vue3-draggable-resizable/dist/Vue3DraggableResizable.css/+esm';var e={132:(e,n,t)=>{t.r(n),t.d(n,{default:()=>s});var a=t(314),i=t.n(a),r=t(378),o=t.n(r)()(i());o.push([e.id,'@import url(https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Press+Start+2P&family=Varela+Round&display=swap);']),o.push([e.id,'.pixel-font[data-v-3e120e34]{font-family:\\'Press Start 2P\\',cursive !important}.lyrics-widget[data-v-3e120e34]{position:absolute;top:20%;left:50%;transform:translate(-50%,-50%);z-index:9999999;-webkit-user-select:none;user-select:none;font-family:\\'Varela Round\\',sans-serif;transition:transform 0.2s}.lyrics-widget.dragging[data-v-3e120e34]{cursor:grabbing;opacity:0.95;transition:none}.collapsed-view[data-v-3e120e34]{position:relative;width:140px;height:auto;cursor:pointer;filter:drop-shadow(0 5px 10px rgba(255,182,193,0.4));transition:transform 0.3s cubic-bezier(0.34,1.56,0.64,1)}.collapsed-view[data-v-3e120e34]:hover{transform:scale(1.1) rotate(-3deg)}.console-frame[data-v-3e120e34]{position:relative;z-index:2;width:100%;pointer-events:none}.screen-content[data-v-3e120e34]{position:absolute;z-index:1;top:21%;left:18%;width:65%;height:54%;transform:rotate(8.5deg);overflow:hidden;background:#fff0f5;border-radius:4px}.fill-img[data-v-3e120e34]{width:100%;height:100%;object-fit:cover}.lyrics-widget.expanded .collapsed-view[data-v-3e120e34]{display:none}.expanded-view[data-v-3e120e34]{display:none;width:380px;background:rgba(255,245,247,0.85);backdrop-filter:blur(10px);border:4px solid #ffffff;border-radius:24px;padding:18px;box-shadow:0 10px 30px rgba(255,160,175,0.25),inset 0 0 20px rgba(255,255,255,0.8);animation:popIn-3e120e34 0.4s cubic-bezier(0.34,1.56,0.64,1);color:#ff7675}@keyframes popIn-3e120e34{from{opacity:0;transform:scale(0.95) translateY(5px)}to{opacity:1;transform:scale(1) translateY(0)}}.lyrics-widget.expanded .expanded-view[data-v-3e120e34]{display:flex;flex-direction:column;gap:14px}.rpg-header[data-v-3e120e34]{display:flex;align-items:center;gap:14px;background:rgba(255,255,255,0.6);padding:8px 12px;border-radius:18px;box-shadow:0 2px 5px rgba(255,182,193,0.1)}.avatar-box[data-v-3e120e34]{flex-shrink:0;width:90px;height:60px;border-radius:14px;border:4px solid #fff;box-shadow:0 4px 8px rgba(255,182,193,0.3);position:relative;cursor:pointer;overflow:hidden;transition:transform 0.2s;background:#ffe4e1}.avatar-box[data-v-3e120e34]:hover{transform:scale(1.03)}.rect-avatar[data-v-3e120e34]{width:100%;height:100%;object-fit:cover}.upload-hint[data-v-3e120e34]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:16px;text-shadow:0 1px 3px rgba(0,0,0,0.1);opacity:0;transition:opacity 0.2s;pointer-events:none}.avatar-box:hover .upload-hint[data-v-3e120e34]{opacity:1}.status-panel[data-v-3e120e34]{flex:1;display:flex;flex-direction:column;justify-content:center;gap:6px}.name-badge[data-v-3e120e34]{display:flex;justify-content:space-between;align-items:center;color:#ff8fa3;font-weight:800}.p-name[data-v-3e120e34]{font-size:12px;letter-spacing:0.5px}.lvl-txt[data-v-3e120e34]{background:#fff;color:#ffaa91;padding:1px 8px;border-radius:10px;font-size:9px;font-weight:bold;box-shadow:0 2px 0 rgba(255,170,145,0.2)}.bar-container[data-v-3e120e34]{display:flex;align-items:center;gap:6px}.bar-track[data-v-3e120e34]{flex:1;height:8px;background:#fff;border-radius:10px;border:1px solid #ffeef0}.bar-fill[data-v-3e120e34]{height:100%;border-radius:10px}.hp-fill[data-v-3e120e34]{background:#ffb7b2}.mp-fill[data-v-3e120e34]{background:#a2dfe3}.bar-icon[data-v-3e120e34]{font-size:10px;width:14px;text-align:center}.red-icon[data-v-3e120e34]{color:#ffb7b2}.yellow-icon[data-v-3e120e34]{color:#ffeaa7}.game-screen-wrapper[data-v-3e120e34]{position:relative;border:4px solid #ffe4e1;border-radius:16px;height:120px;cursor:pointer;overflow:hidden;background:#fff}.game-screen[data-v-3e120e34]{padding:10px;height:100%;display:flex;flex-direction:column;justify-content:space-between;position:relative;z-index:1;background:linear-gradient(180deg,#fff5f7 0%,#ffe3e8 100%);background-image:linear-gradient(#fff 1px,transparent 1px),linear-gradient(90deg,#fff 1px,transparent 1px);background-size:14px 14px}.screen-ui-top[data-v-3e120e34]{display:flex;justify-content:space-between;font-size:9px;color:#ffb7b2}.scene-stage[data-v-3e120e34]{height:25px;position:relative;border-top:2px dashed #ffc1c1}.character-sprite[data-v-3e120e34]{position:absolute;bottom:2px;left:50%;transform:translateX(-50%);font-size:14px;color:#ff6b81;white-space:nowrap;font-weight:600}.character-sprite.running[data-v-3e120e34]{animation:float-3e120e34 0.6s infinite ease-in-out alternate}@keyframes float-3e120e34{from{transform:translateX(-50%) translateY(0)}to{transform:translateX(-50%) translateY(-4px)}}.screen-overlay[data-v-3e120e34]{position:absolute;top:0;left:0;width:100%;height:60%;background:linear-gradient(rgba(255,255,255,0.5),rgba(255,255,255,0));pointer-events:none;z-index:2;border-radius:10px}.controls-pad[data-v-3e120e34]{display:flex;justify-content:space-between;align-items:center;margin-top:8px;padding:0 10px}.pad-left[data-v-3e120e34]{display:flex;gap:14px}.d-btn[data-v-3e120e34]{border:none;width:36px;height:36px;border-radius:14px;background:#fff;color:#ff8fa3;font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s;box-shadow:0 4px 8px rgba(255,182,193,0.25)}.d-btn[data-v-3e120e34]:active{transform:scale(0.9)}.d-btn.play[data-v-3e120e34]{background:linear-gradient(135deg,#ff9a9e 0%,#fecfef 100%);color:#fff;box-shadow:0 4px 10px rgba(255,154,158,0.4)}.pad-right[data-v-3e120e34]{display:flex;align-items:center;width:100px}.volume-slider[data-v-3e120e34]{-webkit-appearance:none !important;background:transparent !important;width:100% !important;cursor:pointer !important}.volume-slider[data-v-3e120e34]::-webkit-slider-runnable-track{height:8px;width:100%;background:#fff;border-radius:4px;border:1px solid #ffe4e1 !important;background-image:linear-gradient(#ff9a9e,#ff9a9e);background-size:var(--volume-fill,0%) 100%;background-repeat:no-repeat}.volume-slider[data-v-3e120e34]::-webkit-slider-thumb{-webkit-appearance:none !important;height:16px !important;width:16px !important;background:#fff !important;border:2px solid #ff9a9e !important;border-radius:50% !important;margin-top:-5px !important;box-shadow:0 2px 4px rgba(0,0,0,0.05) !important}.screen-view-anim[data-v-3e120e34]{display:flex;flex-direction:column;justify-content:space-between}.screen-view-list[data-v-3e120e34]{height:100%;display:flex;flex-direction:column;gap:6px;overflow:hidden}.search-bar[data-v-3e120e34]{display:flex;gap:6px;height:24px}.pixel-input[data-v-3e120e34]{flex:1;background:rgba(255,255,255,0.8);border:2px solid #ffb7b2;border-radius:8px;padding:0 8px;font-family:\\'Varela Round\\',sans-serif;font-size:10px;color:#ff6b81;outline:none}.pixel-input[data-v-3e120e34]::placeholder{color:#ffcdc9}.add-btn[data-v-3e120e34]{width:24px;border:none;background:#ffb7b2;color:#fff;border-radius:6px;cursor:pointer;font-weight:bold;line-height:1}.add-btn[data-v-3e120e34]:hover{background:#ff9a9e}.list-container[data-v-3e120e34]{flex:1;overflow-y:auto;padding-right:4px}.list-item[data-v-3e120e34]{display:flex;justify-content:space-between;align-items:center;font-size:11px;color:#ff8fa3;padding:3px 6px;border-radius:6px;cursor:pointer;margin-bottom:2px;transition:background 0.2s}.list-item[data-v-3e120e34]:hover{background:rgba(255,183,178,0.2)}.list-item.active[data-v-3e120e34]{background:#ffb7b2;color:#fff;font-weight:bold}.song-txt[data-v-3e120e34]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:85%}.del-btn[data-v-3e120e34]{font-size:9px;opacity:0.6;padding:2px}.del-btn[data-v-3e120e34]:hover{opacity:1;color:#ff4757}.empty-tip[data-v-3e120e34]{text-align:center;color:#ffcdc9;font-size:10px;margin-top:20px;font-family:\\'Press Start 2P\\',cursive}.custom-scroll[data-v-3e120e34]::-webkit-scrollbar{width:4px}.custom-scroll[data-v-3e120e34]::-webkit-scrollbar-track{background:transparent}.custom-scroll[data-v-3e120e34]::-webkit-scrollbar-thumb{background:#ffe3e8;border-radius:4px}.custom-scroll[data-v-3e120e34]::-webkit-scrollbar-thumb:hover{background:#ffb7b2}.menu-btn.active[data-v-3e120e34]{background:#ffb7b2;color:#fff}.screen-lyrics-box[data-v-3e120e34]{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;margin-top:-5px;padding:0 4px;overflow:hidden}.s-lyric-cur[data-v-3e120e34]{font-size:13px;font-weight:800;color:#ff6b81;line-height:1.2;margin-bottom:4px;text-shadow:1px 1px 0 #fff;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}.s-lyric-next[data-v-3e120e34]{font-size:10px;color:#ffb7b2;white-space:nowrap;opacity:0.8;max-width:100%;overflow:hidden;text-overflow:ellipsis}.info-card[data-v-3e120e34]{background:rgba(255,255,255,0.6);border:1px solid #fff;border-radius:16px;padding:8px 12px;text-align:center;min-height:55px;display:flex;flex-direction:column;justify-content:center;align-items:center;box-shadow:0 4px 10px rgba(255,182,193,0.15)}.song-title[data-v-3e120e34]{color:#ff6b81;font-family:\\'Press Start 2P\\',cursive;font-size:15px;line-height:1.6;margin-bottom:6px;text-shadow:2px 2px 0 rgba(255,182,193,0.6);max-width:100%;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;letter-spacing:1px}.song-artist[data-v-3e120e34]{color:#ffaa91;font-size:11px;font-weight:600}.shrink-btn[data-v-3e120e34]{width:28px;height:28px;border-radius:50%;margin-left:4px;flex-shrink:0;background:#ffe4e1;color:#ff8fa3;border:none;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s cubic-bezier(0.34,1.56,0.64,1);box-shadow:0 2px 5px rgba(255,182,193,0.3)}.shrink-btn[data-v-3e120e34]:hover{transform:scale(1.15) rotate(90deg);background:#ffb7b2;color:#fff;box-shadow:0 4px 8px rgba(255,182,193,0.5)}.shrink-btn[data-v-3e120e34]:active{transform:scale(0.95)}.shrink-btn i[data-v-3e120e34]{font-size:14px}.hud-mode-switch[data-v-3e120e34]{cursor:pointer;display:flex;align-items:center;gap:4px;padding:0 2px;border-radius:4px;transition:all 0.1s;-webkit-user-select:none;user-select:none}.hud-mode-switch[data-v-3e120e34]:hover{color:#ff6b81;background:rgba(255,255,255,0.5);text-shadow:1px 1px 0 rgba(255,230,230,0.8)}.hud-mode-switch[data-v-3e120e34]:active{transform:translateY(1px)}.blink-arrow[data-v-3e120e34]{font-size:8px;animation:blink-anim-3e120e34 1s steps(2,start) infinite;opacity:0.8}@keyframes blink-anim-3e120e34{to{visibility:hidden}}.screen-ui-top[data-v-3e120e34]{display:flex;justify-content:space-between;align-items:center;font-size:9px;color:#ffb7b2;margin-bottom:2px}.progress-slider[data-v-3e120e34]{-webkit-appearance:none !important;background:transparent !important;width:100% !important;height:100% !important;cursor:pointer !important;display:block;margin:0;padding:0}.progress-slider[data-v-3e120e34]::-webkit-slider-runnable-track{height:8px;width:100%;background:#fff;border-radius:10px;border:1px solid #ffeef0 !important;background-image:linear-gradient(#a2dfe3,#a2dfe3);background-size:var(--progress-fill,0%) 100%;background-repeat:no-repeat}.progress-slider[data-v-3e120e34]::-webkit-slider-thumb{-webkit-appearance:none !important;height:12px;width:12px;background:#fff;border:2px solid #a2dfe3;border-radius:50%;margin-top:-3px;box-shadow:0 1px 3px rgba(0,0,0,0.1);-webkit-transition:transform 0.1s;transition:transform 0.1s}.progress-slider[data-v-3e120e34]:active::-webkit-slider-thumb,.progress-slider[data-v-3e120e34]:hover::-webkit-slider-thumb{transform:scale(1.2)}.collapsed-view[data-v-3e120e34]{position:relative;width:140px;height:auto;cursor:pointer;filter:drop-shadow(0 5px 5px rgba(0,0,0,0.15));transition:all 0.4s cubic-bezier(0.175,0.885,0.32,1.275);animation:console-float-3e120e34 3s ease-in-out infinite;transform-origin:center center}.collapsed-view[data-v-3e120e34]:hover{animation-play-state:paused;transform:scale(1.15) rotate(-5deg) translateY(-10px);filter:drop-shadow(0 20px 20px rgba(255,107,129,0.4)) brightness(1.05);z-index:10}.collapsed-view[data-v-3e120e34]:active{transform:scale(0.95) rotate(-5deg) translateY(0);filter:drop-shadow(0 2px 3px rgba(0,0,0,0.2));transition:all 0.1s}@keyframes console-float-3e120e34{0%{transform:translateY(0px) rotate(0deg)}50%{transform:translateY(-6px) rotate(2deg)}100%{transform:translateY(0px) rotate(0deg)}}\\n','',{version:3,sources:['webpack://./src/游戏机播放器/musicPlayer.vue'],names:[],mappings:'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',sourcesContent:['<template>\\n  <div\\n    id=\"lyricsWidget\"\\n    class=\"lyrics-widget\"\\n    :class=\"{ \\'is-playing\\': isPlaying, \\'expanded\\': isExpanded }\"\\n    @mousedown=\"startDrag\"\\n    @touchstart=\"startDrag\"\\n    @contextmenu=\"onContextMenu\"\\n    @mouseenter=\"onMouseEnter\"\\n    @mouseleave=\"onMouseLeave\"\\n    @touchend=\"onTouchEnd\"\\n    ref=\"widget\"\\n    :style=\"`top:${dragY};left:${dragX}`\"\\n  >\\n    \\x3c!-- 隐藏的文件上传输入框 --\\x3e\\n    <input\\n      type=\"file\"\\n      ref=\"fileInput\"\\n      accept=\"image/*\"\\n      style=\"display: none\"\\n      @change=\"handleAvatarUpload\"\\n    />\\n\\n    \\x3c!-- 1. 收缩状态：悬浮小挂件 --\\x3e\\n    <div class=\"collapsed-view\" @click=\"toggleExpand\">\\n      \\x3c!-- 填在坑里的图片 --\\x3e\\n      <div class=\"screen-content\">\\n         <img :src=\"coverUrl\" class=\"fill-img\" />\\n      </div>\\n      \\x3c!-- 游戏机外框 --\\x3e\\n      <img src=\"https://i.postimg.cc/DfQVDs6w/you-xi-ji.png\" alt=\"Frame\" class=\"console-frame\" />\\n    </div>\\n\\n    \\x3c!-- 2. 展开状态 --\\x3e\\n    <div class=\"expanded-view\">\\n      <div class=\"rpg-header\">\\n        \\x3c!-- 1. 头像部分 --\\x3e\\n        <div class=\"avatar-box\" @click.stop=\"triggerUpload\" title=\"Нажмите для смены аватара\">\\n          <img :src=\"coverUrl\" class=\"rect-avatar\" />\\n          <div class=\"upload-hint\"><i class=\"fas fa-camera\"></i></div>\\n        </div>\\n\\n        \\x3c!-- 2. 状态条部分 --\\x3e\\n        <div class=\"status-panel\">\\n          <div class=\"name-badge\">\\n            <span class=\"p-name pixel-font\">{{ currentSinger || \\'Player 1\\' }}</span>\\n            <span class=\"lvl-txt pixel-font\">Lv.99</span>\\n          </div>\\n          <div class=\"bar-container hp-container\">\\n            <i class=\"fas fa-heart bar-icon red-icon\"></i>\\n            <div class=\"bar-track\">\\n              <div class=\"bar-fill hp-fill\" :style=\"{ width: volume + \\'%\\' }\"></div>\\n            </div>\\n          </div>\\n<div class=\"bar-container mp-container\">\\n  <i class=\"fas fa-bolt bar-icon yellow-icon\"></i>\\n  \\x3c!-- 修改开始：换成 Input Range --\\x3e\\n  <div class=\"bar-track\" style=\"position: relative; overflow: visible; background: none; border: none;\">\\n    <input\\n      type=\"range\"\\n      class=\"progress-slider\"\\n      min=\"0\"\\n      max=\"100\"\\n      step=\"0.1\"\\n      :value=\"progress\"\\n      @input=\"handleSeek\"\\n      :style=\"{ \\'--progress-fill\\': progress + \\'%\\' }\"\\n    />\\n  </div>\\n  \\x3c!-- 修改结束 --\\x3e\\n</div>\\n        </div>\\n\\n        \\x3c!-- 收缩按钮 --\\x3e\\n        <button class=\"shrink-btn\" @click.stop=\"toggleExpand\" title=\"Свернуть панель\">\\n          <i class=\"fas fa-compress-arrows-alt\"></i>\\n        </button>\\n      </div>\\n\\n      \\x3c!-- 游戏屏幕区 --\\x3e\\n      <div class=\"game-screen-wrapper\">\\n        <div class=\"game-screen\">\\n\\n\\x3c!-- musicPlayer.vue 的 template 部分 --\\x3e\\n\\n\\x3c!-- 找到这一块: A面：播放界面 --\\x3e\\n<div v-if=\"!showPlaylist\" class=\"screen-view-anim\" style=\"height:100%; width:100%\">\\n\\n  \\x3c!-- 【修改这里：屏幕顶部状态栏】 --\\x3e\\n  <div class=\"screen-ui-top pixel-font\">\\n    <span>КВЕСТ: МУЗЫКА</span>\\n\\n    \\x3c!-- 新增：模式切换按钮 (HUD风格) --\\x3e\\n    \\x3c!-- 点击这里切换模式，显示当前模式的像素文字 --\\x3e\\n    <div class=\"hud-mode-switch\" @click=\"togglePlayMode\" :title=\"modeTitle\">\\n      <span class=\"blink-arrow\">▶</span>\\n      <span>{{ modePixelText }}</span>\\n    </div>\\n  </div>\\n  \\x3c!-- ------------------------- --\\x3e\\n\\n  \\x3c!-- 歌词显示区 (保持不变) --\\x3e\\n  <div class=\"screen-lyrics-box\">\\n              <div class=\"s-lyric-cur\">{{ currentLine || \\'Ожидание...\\' }}</div>\\n              <div class=\"s-lyric-next\">{{ nextLine }}</div>\\n            </div>\\n\\n            <div class=\"scene-stage\">\\n              <div class=\"character-sprite\" :class=\"{ \\'running\\': isPlaying }\">\\n                 <span class=\"sprite-body\" style=\"font-weight:bold; white-space:nowrap;\">{{ animFrame }}</span>\\n              </div>\\n            </div>\\n          </div>\\n\\n          \\x3c!-- 【B面：列表界面】 --\\x3e\\n          <div v-else class=\"screen-view-list\">\\n             <div class=\"search-bar\">\\n               <input\\n                 v-model=\"searchKeyword\"\\n                 @keydown.enter=\"handleSearch\"\\n                 placeholder=\"Поиск песни...\"\\n                 class=\"pixel-input\"\\n               />\\n               <button class=\"add-btn\" @click=\"handleSearch\">+</button>\\n             </div>\\n             <div class=\"list-container custom-scroll\">\\n               <div\\n                 v-for=\"(item, index) in musicList\"\\n                 :key=\"index\"\\n                 class=\"list-item\"\\n                 :class=\"{ \\'active\\': index === sharedState.music.index }\"\\n                 @click=\"playFromList(index, $event)\"\\n               >\\n                 <span class=\"song-txt\">{{ index + 1 }}. {{ item.song }}</span>\\n                 <i class=\"fas fa-times del-btn\" @click=\"removeFromList(index, $event)\"></i>\\n               </div>\\n               <div v-if=\"musicList.length === 0\" class=\"empty-tip\">Нет данных</div>\\n             </div>\\n          </div>\\n\\n        </div>\\n        <div class=\"screen-overlay\"></div>\\n      </div>\\n\\n      \\x3c!-- 歌曲信息区 --\\x3e\\n      <div class=\"info-card\">\\n        <div class=\"song-title\">{{ currentSong || \\'Песня не выбрана\\' }}</div>\\n        <div class=\"song-artist\" v-if=\"currentSinger\">Исполнитель: {{ currentSinger }}</div>\\n      </div>\\n\\n      \\x3c!-- 底部控制区 --\\x3e\\n      <div class=\"controls-pad bottom-controls\" @click.stop>\\n        <div class=\"pad-left\">\\n           \\x3c!-- 菜单按钮 --\\x3e\\n           <button class=\"d-btn menu-btn\" @click=\"togglePlaylistView\" :class=\"{ active: showPlaylist }\">\\n             <i class=\"fas fa-list\"></i>\\n           </button>\\n           <button class=\"d-btn prev\" @click=\"e => controlAction(e, \\'prev\\')\"><i class=\"fas fa-step-backward\"></i></button>\\n           <button class=\"d-btn play\" @click=\"e => controlAction(e, !isPlaying ? \\'play\\' : \\'stop\\')\">\\n             <i :class=\"[\\'fas\\', isPlaying ? \\'fa-pause\\' : \\'fa-play\\']\"></i>\\n           </button>\\n           <button class=\"d-btn next\" @click=\"e => controlAction(e, \\'next\\')\"><i class=\"fas fa-step-forward\"></i></button>\\n        </div>\\n\\n        <div class=\"pad-right volume-control\">\\n          <input\\n            type=\"range\"\\n            class=\"volume-slider\"\\n            min=\"0\"\\n            max=\"100\"\\n            v-model=\"volume\"\\n            @click.stop\\n            :style=\"{ \\'--volume-fill\\': volume + \\'%\\' }\"\\n          />\\n        </div>\\n      </div>\\n    </div>\\n  </div>\\n</template>\\n\\n<script setup lang=\"ts\">\\nimport { ref, onMounted, onBeforeUnmount, watch, computed } from \\'vue\\';\\nimport { sharedState } from \\'./shared-state\\';\\n\\n// ------------ 逻辑部分 ------------\\nconst isPlaying = ref(false);\\nconst isExpanded = ref(false); // 【新增】控制展开状态\\nconst volume = ref(65);\\nconst progress = ref(0);\\nconst currentLine = ref(\\'Вставьте монету\\');\\nconst nextLine = ref(`Начать игру`);\\nconst currentSong = ref(``);\\nconst currentSinger = ref(``);\\nconst currentLyricStr = ref(``);\\nconst currentSongCoverUrl = ref(\\'\\');\\n\\n// 自定义头像逻辑\\nconst fileInput = ref<HTMLInputElement | null>(null);\\nconst customAvatar = ref<string>(\\'\\');\\nconst defaultCover = \\'https://api.dicebear.com/7.x/pixel-art/svg?seed=Love&backgroundColor=b6e3f4\\';\\n\\n// 计算头像\\nconst coverUrl = computed(() => {\\n  if (customAvatar.value) return customAvatar.value;\\n  return currentSongCoverUrl.value || defaultCover;\\n});\\n\\nconst animFrame = ref(\\'( -ω-) zzz...\\');\\nlet animTimer: any = null;\\n\\n// 颜文字动画帧\\nconst idleFrames = [\\n  \\'( -ω-) zzz...\\', \\'( ˘▽˘)っ♨\\', \\'(・_・)\\', \\'( o_o )\\', \\'(・_・)\\',\\n  \\'(￣o￣) . z Z\\', \\'( *・∀・)✄\\', \\'( ˙-˙ )\\', \\'_(:3 」∠)_\\',\\n  \\'(｡･∀･)ﾉ\\', \\'( ○_○)\\', \\'( ´･･)ﾉ(._.`)\\', \\'( ఠ ͟ʖ ఠ)\\', \\'φ(゜▽゜*)♪\\'\\n];\\n\\nconst runFrames = [\\n  \\'( >ω<)/\\', \\'\\\\\\\\(>ω< )\\', \\'└( ^o^ )┐\\', \\'┌( ^o^ )┘\\', \\'♪( ´θ｀)ノ\\',\\n  \\'(ノ^o^)ノ\\', \\'ヾ(⌐■_■)ノ♪\\', \\'(/≧▽≦)/\\', \\'٩(◕‿◕｡)۶\\',\\n  \\'( •̀ ω •́ )y\\', \\'ヽ(✿ﾟ▽ﾟ)ノ\\', \\'(ﾉ*･ω･)ﾉ\\', \\'o(≧口≦)o\\',\\n  \\'(ง •_•)ง\\', \\'♪(^∇^*)\\'\\n];\\n\\n// ------------ 列表逻辑 ------------\\nconst showPlaylist = ref(false);\\nconst searchKeyword = ref(\\'\\');\\nconst musicList = computed(() => sharedState.music.list);\\n// ------【新增：像素文字计算】------\\n// 这里用简短的英文缩写，符合 8-bit 游戏风格\\nconst modePixelText = computed(() => {\\n  switch (sharedState.music.playMode) {\\n    case \\'random\\': return \\'RND\\';  // Random\\n    case \\'single\\': return \\'ONE\\';  // Single Loop\\n    default: return \\'ALL\\';        // List Loop\\n  }\\n});\\n\\nconst modeTitle = computed(() => {\\n  switch (sharedState.music.playMode) {\\n    case \\'random\\': return \\'Случайное воспроизведение\\';\\n    case \\'single\\': return \\'Повтор трека\\';\\n    default: return \\'Повтор плейлиста\\';\\n  }\\n});\\n\\n// ------【新增：切换逻辑】------\\nfunction togglePlayMode(e: Event) {\\n  e.stopPropagation(); // 防止触发拖拽\\n  const modes: (\\'list\\' | \\'random\\' | \\'single\\')[] = [\\'list\\', \\'random\\', \\'single\\'];\\n  const currentIdx = modes.indexOf(sharedState.music.playMode);\\n  // 切换顺序: 列表 -> 随机 -> 单曲 -> 列表\\n  const nextIdx = (currentIdx + 1) % modes.length;\\n  sharedState.music.playMode = modes[nextIdx];\\n}\\n\\n// ------【新增：自动播放监听】------\\nfunction onAudioEnded() {\\n  if (sharedState.music.playMode === \\'single\\') {\\n    // Повтор трека：重播\\n    musicAudio.currentTime = 0;\\n    musicAudio.play().catch(e => console.error(\"Replay error\", e));\\n  } else {\\n    // 列表或随机：下一首\\n    controlAction(null, \\'next\\');\\n  }\\n}\\nfunction togglePlaylistView(e: Event) {\\n  e.stopPropagation();\\n  showPlaylist.value = !showPlaylist.value;\\n}\\n\\nasync function handleSearch() {\\n  if (!searchKeyword.value.trim()) return;\\n\\n  try {\\n    const keyword = searchKeyword.value.trim();\\n    const newSong = { song: keyword, source: \\'user\\' };\\n\\n    sharedState.music.userList.push({ song: keyword });\\n    sharedState.music.saveUserList();\\n    sharedState.music.list.push(newSong);\\n\\n    searchKeyword.value = \\'\\';\\n\\n    const wasEmpty = sharedState.music.index === -1;\\n    const newIndex = sharedState.music.list.length - 1;\\n\\n    sharedState.music.index = newIndex;\\n\\n    if (!wasEmpty) {\\n       await controlAction(null, \\'play\\');\\n    }\\n  } catch (e) {\\n    console.warn(\"Search/Play error:\", e);\\n  }\\n}\\n\\n// 【修改】添加 $event 参数并阻止冒泡\\nfunction playFromList(index: number, e?: Event) {\\n  if (e) e.stopPropagation();\\n  sharedState.music.index = index;\\n  controlAction(null, \\'play\\');\\n}\\n\\nfunction removeFromList(index: number, e: Event) {\\n  e.stopPropagation();\\n  const targetSong = sharedState.music.list[index];\\n  sharedState.music.list.splice(index, 1);\\n\\n  if (sharedState.music.index >= sharedState.music.list.length) {\\n    sharedState.music.index = Math.max(0, sharedState.music.list.length - 1);\\n  }\\n\\n  if (targetSong && targetSong.source === \\'user\\') {\\n    const userIndex = sharedState.music.userList.findIndex(\\n        (u: any) => u.song === targetSong.song\\n    );\\n    if (userIndex !== -1) {\\n       sharedState.music.userList.splice(userIndex, 1);\\n       sharedState.music.saveUserList();\\n    }\\n  }\\n}\\n\\n\\n// ------------ 头像上传 ------------\\nfunction triggerUpload() {\\n  fileInput.value?.click();\\n}\\n\\nfunction handleAvatarUpload(event: Event) {\\n  const input = event.target as HTMLInputElement;\\n  if (input.files && input.files[0]) {\\n    const file = input.files[0];\\n    const reader = new FileReader();\\n    reader.onload = (e) => {\\n      if (e.target?.result) {\\n        const base64 = e.target.result as string;\\n        customAvatar.value = base64;\\n        localStorage.setItem(\\'myPixelAvatar\\', base64);\\n      }\\n    };\\n    reader.readAsDataURL(file);\\n  }\\n}\\n\\n// ------------ 动画逻辑 ------------\\nfunction runAnimationLoop() {\\n  clearTimeout(animTimer);\\n  const frames = isPlaying.value ? runFrames : idleFrames;\\n\\n  let newIndex = Math.floor(Math.random() * frames.length);\\n  animFrame.value = frames[newIndex];\\n\\n  const speed = isPlaying.value ? 400 : 1500;\\n  animTimer = setTimeout(runAnimationLoop, speed);\\n}\\n\\nonMounted(() => {\\n  runAnimationLoop();\\n  musicAudio.addEventListener(\\'ended\\', onAudioEnded);\\n  sharedState.music.initUserList();\\n  if (sharedState.music.list.length === 0) {\\n      sharedState.music.getAllChatMessages();\\n  }\\n\\n  const saved = localStorage.getItem(\\'myPixelAvatar\\');\\n  if (saved) {\\n    customAvatar.value = saved;\\n  }\\n  if (widget.value) {\\n    widget.value.addEventListener(\\'touchmove\\', e => { if (isDragging.value && !isRightClick.value) e.preventDefault(); }, { passive: false });\\n  }\\n\\n  try {\\n    $(\\'body\\').on(\\'visibilitychange\\', onVisibilityChange);\\n    $(\\'body\\').on(\\'click\\', onDocumentClick);\\n    $(\\'body\\').on(\\'keydown\\', onKeyDown);\\n  } catch(e) { console.warn(\\'jQuery error\\'); }\\n\\n  window.addEventListener(\\'resize\\', onResize);\\n  restorePosition();\\n  musicAudio.addEventListener(\\'timeupdate\\', onTimeUpdate);\\n});\\n\\n// ------------ 播放器逻辑 ------------\\nconst parsedLyrics = ref<{ time: number; text: string }[]>([]);\\nconst currentLyricIndex = ref(-1);\\nconst hasStarted = ref(false);\\nconst playingIndex = ref(-1);\\nconst musicAudio = new Audio();\\n\\nmusicAudio.volume = volume.value / 100;\\nwatch(volume, newVal => {\\n  musicAudio.volume = newVal / 100;\\n});\\nconst Music = (globalThis as any).Music;\\n\\nwatch(isPlaying, (newVal) => {\\n  runAnimationLoop();\\n});\\n\\nwatch(\\n  () => sharedState.music.index,\\n  (newVal, oldVal) => {\\n    if (oldVal == -1 && newVal > -1) {\\n      controlAction(null, \\'play\\');\\n    }\\n  },\\n);\\n\\nfunction parseLyricToTimeline(lyric: string) {\\n  const lines = lyric.split(/\\\\r?\\\\n/);\\n  const entries: { time: number; text: string }[] = [];\\n  for (const line of lines) {\\n    const timeTags = line.match(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/g);\\n    const text = line.replace(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/g, \\'\\').trim();\\n    if (!timeTags || !text) continue;\\n    for (const tag of timeTags) {\\n      const match = tag.match(/\\\\[(\\\\d{1,2}):(\\\\d{2})(?:\\\\.(\\\\d{1,3}))?\\\\]/);\\n      if (!match) continue;\\n      const minutes = Number(match[1]);\\n      const seconds = Number(match[2]);\\n      const millis = match[3] ? Number(match[3].padEnd(3, \\'0\\')) : 0;\\n      const time = minutes * 60 + seconds + millis / 1000;\\n      entries.push({ time, text });\\n    }\\n  }\\n  entries.sort((a, b) => a.time - b.time);\\n  return entries;\\n}\\n\\nfunction updateLyricDisplayByTime(currentTime: number) {\\n  const list = parsedLyrics.value;\\n  if (!list.length) {\\n    currentLine.value = \\'\\';\\n    nextLine.value = \\'\\';\\n    currentLyricIndex.value = -1;\\n    return;\\n  }\\n  let idx = list.length - 1;\\n  for (let i = 0; i < list.length; i++) {\\n    if (currentTime < list[i].time) {\\n      idx = i - 1;\\n      break;\\n    }\\n  }\\n  if (idx < 0) {\\n    currentLine.value = \\'\\';\\n    nextLine.value = list[0]?.text ?? \\'\\';\\n    currentLyricIndex.value = -1;\\n    return;\\n  }\\n  if (idx !== currentLyricIndex.value) {\\n    currentLyricIndex.value = idx;\\n    currentLine.value = list[idx]?.text ?? \\'\\';\\n    nextLine.value = list[idx + 1]?.text ?? \\'\\';\\n  }\\n}\\n\\nfunction onTimeUpdate() {\\n  updateLyricDisplayByTime(musicAudio.currentTime || 0);\\n  const cur = musicAudio.currentTime || 0;\\n  const dur = musicAudio.duration || 1;\\n  progress.value = (cur / dur) * 100;\\n}\\n\\n// ------【修改：ControlAction 下一首/上一首逻辑】------\\n// 完全替换现有的 controlAction 函数\\nasync function controlAction(event: any, action: any) {\\n  event?.stopPropagation();\\n  startHideTimer();\\n\\n  try {\\n    if (action == \\'stop\\') {\\n      musicAudio.pause();\\n      isPlaying.value = false;\\n      return;\\n    }\\n\\n    let index = sharedState.music.index;\\n    const listLen = sharedState.music.list.length;\\n    if (listLen === 0) return;\\n    if (index == -1) index = 0;\\n\\n    if (action == \\'play\\') {\\n      const canResume = hasStarted.value && playingIndex.value === index && musicAudio.src;\\n      if (!isPlaying.value && canResume) {\\n        musicAudio.play();\\n        isPlaying.value = true;\\n        return;\\n      }\\n      await PlayMusic(index);\\n    }\\n\\n    if (action == \\'prev\\') {\\n      // 上一首通常按列表顺序，符合直觉\\n      if (index > 0) index -= 1;\\n      else index = listLen - 1;\\n      sharedState.music.index = index;\\n      await PlayMusic(index);\\n    }\\n\\n    if (action == \\'next\\') {\\n      if (sharedState.music.playMode === \\'random\\') {\\n        // --- 随机算法 ---\\n        if (listLen > 1) {\\n             let newIndex = index;\\n             // 简单的防重随机\\n             let attempts = 0;\\n             while (newIndex === index && attempts < 5) {\\n                 newIndex = Math.floor(Math.random() * listLen);\\n                 attempts++;\\n             }\\n             index = newIndex;\\n        }\\n      } else {\\n        // --- 列表/Повтор трека (切歌强制下一首) ---\\n        if (index >= listLen - 1) index = 0;\\n        else index += 1;\\n      }\\n\\n      sharedState.music.index = index;\\n      await PlayMusic(index);\\n    }\\n  } catch (err: any) {\\n    console.error(\"Play control error:\", err);\\n    // 错误处理保持不变...\\n    if (err.message && err.message.includes(\\'Extension context invalidated\\')) {\\n      currentLine.value = \"Нужно обновить!\";\\n      nextLine.value = \"Плагин обновлён\";\\n    }\\n  }\\n}\\n\\n\\n// ------【新增：进度条拖动逻辑】------\\nfunction handleSeek(e: Event) {\\n  const target = e.target as HTMLInputElement;\\n  const val = Number(target.value);\\n\\n  // 1. 立即更新视觉进度，防止滑动卡顿\\n  progress.value = val;\\n\\n  // 2. 计算并设置音频时间\\n  if (musicAudio && musicAudio.duration) {\\n    const newTime = (val / 100) * musicAudio.duration;\\n    // 检查是否为有效数字\\n    if (isFinite(newTime)) {\\n      musicAudio.currentTime = newTime;\\n    }\\n  }\\n}\\n\\n\\nasync function PlayMusic(index: number) {\\n  try {\\n    const song = sharedState.music.list[index];\\n    const name = song.song;\\n    let playUrl = \\'\\';\\n    const cached = sharedState.music.cache[name];\\n    const cachedMeta = cached && typeof cached === \\'object\\' ? cached : null;\\n\\n    if (cached) {\\n      const cachedUrl = typeof cached === \\'string\\' ? cached : cached.Url;\\n      if (cachedUrl) {\\n        const available = await sharedState.music.checkAudioAvailability(cachedUrl);\\n        if (available) {\\n          playUrl = cachedUrl;\\n          if (cachedMeta) {\\n            updateMeta(cachedMeta);\\n          }\\n        }\\n      }\\n    }\\n\\n    let fetchedMeta: any = null;\\n    if (!playUrl) {\\n      currentLine.value = \\'Поиск...\\';\\n      nextLine.value = \\'Подождите\\';\\n      const result = await Music.SearchMusic(name);\\n      if (!result?.Url) {\\n        currentLine.value = \\'Ошибка\\';\\n        nextLine.value = \\'Повторить?\\';\\n        return;\\n      }\\n      playUrl = result.Url;\\n      fetchedMeta = result;\\n      sharedState.music.cache[name] = result;\\n    }\\n\\n    if (playUrl != musicAudio.src) {\\n      musicAudio.src = playUrl;\\n    }\\n\\n    const meta = fetchedMeta || cachedMeta;\\n    if (meta) {\\n      updateMeta(meta);\\n    }\\n\\n    if (currentLyricStr.value) {\\n      parsedLyrics.value = parseLyricToTimeline(currentLyricStr.value || \\'\\');\\n      currentLyricIndex.value = -1;\\n      updateLyricDisplayByTime(0);\\n    }\\n\\n    musicAudio.play();\\n    isPlaying.value = true;\\n    hasStarted.value = true;\\n    playingIndex.value = index;\\n  } catch (err: any) {\\n    console.error(\"PlayMusic Ошибка:\", err);\\n    isPlaying.value = false;\\n    if (err.message && err.message.includes(\\'Extension context invalidated\\')) {\\n      currentLine.value = \"Перезагрузить\";\\n      nextLine.value = \"Plugin Ошибка\";\\n    }\\n  }\\n}\\n\\nfunction updateMeta(meta: any) {\\n  currentSinger.value = meta.Singer;\\n  currentSong.value = meta.Name;\\n  currentLyricStr.value = meta.Lyric;\\n  currentSongCoverUrl.value = meta.Cover || meta.Pic || \\'\\';\\n}\\n\\n// ------------ 拖拽逻辑 ------------\\nconst widget = ref<HTMLElement | null>(null);\\nlet startX = 0, startY = 0, initialX = 0, initialY = 0;\\nconst dragX = ref(`50%`);\\nconst dragY = ref(`20%`);\\nlet hideTimer: any = null;\\nconst isDragging = ref(false);\\nconst hasMovedWhileDragging = ref(false);\\nconst isRightClick = ref(false);\\nconst windowWidth = $(\\'body\\').width() || 0;\\nconst windowHeight = $(\\'body\\').height() || 0;\\nconst isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\\n\\nfunction startHideTimer() {\\n  clearTimeout(hideTimer);\\n}\\n\\nfunction startDrag(e: any) {\\n  const el = widget.value;\\n  if (!el) return;\\n  if (e.button === 2 || e.which === 3) {\\n    isRightClick.value = true;\\n    return;\\n  }\\n\\n  if (e.target.tagName === \\'INPUT\\' ||\\n      e.target.closest(\\'.add-btn\\') ||\\n      e.target.closest(\\'.list-item\\') ||\\n      e.target.closest(\\'.del-btn\\')) {\\n    return;\\n  }\\n\\n  if (e.target.closest(\\'.volume-control\\') || e.target.closest(\\'.d-btn\\') || e.target.closest(\\'.shrink-btn\\')) return;\\n  if (isMobile && e.target && e.target.closest && e.target.closest(\\'.bottom-controls\\')) return;\\n  if (e.target.closest(\\'.avatar-box\\') && !el.classList.contains(\\'collapsed-view\\')) return;\\n\\n  isRightClick.value = false;\\n  isDragging.value = true;\\n  hasMovedWhileDragging.value = false;\\n  el.classList.add(\\'dragging\\');\\n  clearTimeout(hideTimer);\\n  const rect = el.getBoundingClientRect();\\n  initialX = rect.left + rect.width / 2;\\n  initialY = rect.top + rect.height / 2;\\n\\n  if (e.type === \\'mousedown\\') {\\n    startX = e.clientX;\\n    startY = e.clientY;\\n    $(\\'body\\').on(\\'mousemove\\', drag);\\n    $(\\'body\\').on(\\'mouseup\\', stopDrag);\\n  } else if (e.type === \\'touchstart\\') {\\n    startX = e.touches[0].clientX;\\n    startY = e.touches[0].clientY;\\n    $(\\'body\\').on(\\'touchmove\\', drag);\\n    $(\\'body\\').on(\\'touchend\\', stopDrag);\\n  }\\n}\\n\\nfunction drag(e: any) {\\n  if (!isDragging.value || isRightClick.value) return;\\n  if (e && typeof e.preventDefault === \\'function\\') e.preventDefault();\\n  hasMovedWhileDragging.value = true;\\n  let clientX, clientY;\\n  if (e.type === \\'mousemove\\') {\\n    clientX = e.clientX;\\n    clientY = e.clientY;\\n  } else if (e.type === \\'touchmove\\') {\\n    clientX = e.touches[0].clientX;\\n    clientY = e.touches[0].clientY;\\n  }\\n  const deltaX = clientX - startX;\\n  const deltaY = clientY - startY;\\n  const newX = initialX + deltaX;\\n  const newY = initialY + deltaY;\\n  const margin = 20;\\n  const maxX = windowWidth - margin;\\n  const maxY = windowHeight - margin;\\n  const clampedX = Math.max(margin, Math.min(maxX, newX));\\n  const clampedY = Math.max(margin, Math.min(maxY, newY));\\n  if (newX !== clampedX || newY !== clampedY) widget.value!.classList.add(\\'near-boundary\\');\\n  else widget.value!.classList.remove(\\'near-boundary\\');\\n  dragX.value = `${newX}px`;\\n  dragY.value = `${newY}px`;\\n  widget.value!.style.transform = \\'translate(-50%, -50%) scale(1.02)\\';\\n}\\n\\nfunction stopDrag(e: any) {\\n  if (!isDragging.value && !isRightClick.value) return;\\n  $(\\'body\\').off(\\'mousemove\\', drag);\\n  $(\\'body\\').off(\\'mouseup\\', stopDrag);\\n  $(\\'body\\').off(\\'touchmove\\', drag);\\n  $(\\'body\\').off(\\'touchend\\', stopDrag);\\n\\n  if (isRightClick.value) {\\n    isRightClick.value = false;\\n    return;\\n  }\\n  const el = widget.value;\\n  isDragging.value = false;\\n  el && el.classList.remove(\\'dragging\\', \\'near-boundary\\');\\n  const currentTransform = el ? el.style.transform : \\'\\';\\n  if (currentTransform && currentTransform.includes(\\'scale(1.02)\\')) {\\n    el!.style.transform = currentTransform.replace(\\'scale(1.02)\\', \\'\\');\\n  }\\n\\n  if (hasMovedWhileDragging.value) {\\n    savePosition();\\n  } else {\\n    setTimeout(() => {\\n       // 【核心修改】检查变量状态\\n       if (isExpanded.value) {\\n         return;\\n       }\\n\\n       if (e && e.target && e.target.closest) {\\n         if (e.target.closest(\\'.bottom-controls\\') ||\\n             e.target.closest(\\'.volume-control\\') ||\\n             e.target.closest(\\'.avatar-box\\') ||\\n             e.target.closest(\\'.shrink-btn\\') ||\\n             e.target.closest(\\'.rpg-header\\')) {\\n           return;\\n         }\\n       }\\n       toggleExpand(e);\\n    }, 50);\\n  }\\n  hasMovedWhileDragging.value = false;\\n}\\n\\nfunction savePosition() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const rect = el.getBoundingClientRect();\\n  const position = {\\n    x: ((rect.left + rect.width / 2) / windowWidth) * 100,\\n    y: ((rect.top + rect.height / 2) / windowHeight) * 100,\\n  };\\n  localStorage.setItem(\\'lyricsWidgetPosition\\', JSON.stringify(position));\\n}\\n\\nfunction restorePosition() {\\n  const el = widget.value;\\n  if (!el) return;\\n  const saved = localStorage.getItem(\\'lyricsWidgetPosition\\');\\n  if (saved) {\\n    const position = JSON.parse(saved);\\n    let x = `50`;\\n    if (position.x < 100 && position.x > 0) x = position.x;\\n    let y = `20`;\\n    if (position.y < 100 && position.y > 0) y = position.y;\\n    el.style.left = x + \\'%\\';\\n    el.style.top = y + \\'%\\';\\n  }\\n}\\n\\n// 【修改】使用变量切换\\nfunction toggleExpand(event: any) {\\n  if (isDragging.value || hasMovedWhileDragging.value || isRightClick.value) return;\\n  if (event && event.target && event.target.closest) {\\n    if(event.target.closest(\\'.bottom-controls\\') || event.target.closest(\\'.volume-control\\') || event.target.closest(\\'.avatar-box\\')) return;\\n  }\\n  if (event && (event.button === 2 || event.which === 3)) return;\\n\\n  // 仅修改变量\\n  isExpanded.value = !isExpanded.value;\\n}\\n\\nfunction onContextMenu(e: any) {\\n  isRightClick.value = true;\\n}\\n\\nfunction onMouseEnter() { if (!isMobile) clearTimeout(hideTimer); }\\nfunction onMouseLeave() { }\\nfunction onTouchEnd() { if (isMobile) clearTimeout(hideTimer); }\\nfunction onResize() { restorePosition(); }\\nfunction onVisibilityChange() {}\\nfunction onDocumentClick(e: any) {\\n  if (isRightClick.value && !(e.target && e.target.closest && e.target.closest(\\'.lyrics-widget\\'))) {\\n    isRightClick.value = false;\\n  }\\n}\\n\\n// 【修改】ESC 关闭\\nfunction onKeyDown(e: any) {\\n  if (e.key === \\'Escape\\') {\\n    isRightClick.value = false;\\n    isExpanded.value = false;\\n  }\\n}\\n\\nonBeforeUnmount(() => {\\n  clearTimeout(hideTimer);\\n  clearTimeout(animTimer);\\n   musicAudio.removeEventListener(\\'ended\\', onAudioEnded);\\n  $(\\'body\\').off(\\'mousemove\\', drag);\\n  $(\\'body\\').off(\\'mouseup\\', stopDrag);\\n  $(\\'body\\').off(\\'touchmove\\', drag);\\n  $(\\'body\\').off(\\'touchend\\', stopDrag);\\n  $(\\'body\\').off(\\'visibilitychange\\', onVisibilityChange);\\n  $(\\'body\\').off(\\'click\\', onDocumentClick);\\n  $(\\'body\\').off(\\'keydown\\', onKeyDown);\\n  window.removeEventListener(\\'resize\\', onResize);\\n  musicAudio.removeEventListener(\\'timeupdate\\', onTimeUpdate);\\n});\\n<\\/script>\\n\\n<style scoped>\\n/* 样式部分不需要任何修改，直接沿用即可 */\\n@import url(\\'https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&family=Press+Start+2P&family=Varela+Round&display=swap\\');\\n\\n.pixel-font {\\n  font-family: \\'Press Start 2P\\', cursive !important;\\n}\\n\\n.lyrics-widget {\\n  position: absolute;\\n  top: 20%;\\n  left: 50%;\\n  transform: translate(-50%, -50%);\\n  z-index: 9999999;\\n  user-select: none;\\n  font-family: \\'Varela Round\\', sans-serif;\\n  transition: transform 0.2s;\\n}\\n\\n.lyrics-widget.dragging {\\n  cursor: grabbing;\\n  opacity: 0.95;\\n  transition: none;\\n}\\n\\n.collapsed-view {\\n  position: relative;\\n  width: 140px;\\n  height: auto;\\n  cursor: pointer;\\n  filter: drop-shadow(0 5px 10px rgba(255, 182, 193, 0.4));\\n  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\\n}\\n\\n.collapsed-view:hover {\\n  transform: scale(1.1) rotate(-3deg);\\n}\\n\\n.console-frame {\\n  position: relative;\\n  z-index: 2;\\n  width: 100%;\\n  pointer-events: none;\\n}\\n\\n.screen-content {\\n  position: absolute;\\n  z-index: 1;\\n  top: 21%;\\n  left: 18%;\\n  width: 65%;\\n  height: 54%;\\n  transform: rotate(8.5deg);\\n  overflow: hidden;\\n  background: #fff0f5;\\n  border-radius: 4px;\\n}\\n\\n.fill-img {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n}\\n\\n.lyrics-widget.expanded .collapsed-view {\\n  display: none;\\n}\\n\\n.expanded-view {\\n  display: none;\\n  width: 380px;\\n  background: rgba(255, 245, 247, 0.85);\\n  backdrop-filter: blur(10px);\\n  border: 4px solid #ffffff;\\n  border-radius: 24px;\\n  padding: 18px;\\n  box-shadow:\\n    0 10px 30px rgba(255, 160, 175, 0.25),\\n    inset 0 0 20px rgba(255, 255, 255, 0.8);\\n  animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);\\n  color: #ff7675;\\n}\\n\\n@keyframes popIn {\\n  from { opacity: 0; transform: scale(0.95) translateY(5px); }\\n  to { opacity: 1; transform: scale(1) translateY(0); }\\n}\\n\\n.lyrics-widget.expanded .expanded-view {\\n  display: flex;\\n  flex-direction: column;\\n  gap: 14px;\\n}\\n\\n.rpg-header {\\n  display: flex;\\n  align-items: center;\\n  gap: 14px;\\n  background: rgba(255,255,255,0.6);\\n  padding: 8px 12px;\\n  border-radius: 18px;\\n  box-shadow: 0 2px 5px rgba(255, 182, 193, 0.1);\\n}\\n\\n.avatar-box {\\n  flex-shrink: 0;\\n  width: 90px;\\n  height: 60px;\\n  border-radius: 14px;\\n  border: 4px solid #fff;\\n  box-shadow: 0 4px 8px rgba(255, 182, 193, 0.3);\\n  position: relative;\\n  cursor: pointer;\\n  overflow: hidden;\\n  transition: transform 0.2s;\\n  background: #ffe4e1;\\n}\\n\\n.avatar-box:hover { transform: scale(1.03); }\\n\\n.rect-avatar {\\n  width: 100%;\\n  height: 100%;\\n  object-fit: cover;\\n}\\n\\n.upload-hint {\\n  position: absolute;\\n  top: 50%; left: 50%;\\n  transform: translate(-50%, -50%);\\n  color: #fff;\\n  font-size: 16px;\\n  text-shadow: 0 1px 3px rgba(0,0,0,0.1);\\n  opacity: 0;\\n  transition: opacity 0.2s;\\n  pointer-events: none;\\n}\\n.avatar-box:hover .upload-hint { opacity: 1; }\\n\\n.status-panel {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  gap: 6px;\\n}\\n\\n.name-badge {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  color: #ff8fa3;\\n  font-weight: 800;\\n}\\n.p-name { font-size: 12px; letter-spacing: 0.5px; }\\n\\n.lvl-txt {\\n  background: #fff;\\n  color: #ffaa91;\\n  padding: 1px 8px;\\n  border-radius: 10px;\\n  font-size: 9px;\\n  font-weight: bold;\\n  box-shadow: 0 2px 0 rgba(255, 170, 145, 0.2);\\n}\\n\\n.bar-container {\\n  display: flex;\\n  align-items: center;\\n  gap: 6px;\\n}\\n.bar-track {\\n  flex: 1;\\n  height: 8px;\\n  background: #fff;\\n  border-radius: 10px;\\n  border: 1px solid #ffeef0;\\n}\\n.bar-fill { height: 100%; border-radius: 10px; }\\n.hp-fill { background: #ffb7b2; }\\n.mp-fill { background: #a2dfe3; }\\n\\n.bar-icon { font-size: 10px; width: 14px; text-align: center; }\\n.red-icon { color: #ffb7b2; }\\n.yellow-icon { color: #ffeaa7; }\\n\\n.game-screen-wrapper {\\n  position: relative;\\n  border: 4px solid #ffe4e1;\\n  border-radius: 16px;\\n  height: 120px;\\n  cursor: pointer;\\n  overflow: hidden;\\n  background: #fff;\\n}\\n\\n.game-screen {\\n  padding: 10px;\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: space-between;\\n  position: relative;\\n  z-index: 1;\\n  background: linear-gradient(180deg, #fff5f7 0%, #ffe3e8 100%);\\n  background-image:\\n    linear-gradient(#fff 1px, transparent 1px),\\n    linear-gradient(90deg, #fff 1px, transparent 1px);\\n  background-size: 14px 14px;\\n}\\n\\n.screen-ui-top {\\n  display: flex;\\n  justify-content: space-between;\\n  font-size: 9px;\\n  color: #ffb7b2;\\n}\\n\\n.scene-stage {\\n  height: 25px;\\n  position: relative;\\n  border-top: 2px dashed #ffc1c1;\\n}\\n\\n.character-sprite {\\n  position: absolute;\\n  bottom: 2px;\\n  left: 50%;\\n  transform: translateX(-50%);\\n  font-size: 14px;\\n  color: #ff6b81;\\n  white-space: nowrap;\\n  font-weight: 600;\\n}\\n.character-sprite.running { animation: float 0.6s infinite ease-in-out alternate; }\\n@keyframes float {\\n  from { transform: translateX(-50%) translateY(0); }\\n  to { transform: translateX(-50%) translateY(-4px); }\\n}\\n\\n.screen-overlay {\\n  position: absolute;\\n  top: 0; left: 0; width: 100%; height: 60%;\\n  background: linear-gradient(rgba(255,255,255,0.5), rgba(255,255,255,0));\\n  pointer-events: none;\\n  z-index: 2;\\n  border-radius: 10px;\\n}\\n\\n.controls-pad {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  margin-top: 8px;\\n  padding: 0 10px;\\n}\\n\\n.pad-left { display: flex; gap: 14px; }\\n\\n.d-btn {\\n  border: none;\\n  width: 36px; height: 36px;\\n  border-radius: 14px;\\n  background: #fff;\\n  color: #ff8fa3;\\n  font-size: 14px;\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  transition: all 0.2s;\\n  box-shadow: 0 4px 8px rgba(255, 182, 193, 0.25);\\n}\\n\\n.d-btn:active {\\n  transform: scale(0.9);\\n}\\n\\n.d-btn.play {\\n  background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);\\n  color: #fff;\\n  box-shadow: 0 4px 10px rgba(255, 154, 158, 0.4);\\n}\\n\\n.pad-right {\\n  display: flex;\\n  align-items: center;\\n  width: 100px;\\n}\\n\\n.volume-slider {\\n  -webkit-appearance: none !important;\\n  background: transparent !important;\\n  width: 100% !important;\\n  cursor: pointer !important;\\n}\\n\\n.volume-slider::-webkit-slider-runnable-track {\\n  height: 8px;\\n  width: 100%;\\n  background: #fff;\\n  border-radius: 4px;\\n  border: 1px solid #ffe4e1 !important;\\n  background-image: linear-gradient(#ff9a9e, #ff9a9e);\\n  background-size: var(--volume-fill, 0%) 100%;\\n  background-repeat: no-repeat;\\n}\\n\\n.volume-slider::-webkit-slider-thumb {\\n  -webkit-appearance: none !important;\\n  height: 16px !important;\\n  width: 16px !important;\\n  background: #fff !important;\\n  border: 2px solid #ff9a9e !important;\\n  border-radius: 50% !important;\\n  margin-top: -5px !important;\\n  box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;\\n}\\n\\n.screen-view-anim {\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: space-between;\\n}\\n\\n.screen-view-list {\\n  height: 100%;\\n  display: flex;\\n  flex-direction: column;\\n  gap: 6px;\\n  overflow: hidden;\\n}\\n\\n.search-bar {\\n  display: flex;\\n  gap: 6px;\\n  height: 24px;\\n}\\n\\n.pixel-input {\\n  flex: 1;\\n  background: rgba(255, 255, 255, 0.8);\\n  border: 2px solid #ffb7b2;\\n  border-radius: 8px;\\n  padding: 0 8px;\\n  font-family: \\'Varela Round\\', sans-serif;\\n  font-size: 10px;\\n  color: #ff6b81;\\n  outline: none;\\n}\\n.pixel-input::placeholder { color: #ffcdc9; }\\n\\n.add-btn {\\n  width: 24px;\\n  border: none;\\n  background: #ffb7b2;\\n  color: #fff;\\n  border-radius: 6px;\\n  cursor: pointer;\\n  font-weight: bold;\\n  line-height: 1;\\n}\\n.add-btn:hover { background: #ff9a9e; }\\n\\n.list-container {\\n  flex: 1;\\n  overflow-y: auto;\\n  padding-right: 4px;\\n}\\n\\n.list-item {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center;\\n  font-size: 11px;\\n  color: #ff8fa3;\\n  padding: 3px 6px;\\n  border-radius: 6px;\\n  cursor: pointer;\\n  margin-bottom: 2px;\\n  transition: background 0.2s;\\n}\\n\\n.list-item:hover {\\n  background: rgba(255, 183, 178, 0.2);\\n}\\n\\n.list-item.active {\\n  background: #ffb7b2;\\n  color: #fff;\\n  font-weight: bold;\\n}\\n\\n.song-txt {\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  max-width: 85%;\\n}\\n\\n.del-btn {\\n  font-size: 9px;\\n  opacity: 0.6;\\n  padding: 2px;\\n}\\n.del-btn:hover { opacity: 1; color: #ff4757; }\\n\\n.empty-tip {\\n  text-align: center;\\n  color: #ffcdc9;\\n  font-size: 10px;\\n  margin-top: 20px;\\n  font-family: \\'Press Start 2P\\', cursive;\\n}\\n\\n.custom-scroll::-webkit-scrollbar { width: 4px; }\\n.custom-scroll::-webkit-scrollbar-track { background: transparent; }\\n.custom-scroll::-webkit-scrollbar-thumb {\\n  background: #ffe3e8;\\n  border-radius: 4px;\\n}\\n.custom-scroll::-webkit-scrollbar-thumb:hover { background: #ffb7b2; }\\n\\n.menu-btn.active {\\n  background: #ffb7b2;\\n  color: #fff;\\n}\\n\\n.screen-lyrics-box {\\n  flex: 1;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  align-items: center;\\n  text-align: center;\\n  margin-top: -5px;\\n  padding: 0 4px;\\n  overflow: hidden;\\n}\\n\\n.s-lyric-cur {\\n  font-size: 13px;\\n  font-weight: 800;\\n  color: #ff6b81;\\n  line-height: 1.2;\\n  margin-bottom: 4px;\\n  text-shadow: 1px 1px 0 #fff;\\n  display: -webkit-box;\\n  -webkit-line-clamp: 2;\\n  -webkit-box-orient: vertical;\\n  overflow: hidden;\\n}\\n\\n.s-lyric-next {\\n  font-size: 10px;\\n  color: #ffb7b2;\\n  white-space: nowrap;\\n  opacity: 0.8;\\n  max-width: 100%;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n}\\n\\n.info-card {\\n  background: rgba(255,255,255,0.6);\\n  border: 1px solid #fff;\\n  border-radius: 16px;\\n  padding: 8px 12px;\\n  text-align: center;\\n  min-height: 55px;\\n  display: flex;\\n  flex-direction: column;\\n  justify-content: center;\\n  align-items: center;\\n  box-shadow: 0 4px 10px rgba(255, 182, 193, 0.15);\\n}\\n\\n.song-title {\\n  color: #ff6b81;\\n  font-family: \\'Press Start 2P\\', cursive;\\n  font-size: 15px;\\n  line-height: 1.6;\\n  margin-bottom: 6px;\\n  text-shadow: 2px 2px 0 rgba(255, 182, 193, 0.6);\\n  max-width: 100%;\\n  white-space: nowrap;\\n  overflow: hidden;\\n  text-overflow: ellipsis;\\n  letter-spacing: 1px;\\n}\\n\\n.song-artist {\\n  color: #ffaa91;\\n  font-size: 11px;\\n  font-weight: 600;\\n}\\n\\n.shrink-btn {\\n  width: 28px;\\n  height: 28px;\\n  border-radius: 50%;\\n  margin-left: 4px;\\n  flex-shrink: 0;\\n  background: #ffe4e1;\\n  color: #ff8fa3;\\n  border: none;\\n  display: flex;\\n  align-items: center;\\n  justify-content: center;\\n  cursor: pointer;\\n  transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);\\n  box-shadow: 0 2px 5px rgba(255, 182, 193, 0.3);\\n}\\n\\n.shrink-btn:hover {\\n  transform: scale(1.15) rotate(90deg);\\n  background: #ffb7b2;\\n  color: #fff;\\n  box-shadow: 0 4px 8px rgba(255, 182, 193, 0.5);\\n}\\n\\n.shrink-btn:active {\\n  transform: scale(0.95);\\n}\\n\\n.shrink-btn i {\\n  font-size: 14px;\\n}\\n/* musicPlayer.vue 的 style 部分 */\\n\\n/* musicPlayer.vue 的 style 部分 */\\n\\n/* 屏幕顶部的 HUD 模式切换器 */\\n.hud-mode-switch {\\n  cursor: pointer;\\n  display: flex;\\n  align-items: center;\\n  gap: 4px;\\n  padding: 0 2px;\\n  border-radius: 4px;\\n  transition: all 0.1s;\\n  user-select: none;\\n}\\n\\n/* 鼠标悬停时，文字变色，增加互动感 */\\n.hud-mode-switch:hover {\\n  color: #ff6b81; /* 深粉色高亮 */\\n  background: rgba(255, 255, 255, 0.5);\\n  text-shadow: 1px 1px 0 rgba(255, 230, 230, 0.8);\\n}\\n\\n/* 点击时的按压效果 */\\n.hud-mode-switch:active {\\n  transform: translateY(1px);\\n}\\n\\n/* 那个像素小箭头 */\\n.blink-arrow {\\n  font-size: 8px;\\n  animation: blink-anim 1s steps(2, start) infinite;\\n  opacity: 0.8;\\n}\\n\\n/* 闪烁动画，非常有复古游戏感 */\\n@keyframes blink-anim {\\n  to { visibility: hidden; }\\n}\\n\\n/* 稍微调整一下 top ui 的布局，让它对齐更好 */\\n.screen-ui-top {\\n  display: flex;\\n  justify-content: space-between;\\n  align-items: center; /* 确保垂直居中 */\\n  font-size: 9px;\\n  color: #ffb7b2;\\n  margin-bottom: 2px; /* 稍微留点空隙给下方歌词 */\\n}\\n/* ------【新增：进度条滑块样式】------ */\\n.progress-slider {\\n  -webkit-appearance: none !important;\\n  background: transparent !important;\\n  width: 100% !important;\\n  height: 100% !important;\\n  cursor: pointer !important;\\n  display: block;\\n  margin: 0;\\n  padding: 0;\\n}\\n\\n/* 滑动轨道（背景条） */\\n.progress-slider::-webkit-slider-runnable-track {\\n  height: 8px; /* 保持和你原来的条一样高 */\\n  width: 100%;\\n  background: #fff; /* 背景底色 */\\n  border-radius: 10px;\\n  border: 1px solid #ffeef0 !important;\\n\\n  /* 动态填充颜色：MP条的颜色 #a2dfe3 */\\n  background-image: linear-gradient(#a2dfe3, #a2dfe3);\\n  background-size: var(--progress-fill, 0%) 100%;\\n  background-repeat: no-repeat;\\n}\\n\\n/* 滑块圆钮（默认隐藏，看着像进度条，拖动时才感觉像滑块） */\\n.progress-slider::-webkit-slider-thumb {\\n  -webkit-appearance: none !important;\\n  height: 12px;\\n  width: 12px;\\n  background: #fff;\\n  border: 2px solid #a2dfe3;\\n  border-radius: 50%;\\n  margin-top: -3px; /* 垂直居中微调 */\\n  box-shadow: 0 1px 3px rgba(0,0,0,0.1);\\n  transition: transform 0.1s;\\n}\\n\\n/* 鼠标悬停或拖动时，滑块稍微变大一点，增加交互感 */\\n.progress-slider:active::-webkit-slider-thumb,\\n.progress-slider:hover::-webkit-slider-thumb {\\n  transform: scale(1.2);\\n}\\n/* 1. 基础状态：添加贝塞尔曲线过渡，让动画有弹力感 */\\n.collapsed-view {\\n  position: relative;\\n  width: 140px;\\n  height: auto;\\n  cursor: pointer;\\n  /* 初始阴影 */\\n  filter: drop-shadow(0 5px 5px rgba(0, 0, 0, 0.15));\\n  /* 关键：使用贝塞尔曲线让放大缩小有 Q 弹的感觉 */\\n  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);\\n  /* 添加待机时的上下漂浮动画 */\\n  animation: console-float 3s ease-in-out infinite;\\n  transform-origin: center center;\\n}\\n\\n/* 2. 鼠标悬停状态：上浮 + 变大 + 投影加深 (模拟被吸起来的感觉) */\\n.collapsed-view:hover {\\n  /* 暂停漂浮动画，防止冲突，让它定住被你“抓住” */\\n  animation-play-state: paused;\\n  /* 放大 1.15倍，并稍微向左歪头，同时向上位移10px */\\n  transform: scale(1.15) rotate(-5deg) translateY(-10px);\\n  /* 增加亮度，并且阴影变得更远、更散，增强悬浮感 */\\n  filter: drop-shadow(0 20px 20px rgba(255, 107, 129, 0.4)) brightness(1.05);\\n  z-index: 10;\\n}\\n\\n/* 3. 点击瞬间：模拟按键按下的回缩感 */\\n.collapsed-view:active {\\n  transform: scale(0.95) rotate(-5deg) translateY(0);\\n  filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.2));\\n  transition: all 0.1s;\\n}\\n\\n/* 4. 添加动画帧：模拟游戏机在空中轻轻漂浮 */\\n@keyframes console-float {\\n  0% {\\n    transform: translateY(0px) rotate(0deg);\\n  }\\n  50% {\\n    /* 轻轻上浮并微量旋转 */\\n    transform: translateY(-6px) rotate(2deg);\\n  }\\n  100% {\\n    transform: translateY(0px) rotate(0deg);\\n  }\\n}\\n</style>\\n'],sourceRoot:''}]);const s=o},314:e=>{e.exports=function(e){var n=e[1],t=e[3];if(!t)return n;if('function'==typeof btoa){var a=btoa(unescape(encodeURIComponent(JSON.stringify(t)))),i='sourceMappingURL=data:application/json;charset=utf-8;base64,'.concat(a),r='/*# '.concat(i,' */');return[n].concat([r]).join('\\n')}return[n].join('\\n')}},378:e=>{e.exports=function(e){var n=[];return n.toString=function(){return this.map(function(n){var t='',a=void 0!==n[5];return n[4]&&(t+='@supports ('.concat(n[4],') {')),n[2]&&(t+='@media '.concat(n[2],' {')),a&&(t+='@layer'.concat(n[5].length>0?' '.concat(n[5]):'',' {')),t+=e(n),a&&(t+='}'),n[2]&&(t+='}'),n[4]&&(t+='}'),t}).join('')},n.i=function(e,t,a,i,r){'string'==typeof e&&(e=[[null,e,void 0]]);var o={};if(a)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(o[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);a&&o[d[0]]||(void 0!==r&&(void 0===d[5]||(d[1]='@layer'.concat(d[5].length>0?' '.concat(d[5]):'',' {').concat(d[1],'}')),d[5]=r),t&&(d[2]?(d[1]='@media '.concat(d[2],' {').concat(d[1],'}'),d[2]=t):d[2]=t),i&&(d[4]?(d[1]='@supports ('.concat(d[4],') {').concat(d[1],'}'),d[4]=i):d[4]=''.concat(i)),n.push(d))}},n}},400:(e,n)=>{n.A=(e,n)=>{const t=e.__vccOpts||e;for(const[e,a]of n)t[e]=a;return t}},424:(e,n,t)=>{function a(e,n){for(var t=[],a={},i=0;i<n.length;i++){var r=n[i],o=r[0],s={id:e+':'+i,css:r[1],media:r[2],sourceMap:r[3]};a[o]?a[o].parts.push(s):t.push(a[o]={id:o,parts:[s]})}return t}t.d(n,{A:()=>f});var i='undefined'!=typeof document;if('undefined'!=typeof DEBUG&&DEBUG&&!i)throw new Ошибка('vue-style-loader cannot be used in a non-browser environment. Use { target: \\'node\\' } in your Webpack config to indicate a server-rendering environment.');var r={},o=i&&(document.head||document.getElementsByTagName('head')[0]),s=null,l=0,c=!1,d=function(){},A=null,u='data-vue-ssr-id',p='undefined'!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function f(e,n,t,i){c=t,A=i||{};var o=a(e,n);return C(o),function(n){for(var t=[],i=0;i<o.length;i++){var s=o[i];(l=r[s.id]).refs--,t.push(l)}n?C(o=a(e,n)):o=[];for(i=0;i<t.length;i++){var l;if(0===(l=t[i]).refs){for(var c=0;c<l.parts.length;c++)l.parts[c]();delete r[l.id]}}}}function C(e){for(var n=0;n<e.length;n++){var t=e[n],a=r[t.id];if(a){a.refs++;for(var i=0;i<a.parts.length;i++)a.parts[i](t.parts[i]);for(;i<t.parts.length;i++)a.parts.push(g(t.parts[i]));a.parts.length>t.parts.length&&(a.parts.length=t.parts.length)}else{var o=[];for(i=0;i<t.parts.length;i++)o.push(g(t.parts[i]));r[t.id]={id:t.id,refs:1,parts:o}}}}function m(){var e=document.createElement('style');return e.type='text/css',o.appendChild(e),e}function g(e){var n,t,a=document.querySelector('style['+u+'~=\"'+e.id+'\"]');if(a){if(c)return d;a.parentNode.removeChild(a)}if(p){var i=l++;a=s||(s=m()),n=x.bind(null,a,i,!1),t=x.bind(null,a,i,!0)}else a=m(),n=b.bind(null,a),t=function(){a.parentNode.removeChild(a)};return n(e),function(a){if(a){if(a.css===e.css&&a.media===e.media&&a.sourceMap===e.sourceMap)return;n(e=a)}else t()}}var v,h=(v=[],function(e,n){return v[e]=n,v.filter(Boolean).join('\\n')});function x(e,n,t,a){var i=t?'':a.css;if(e.styleSheet)e.styleSheet.cssText=h(n,i);else{var r=document.createTextNode(i),o=e.childNodes;o[n]&&e.removeChild(o[n]),o.length?e.insertBefore(r,o[n]):e.appendChild(r)}}function b(e,n){var t=n.css,a=n.media,i=n.sourceMap;if(a&&e.setAttribute('media',a),A.ssrId&&e.setAttribute(u,n.id),i&&(t+='\\n/*# sourceURL='+i.sources[0]+' */',t+='\\n/*# sourceMappingURL=data:application/json;base64,'+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+' */'),e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},877:(e,n,t)=>{var a=t(132);a.__esModule&&(a=a.default),'string'==typeof a&&(a=[[e.id,a,'']]),a.locals&&(e.exports=a.locals);(0,t(424).A)('04603b82',a,!1,{ssrId:!0})}},n={};function t(a){var i=n[a];if(void 0!==i)return i.exports;var r=n[a]={id:a,exports:{}};return e[a](r,r.exports,t),r.exports}t.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return t.d(n,{a:n}),n},t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})},t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),t.r=e=>{'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})};const a=Vue,i='SillyTavern_Music_UserSongs',r=(0,a.reactive)({music:{cache:{},regex: /<bgm>текущая музыка[:：](.+?) - (.+?)<\\/bgm>/g,playMode:'list',list:[],userList:[],index:-1,autoPlayer:!1,initUserList(){try{const e=localStorage.getItem(i);e&&(this.userList=JSON.parse(e))}catch(e){console.error('Не удалось загрузить плейлист',e)}},saveUserList(){try{localStorage.setItem(i,JSON.stringify(this.userList))}catch(e){console.error('Не удалось сохранить плейлист',e)}},async getAllChatMessages(){const e=await triggerSlash('/pass {{lastMessageId}}'),n=[];if(e){const t=await getChatMessages(`0-${e}`,{role:'all'});for(const e of t){const t=[...e.message.matchAll(this.regex)];if(0==t.length)continue;const a=t.at(-1);n.push({song:a[1],singer:a[2],message_id:e.message_id,source:'chat'})}}0===this.userList.length&&this.initUserList();const t=this.userList.map(e=>({...e,source:'user'}));this.list=[...n,...t]},checkAudioAvailability:async e=>new Promise(n=>{const t=new Audio;let a;const i=()=>{o(),n(!0)},r=()=>{o(),n(!1)},o=()=>{t.removeEventListener('loadedmetadata',i),t.removeEventListener('error',r),clearTimeout(a),t.src=''};t.preload='metadata',t.src=e,a=setTimeout(r,3e3),t.addEventListener('loadedmetadata',i),t.addEventListener('error',r)})}}),o={class:'screen-content'},s=['src'],l={class:'expanded-view'},c={class:'rpg-header'},d=['src'],A={class:'status-panel'},u={class:'name-badge'},p={class:'p-name pixel-font'},f={class:'bar-container hp-container'},C={class:'bar-track'},m={class:'bar-container mp-container'},g={class:'bar-track',style:{position:'relative',overflow:'visible',background:'none',border:'none'}},v=['value'],h={class:'game-screen-wrapper'},x={class:'game-screen'},b={key:0,class:'screen-view-anim',style:{height:'100%',width:'100%'}},y={class:'screen-ui-top pixel-font'},B=['title'],w={class:'screen-lyrics-box'},k={class:'s-lyric-cur'},E={class:'s-lyric-next'},S={class:'scene-stage'},D={class:'sprite-body',style:{'font-weight':'bold','white-space':'nowrap'}},N={class:'screen-view-list'},L={class:'search-bar'},M={class:'list-container custom-scroll'},P=['onClick'],V={class:'song-txt'},Y=['onClick'],T={key:0,class:'empty-tip'},U={class:'info-card'},F={class:'song-title'},I={key:0,class:'song-artist'},W={class:'pad-left'},R={class:'pad-right volume-control'},j=(0,a.defineComponent)({__name:'musicPlayer',setup(e){const n=(0,a.ref)(!1),t=(0,a.ref)(!1),i=(0,a.ref)(65),j=(0,a.ref)(0),X=(0,a.ref)('Вставьте монету'),O=(0,a.ref)('Начать игру'),q=(0,a.ref)(''),G=(0,a.ref)(''),Q=(0,a.ref)(''),Z=(0,a.ref)(''),K=(0,a.ref)(null),H=(0,a.ref)(''),J=(0,a.computed)(()=>H.value?H.value:Z.value||'https://api.dicebear.com/7.x/pixel-art/svg?seed=Love&backgroundColor=b6e3f4'),ee=(0,a.ref)('( -ω-) zzz...');let ne=null;const te=['( -ω-) zzz...','( ˘▽˘)っ♨','(・_・)','( o_o )','(・_・)','(￣o￣) . z Z','( *・∀・)✄','( ˙-˙ )','_(:3 」∠)_','(｡･∀･)ﾉ','( ○_○)','( ´･･)ﾉ(._.`)','( ఠ ͟ʖ ఠ)','φ(゜▽゜*)♪'],ae=['( >ω<)/','\\\\(>ω< )','└( ^o^ )┐','┌( ^o^ )┘','♪( ´θ｀)ノ','(ノ^o^)ノ','ヾ(⌐■_■)ノ♪','(/≧▽≦)/','٩(◕‿◕｡)۶','( •̀ ω •́ )y','ヽ(✿ﾟ▽ﾟ)ノ','(ﾉ*･ω･)ﾉ','o(≧口≦)o','(ง •_•)ง','♪(^∇^*)'],ie=(0,a.ref)(!1),re=(0,a.ref)(''),oe=(0,a.computed)(()=>r.music.list),se=(0,a.computed)(()=>{switch(r.music.playMode){case'random':return'RND';case'single':return'ONE';default:return'ALL'}}),le=(0,a.computed)(()=>{switch(r.music.playMode){case'random':return'Случайное воспроизведение';case'single':return'Повтор трека';default:return'Повтор плейлиста'}});function ce(e){e.stopPropagation();const n=['list','random','single'],t=(n.indexOf(r.music.playMode)+1)%n.length;r.music.playMode=n[t]}function de(){'single'===r.music.playMode?(xe.currentTime=0,xe.play().catch(e=>console.error('Replay error',e))):we(null,'next')}function Ae(e){e.stopPropagation(),ie.value=!ie.value}async function ue(){if(re.value.trim())try{const e=re.value.trim(),n={song:e,source:'user'};r.music.userList.push({song:e}),r.music.saveUserList(),r.music.list.push(n),re.value='';const t=-1===r.music.index,a=r.music.list.length-1;r.music.index=a,t||await we(null,'play')}catch(e){console.warn('Search/Play error:',e)}}function pe(){K.value?.click()}function fe(e){const n=e.target;if(n.files&&n.files[0]){const e=n.files[0],t=new FileReader;t.onload=e=>{if(e.target?.result){const n=e.target.result;H.value=n,localStorage.setItem('myPixelAvatar',n)}},t.readAsDataURL(e)}}function Ce(){clearTimeout(ne);const e=n.value?ae:te;let t=Math.floor(Math.random()*e.length);ee.value=e[t];const a=n.value?400:1500;ne=setTimeout(Ce,a)}(0,a.onMounted)(()=>{Ce(),xe.addEventListener('ended',de),r.music.initUserList(),0===r.music.list.length&&r.music.getAllChatMessages();const e=localStorage.getItem('myPixelAvatar');e&&(H.value=e),De.value&&De.value.addEventListener('touchmove',e=>{ze.value&&!Fe.value&&e.preventDefault()},{passive:!1});try{$('body').on('visibilitychange',He),$('body').on('click',Je),$('body').on('keydown',en)}catch(e){console.warn('jQuery error')}window.addEventListener('resize',Ke),Xe(),xe.addEventListener('timeupdate',Be)});const me=(0,a.ref)([]),ge=(0,a.ref)(-1),ve=(0,a.ref)(!1),he=(0,a.ref)(-1),xe=new Audio;xe.volume=i.value/100,(0,a.watch)(i,e=>{xe.volume=e/100});const be=globalThis.Music;function ye(e){const n=me.value;if(!n.length)return X.value='',O.value='',void(ge.value=-1);let t=n.length-1;for(let a=0;a<n.length;a++)if(e<n[a].time){t=a-1;break}if(t<0)return X.value='',O.value=n[0]?.text??'',void(ge.value=-1);t!==ge.value&&(ge.value=t,X.value=n[t]?.text??'',O.value=n[t+1]?.text??'')}function Be(){ye(xe.currentTime||0);const e=xe.currentTime||0,n=xe.duration||1;j.value=e/n*100}async function we(e,t){e?.stopPropagation(),clearTimeout(Te);try{if('stop'==t)return xe.pause(),void(n.value=!1);let e=r.music.index;const a=r.music.list.length;if(0===a)return;if(-1==e&&(e=0),'play'==t){const t=ve.value&&he.value===e&&xe.src;if(!n.value&&t)return xe.play(),void(n.value=!0);await Ee(e)}if('prev'==t&&(e>0?e-=1:e=a-1,r.music.index=e,await Ee(e)),'next'==t){if('random'===r.music.playMode){if(a>1){let n=e,t=0;for(;n===e&&t<5;)n=Math.floor(Math.random()*a),t++;e=n}}else e>=a-1?e=0:e+=1;r.music.index=e,await Ee(e)}}catch(e){console.error('Play control error:',e),e.message&&e.message.includes('Extension context invalidated')&&(X.value='Нужно обновить!',O.value='Плагин обновлён')}}function ke(e){const n=e.target,t=Number(n.value);if(j.value=t,xe&&xe.duration){const e=t/100*xe.duration;isFinite(e)&&(xe.currentTime=e)}}async function Ee(e){try{const t=r.music.list[e].song;let a='';const i=r.music.cache[t],o=i&&'object'==typeof i?i:null;if(i){const e='string'==typeof i?i:i.Url;if(e){await r.music.checkAudioAvailability(e)&&(a=e,o&&Se(o))}}let s=null;if(!a){X.value='Поиск...',O.value='Подождите';const e=await be.SearchMusic(t);if(!e?.Url)return X.value='Ошибка',void(O.value='Повторить?');a=e.Url,s=e,r.music.cache[t]=e}a!=xe.src&&(xe.src=a);const l=s||o;l&&Se(l),Q.value&&(me.value=function(e){const n=e.split(/\\r?\\n/),t=[];for(const e of n){const n=e.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g),a=e.replace(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/g,'').trim();if(n&&a)for(const e of n){const n=e.match(/\\[(\\d{1,2}):(\\d{2})(?:\\.(\\d{1,3}))?\\]/);if(!n)continue;const i=60*Number(n[1])+Number(n[2])+(n[3]?Number(n[3].padEnd(3,'0')):0)/1e3;t.push({time:i,text:a})}}return t.sort((e,n)=>e.time-n.time),t}(Q.value||''),ge.value=-1,ye(0)),xe.play(),n.value=!0,ve.value=!0,he.value=e}catch(e){console.error('PlayMusic Ошибка:',e),n.value=!1,e.message&&e.message.includes('Extension context invalidated')&&(X.value='Перезагрузить',O.value='Plugin Ошибка')}}function Se(e){G.value=e.Singer,q.value=e.Name,Q.value=e.Lyric,Z.value=e.Cover||e.Pic||''}(0,a.watch)(n,e=>{Ce()}),(0,a.watch)(()=>r.music.index,(e,n)=>{-1==n&&e>-1&&we(null,'play')});const De=(0,a.ref)(null);let Ne=0,Le=0,Me=0,Pe=0;const Ve=(0,a.ref)('50%'),Ye=(0,a.ref)('20%');let Te=null;const ze=(0,a.ref)(!1),Ue=(0,a.ref)(!1),Fe=(0,a.ref)(!1),Ie=$('body').width()||0,We=$('body').height()||0,$e=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);function _e(e){const n=De.value;if(!n)return;if(2===e.button||3===e.which)return void(Fe.value=!0);if('INPUT'===e.target.tagName||e.target.closest('.add-btn')||e.target.closest('.list-item')||e.target.closest('.del-btn'))return;if(e.target.closest('.volume-control')||e.target.closest('.d-btn')||e.target.closest('.shrink-btn'))return;if($e&&e.target&&e.target.closest&&e.target.closest('.bottom-controls'))return;if(e.target.closest('.avatar-box')&&!n.classList.contains('collapsed-view'))return;Fe.value=!1,ze.value=!0,Ue.value=!1,n.classList.add('dragging'),clearTimeout(Te);const t=n.getBoundingClientRect();Me=t.left+t.width/2,Pe=t.top+t.height/2,'mousedown'===e.type?(Ne=e.clientX,Le=e.clientY,$('body').on('mousemove',Re),$('body').on('mouseup',je)):'touchstart'===e.type&&(Ne=e.touches[0].clientX,Le=e.touches[0].clientY,$('body').on('touchmove',Re),$('body').on('touchend',je))}function Re(e){if(!ze.value||Fe.value)return;let n,t;e&&'function'==typeof e.preventDefault&&e.preventDefault(),Ue.value=!0,'mousemove'===e.type?(n=e.clientX,t=e.clientY):'touchmove'===e.type&&(n=e.touches[0].clientX,t=e.touches[0].clientY);const a=Me+(n-Ne),i=Pe+(t-Le),r=Ie-20,o=We-20,s=Math.max(20,Math.min(r,a)),l=Math.max(20,Math.min(o,i));a!==s||i!==l?De.value.classList.add('near-boundary'):De.value.classList.remove('near-boundary'),Ve.value=`${a}px`,Ye.value=`${i}px`,De.value.style.transform='translate(-50%, -50%) scale(1.02)'}function je(e){if(!ze.value&&!Fe.value)return;if($('body').off('mousemove',Re),$('body').off('mouseup',je),$('body').off('touchmove',Re),$('body').off('touchend',je),Fe.value)return void(Fe.value=!1);const n=De.value;ze.value=!1,n&&n.classList.remove('dragging','near-boundary');const a=n?n.style.transform:'';a&&a.includes('scale(1.02)')&&(n.style.transform=a.replace('scale(1.02)','')),Ue.value?function(){const e=De.value;if(!e)return;const n=e.getBoundingClientRect(),t={x:(n.left+n.width/2)/Ie*100,y:(n.top+n.height/2)/We*100};localStorage.setItem('lyricsWidgetPosition',JSON.stringify(t))}():setTimeout(()=>{t.value||e&&e.target&&e.target.closest&&(e.target.closest('.bottom-controls')||e.target.closest('.volume-control')||e.target.closest('.avatar-box')||e.target.closest('.shrink-btn')||e.target.closest('.rpg-header'))||Oe(e)},50),Ue.value=!1}function Xe(){const e=De.value;if(!e)return;const n=localStorage.getItem('lyricsWidgetPosition');if(n){const t=JSON.parse(n);let a='50';t.x<100&&t.x>0&&(a=t.x);let i='20';t.y<100&&t.y>0&&(i=t.y),e.style.left=a+'%',e.style.top=i+'%'}}function Oe(e){ze.value||Ue.value||Fe.value||e&&e.target&&e.target.closest&&(e.target.closest('.bottom-controls')||e.target.closest('.volume-control')||e.target.closest('.avatar-box'))||(!e||2!==e.button&&3!==e.which)&&(t.value=!t.value)}function qe(e){Fe.value=!0}function Ge(){$e||clearTimeout(Te)}function Qe(){}function Ze(){$e&&clearTimeout(Te)}function Ke(){Xe()}function He(){}function Je(e){!Fe.value||e.target&&e.target.closest&&e.target.closest('.lyrics-widget')||(Fe.value=!1)}function en(e){'Escape'===e.key&&(Fe.value=!1,t.value=!1)}return(0,a.onBeforeUnmount)(()=>{clearTimeout(Te),clearTimeout(ne),xe.removeEventListener('ended',de),$('body').off('mousemove',Re),$('body').off('mouseup',je),$('body').off('touchmove',Re),$('body').off('touchend',je),$('body').off('visibilitychange',He),$('body').off('click',Je),$('body').off('keydown',en),window.removeEventListener('resize',Ke),xe.removeEventListener('timeupdate',Be)}),(e,Q)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{id:'lyricsWidget',class:(0,a.normalizeClass)(['lyrics-widget',{'is-playing':n.value,expanded:t.value}]),onMousedown:_e,onTouchstart:_e,onContextmenu:qe,onMouseenter:Ge,onMouseleave:Qe,onTouchend:Ze,ref_key:'widget',ref:De,style:(0,a.normalizeStyle)(`top:${Ye.value};left:${Ve.value}`)},[(0,a.createCommentVNode)(' 隐藏的文件上传输入框 '),(0,a.createElementVNode)('input',{type:'file',ref_key:'fileInput',ref:K,accept:'image/*',style:{display:'none'},onChange:fe},null,544),(0,a.createCommentVNode)(' 1. 收缩状态：悬浮小挂件 '),(0,a.createElementVNode)('div',{class:'collapsed-view',onClick:Oe},[(0,a.createCommentVNode)(' 填在坑里的图片 '),(0,a.createElementVNode)('div',o,[(0,a.createElementVNode)('img',{src:J.value,class:'fill-img'},null,8,s)]),(0,a.createCommentVNode)(' 游戏机外框 '),Q[7]||(Q[7]=(0,a.createElementVNode)('img',{src:'https://i.postimg.cc/DfQVDs6w/you-xi-ji.png',alt:'Frame',class:'console-frame'},null,-1))]),(0,a.createCommentVNode)(' 2. 展开状态 '),(0,a.createElementVNode)('div',l,[(0,a.createElementVNode)('div',c,[(0,a.createCommentVNode)(' 1. 头像部分 '),(0,a.createElementVNode)('div',{class:'avatar-box',onClick:(0,a.withModifiers)(pe,['stop']),title:'Нажмите для смены аватара'},[(0,a.createElementVNode)('img',{src:J.value,class:'rect-avatar'},null,8,d),Q[8]||(Q[8]=(0,a.createElementVNode)('div',{class:'upload-hint'},[(0,a.createElementVNode)('i',{class:'fas fa-camera'})],-1))]),(0,a.createCommentVNode)(' 2. 状态条部分 '),(0,a.createElementVNode)('div',A,[(0,a.createElementVNode)('div',u,[(0,a.createElementVNode)('span',p,(0,a.toDisplayString)(G.value||'Player 1'),1),Q[9]||(Q[9]=(0,a.createElementVNode)('span',{class:'lvl-txt pixel-font'},'Lv.99',-1))]),(0,a.createElementVNode)('div',f,[Q[10]||(Q[10]=(0,a.createElementVNode)('i',{class:'fas fa-heart bar-icon red-icon'},null,-1)),(0,a.createElementVNode)('div',C,[(0,a.createElementVNode)('div',{class:'bar-fill hp-fill',style:(0,a.normalizeStyle)({width:i.value+'%'})},null,4)])]),(0,a.createElementVNode)('div',m,[Q[11]||(Q[11]=(0,a.createElementVNode)('i',{class:'fas fa-bolt bar-icon yellow-icon'},null,-1)),(0,a.createCommentVNode)(' 修改开始：换成 Input Range '),(0,a.createElementVNode)('div',g,[(0,a.createElementVNode)('input',{type:'range',class:'progress-slider',min:'0',max:'100',step:'0.1',value:j.value,onInput:ke,style:(0,a.normalizeStyle)({'--progress-fill':j.value+'%'})},null,44,v)]),(0,a.createCommentVNode)(' 修改结束 ')])]),(0,a.createCommentVNode)(' 收缩按钮 '),(0,a.createElementVNode)('button',{class:'shrink-btn',onClick:(0,a.withModifiers)(Oe,['stop']),title:'Свернуть панель'},[...Q[12]||(Q[12]=[(0,a.createElementVNode)('i',{class:'fas fa-compress-arrows-alt'},null,-1)])])]),(0,a.createCommentVNode)(' 游戏屏幕区 '),(0,a.createElementVNode)('div',h,[(0,a.createElementVNode)('div',x,[(0,a.createCommentVNode)(' musicPlayer.vue 的 template 部分 '),(0,a.createCommentVNode)(' 找到这一块: A面：播放界面 '),ie.value?((0,a.openBlock)(),(0,a.createElementBlock)(a.Fragment,{key:1},[(0,a.createCommentVNode)(' 【B面：列表界面】 '),(0,a.createElementVNode)('div',N,[(0,a.createElementVNode)('div',L,[(0,a.withDirectives)((0,a.createElementVNode)('input',{'onUpdate:modelValue':Q[0]||(Q[0]=e=>re.value=e),onKeydown:(0,a.withKeys)(ue,['enter']),placeholder:'Поиск песни...',class:'pixel-input'},null,544),[[a.vModelText,re.value]]),(0,a.createElementVNode)('button',{class:'add-btn',onClick:ue},'+')]),(0,a.createElementVNode)('div',M,[((0,a.openBlock)(!0),(0,a.createElementBlock)(a.Fragment,null,(0,a.renderList)(oe.value,(e,n)=>((0,a.openBlock)(),(0,a.createElementBlock)('div',{key:n,class:(0,a.normalizeClass)(['list-item',{active:n===(0,a.unref)(r).music.index}]),onClick:e=>function(e,n){n&&n.stopPropagation(),r.music.index=e,we(null,'play')}(n,e)},[(0,a.createElementVNode)('span',V,(0,a.toDisplayString)(n+1)+'. '+(0,a.toDisplayString)(e.song),1),(0,a.createElementVNode)('i',{class:'fas fa-times del-btn',onClick:e=>function(e,n){n.stopPropagation();const t=r.music.list[e];if(r.music.list.splice(e,1),r.music.index>=r.music.list.length&&(r.music.index=Math.max(0,r.music.list.length-1)),t&&'user'===t.source){const e=r.music.userList.findIndex(e=>e.song===t.song);-1!==e&&(r.music.userList.splice(e,1),r.music.saveUserList())}}(n,e)},null,8,Y)],10,P))),128)),0===oe.value.length?((0,a.openBlock)(),(0,a.createElementBlock)('div',T,'Нет данных')):(0,a.createCommentVNode)('v-if',!0)])])],2112)):((0,a.openBlock)(),(0,a.createElementBlock)('div',b,[(0,a.createCommentVNode)(' 【修改这里：屏幕顶部状态栏】 '),(0,a.createElementVNode)('div',y,[Q[14]||(Q[14]=(0,a.createElementVNode)('span',null,'КВЕСТ: МУЗЫКА',-1)),(0,a.createCommentVNode)(' 新增：模式切换按钮 (HUD风格) '),(0,a.createCommentVNode)(' 点击这里切换模式，显示当前模式的像素文字 '),(0,a.createElementVNode)('div',{class:'hud-mode-switch',onClick:ce,title:le.value},[Q[13]||(Q[13]=(0,a.createElementVNode)('span',{class:'blink-arrow'},'▶',-1)),(0,a.createElementVNode)('span',null,(0,a.toDisplayString)(se.value),1)],8,B)]),(0,a.createCommentVNode)(' ------------------------- '),(0,a.createCommentVNode)(' 歌词显示区 (保持不变) '),(0,a.createElementVNode)('div',w,[(0,a.createElementVNode)('div',k,(0,a.toDisplayString)(X.value||'Ожидание...'),1),(0,a.createElementVNode)('div',E,(0,a.toDisplayString)(O.value),1)]),(0,a.createElementVNode)('div',S,[(0,a.createElementVNode)('div',{class:(0,a.normalizeClass)(['character-sprite',{running:n.value}])},[(0,a.createElementVNode)('span',D,(0,a.toDisplayString)(ee.value),1)],2)])]))]),Q[15]||(Q[15]=(0,a.createElementVNode)('div',{class:'screen-overlay'},null,-1))]),(0,a.createCommentVNode)(' 歌曲信息区 '),(0,a.createElementVNode)('div',U,[(0,a.createElementVNode)('div',F,(0,a.toDisplayString)(q.value||'Песня не выбрана'),1),G.value?((0,a.openBlock)(),(0,a.createElementBlock)('div',I,'Исполнитель: '+(0,a.toDisplayString)(G.value),1)):(0,a.createCommentVNode)('v-if',!0)]),(0,a.createCommentVNode)(' 底部控制区 '),(0,a.createElementVNode)('div',{class:'controls-pad bottom-controls',onClick:Q[6]||(Q[6]=(0,a.withModifiers)(()=>{},['stop']))},[(0,a.createElementVNode)('div',W,[(0,a.createCommentVNode)(' 菜单按钮 '),(0,a.createElementVNode)('button',{class:(0,a.normalizeClass)(['d-btn menu-btn',{active:ie.value}]),onClick:Ae},[...Q[16]||(Q[16]=[(0,a.createElementVNode)('i',{class:'fas fa-list'},null,-1)])],2),(0,a.createElementVNode)('button',{class:'d-btn prev',onClick:Q[1]||(Q[1]=e=>we(e,'prev'))},[...Q[17]||(Q[17]=[(0,a.createElementVNode)('i',{class:'fas fa-step-backward'},null,-1)])]),(0,a.createElementVNode)('button',{class:'d-btn play',onClick:Q[2]||(Q[2]=e=>we(e,n.value?'stop':'play'))},[(0,a.createElementVNode)('i',{class:(0,a.normalizeClass)(['fas',n.value?'fa-pause':'fa-play'])},null,2)]),(0,a.createElementVNode)('button',{class:'d-btn next',onClick:Q[3]||(Q[3]=e=>we(e,'next'))},[...Q[18]||(Q[18]=[(0,a.createElementVNode)('i',{class:'fas fa-step-forward'},null,-1)])])]),(0,a.createElementVNode)('div',R,[(0,a.withDirectives)((0,a.createElementVNode)('input',{type:'range',class:'volume-slider',min:'0',max:'100','onUpdate:modelValue':Q[4]||(Q[4]=e=>i.value=e),onClick:Q[5]||(Q[5]=(0,a.withModifiers)(()=>{},['stop'])),style:(0,a.normalizeStyle)({'--volume-fill':i.value+'%'})},null,4),[[a.vModelText,i.value]])])])])],38))}});t(877);const X=(0,t(400).A)(j,[['__scopeId','data-v-3e120e34']]),O=(0,a.createApp)(X);function q(){return globalThis.Music?Promise.resolve():new Promise((e,n)=>{const t=document.createElement('script');t.src='https://drive.baibai.cv/f/ZKEBuW/Music.js',t.onload=()=>e(),t.onerror=()=>n(),document.head.appendChild(t)})}async function G(e,n){if(console.log(e),n-=1,'Сообщение создано'==e){const e=await getChatMessages(`${n}-${n}`,{role:'all'}),t=r.music.list.filter(e=>e.message_id!==n);for(const n of e){const e=[...n.message.matchAll(r.music.regex)];if(0==e.length)continue;const a=e.at(-1),i={song:a[1],singer:a[2],message_id:n.message_id};t.push(i)}t.sort((e,n)=>e.message_id-n.message_id),r.music.list=t,r.music.index=t.length>0?t.length-1:-1}else await r.music.getAllChatMessages()}function Q(){try{$(`head > div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('Ошибка при удалении стилей')}}function Z(){try{$(`div[script_id=\"${getScriptId()}\"]`).remove()}catch{console.log('Ошибка при удалении div')}}$(async()=>{try{await q(),await function(){try{Q(),Z()}catch{}const e=$('<div>').attr('script_id',getScriptId());$('body').append(e),O.mount(e[0]),function(){try{if($(`head > div[script_id=\"${getScriptId()}\"]`).length>0)return;const e=$('<div>').attr('script_id',getScriptId()).append($('head > style',document).clone());$('head').append(e)}catch{console.log('Ошибка при перемещении CSS')}}()}(),console.log('Плеер загружен!'),eventOn(tavern_events.CHAT_CHANGED,()=>G('Чат переключён')),eventOn(tavern_events.MESSAGE_UPDATED,e=>G('Сообщение обновлено',e)),eventOn(tavern_events.GENERATION_ENDED,e=>G('Сообщение создано',e)),eventOn(tavern_events.MESSAGE_SWIPED,()=>G('Сообщение переключено')),eventOn(tavern_events.MESSAGE_DELETED,()=>G('Сообщение удалено')),eventOn(tavern_events.MESSAGE_SENT,()=>{console.log('Сообщение отправлено')}),eventOn(tavern_events.GENERATION_STOPPED,()=>{console.log('Генерация остановлена')}),await r.music.getAllChatMessages()}catch(e){console.error(e),toastr.error(`Ошибка загрузки:${e}`)}}),$(window).on('pagehide',()=>{console.log('Вызвано pagehide');try{O.unmount(),Q(),Z()}catch{}});export{q as ensureMusicLoaded};\n//# sourceMappingURL=index.js.map",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}